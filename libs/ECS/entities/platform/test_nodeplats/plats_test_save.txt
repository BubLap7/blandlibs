{"map":{"name":"plats_test","ambient":"#97a0a8","light":"#f2f8fc","sky":"#dce8ed","fog":"#8d9aa0","fogD":2000,"xyz":[304,10,1059,7,11,7,5,5,5,40,0.01,10,5000,10,5000,50,10,50,40.9,7,10.86,40.9,7,10.98,41,7,11,38,0.01,10,41.08,7,11,41.14,7,10.86,39,7,11],"objects":[{"p":[-7,17,0],"meshUUID":"0ebc6fd2-8b5a-4a66-9271-b87d8a367c5e","objUUID":"0c731f3e-7ef0-4719-80da-d42798c5c1f2","o":0.8,"si":0},{"p":[0,27,0],"meshUUID":"35a4e9ca-63e3-4e88-a0db-bff26af383cf","objUUID":"15e6ec6b-a468-42f3-b327-d42143e264f0","i":5,"tm":0,"si":1},{"p":[46,32,-194],"meshUUID":"fd186ae2-8617-4497-87ac-c2367f8a87e1","objUUID":"f5fdff29-b6a6-4807-885a-ca2a363b53b6","i":64,"l":1,"nid":201,"si":2},{"p":[46,32,-80],"meshUUID":"a3f87a0d-609f-49f0-9ed6-8a92ddd3008d","objUUID":"8ea648bb-b592-4ac0-9468-b811371b334d","i":64,"l":1,"nid":301,"si":2},{"p":[46,32,37],"meshUUID":"2cc4b793-0aa8-4aca-b8cf-78852f8bdfd7","objUUID":"8e9666e4-6073-44f7-94b5-9dd9e40c865c","i":64,"l":1,"nid":401,"si":2},{"p":[46,32,203],"meshUUID":"23eff5f0-d705-4d7e-b2ae-8ed7025f3028","objUUID":"4f3db29a-db86-4d6c-ac25-a8001d2e0b62","i":64,"l":1,"nid":501,"si":2},{"p":[47.95,35,-194.01],"meshUUID":"f12d4d92-9fc8-4803-b81a-c8edccef4b08","objUUID":"aa834df2-ec03-4707-8298-a0b4da6c15de","i":30,"r":[1.57,0,1.57],"st":"Z_LIN_PLAT","bv":1,"sf":70,"sa":1,"si":3},{"p":[48,35.05,-80],"meshUUID":"438863a3-35b0-4918-bbfa-4ae525d00dee","objUUID":"012e9909-b941-4331-b162-8c206053ada1","i":30,"r":[1.57,0,1.57],"st":"VERT_CIRCLEX_PLAT","bv":1,"sf":70,"sa":1,"si":3},{"p":[48.04,35.09,37],"meshUUID":"b9369c0f-e66e-40ac-82e5-0e6206d4a2cd","objUUID":"59ccbbc3-7bb0-4c9d-b965-75839ca345d0","i":30,"r":[1.57,0,1.57],"st":"VERT_CIRCLEZ_PLAT","bv":1,"sf":70,"sa":1,"si":3},{"p":[48.07,35.12,202.93],"meshUUID":"e9016a18-6729-48c6-adbd-b849d891e163","objUUID":"6298bd43-b174-4c34-a223-1586b047b56a","i":30,"r":[1.57,0,1.57],"st":"HOR_CIRCLE_PLAT","bv":1,"sf":70,"sa":1,"si":3},{"p":[46,32,-366],"meshUUID":"422572d0-72fa-4c8e-932b-e5d4cccfe2bc","objUUID":"d6869632-279c-4f36-a3cc-0c168e9ad867","i":64,"l":1,"si":2},{"p":[47.95,35,-366.07],"meshUUID":"192f8338-d938-46ee-b7df-de0d3a67227e","objUUID":"eb077eb8-0dc5-4243-a8f9-1b0feeef20bb","i":30,"r":[1.57,0,1.57],"st":"X_LIN_PLAT","bv":1,"sf":70,"sa":1,"si":3},{"p":[46,32,-296],"meshUUID":"eebc208a-79cc-406a-9d47-222ea3fce716","objUUID":"a13ae9a6-3ec9-48a9-9ef8-be20a8e6c6dd","i":64,"l":1,"nid":101,"si":2},{"p":[47.95,35,-296.01],"meshUUID":"f0a79f97-b9e7-483f-908b-b3002e62f528","objUUID":"d68fa617-6927-45b6-b5ad-171bb20f0974","i":30,"r":[1.57,0,1.57],"st":"Y_LIN_PLAT","bv":1,"sf":70,"sa":1,"si":3},{"p":[0,-28,0],"meshUUID":"0f027443-edce-42e9-a210-5bfb2d340d04","objUUID":"aa96da64-3cd0-4b6d-bed7-d1964b00a3dd","i":27,"tm":0,"m":1,"tcp":1,"si":4},{"p":[0,27,0],"meshUUID":"d3086935-0836-4166-948a-ce191d722970","objUUID":"7530de3e-7470-42c1-a815-060b3ab7f157","i":25,"tm":0,"si":5},{"p":[48,31,-366],"meshUUID":"9cabaa99-0b83-4503-a4ff-112857662900","objUUID":"4706b1e1-e9b8-451f-aca1-074890aac71f","i":35,"si":6},{"p":[-121,32,-366],"meshUUID":"926c38aa-5942-469e-989b-b9f8aab89f33","objUUID":"7a621e4f-e20f-4b01-a9ff-ccfbc5df9218","i":64,"l":1,"nid":51,"si":2},{"p":[-119.71,35,-366.06],"meshUUID":"35880ac0-c3c1-4084-9219-81cd89fd4a8d","objUUID":"83c46467-5586-450d-a800-977eac63c3a5","i":30,"r":[1.57,0,-1.57],"st":"X_LIN_0_5_PLAT","bv":1,"sf":70,"sa":1,"si":3},{"p":[-116,32,-296],"meshUUID":"dd8b25db-b7cf-4493-9c73-46c60ba7ebd3","objUUID":"2fa34afd-2d6a-4d52-90f0-08a7cd9e1893","i":64,"l":1,"nid":151,"si":2},{"p":[-120,35,-295.94],"meshUUID":"a7936ffd-0a86-464e-9277-373a856fa1b7","objUUID":"598b4602-8f11-4a42-be87-c09fd598f9b6","i":30,"r":[1.57,0,-1.57],"st":"Y_LIN_0_5_PLAT","bv":1,"sf":70,"sa":1,"si":3},{"p":[48,31,-194],"meshUUID":"b6fac394-9244-4dac-be52-cb275a3895a6","objUUID":"778c11e1-9b25-47d0-9f17-64be3f683a71","i":35,"si":7},{"p":[-122,32,-194],"meshUUID":"4ccc0dd0-4dc0-4279-93d9-c840a4d14deb","objUUID":"2039494f-cbf8-4224-a46b-1d79a4f7d08f","i":64,"l":1,"nid":251,"si":2},{"p":[-120.05,35,-193.95],"meshUUID":"88efb23a-a1dc-4b5d-9bf1-e6a9ed676702","objUUID":"cc7327bb-67b3-48c3-9f1d-d6c87a38fc36","i":30,"r":[1.57,0,-1.57],"st":"Z_LIN_0_5_PLAT","bv":1,"sf":70,"sa":1,"si":3},{"p":[48,31,-80],"meshUUID":"1618356f-6f1e-4117-a37f-95eaa801de29","objUUID":"fed750dd-5266-4972-889b-ee2b2c147a4f","i":35,"si":8},{"p":[-116,32,-80],"meshUUID":"ccc42296-d3cc-436b-8f61-f455a9cb19eb","objUUID":"046b10bb-685b-4f98-8ee4-dc64cf8a4694","i":64,"l":1,"nid":351,"si":2},{"p":[-120,35.05,-80],"meshUUID":"fb14785a-1865-4e58-819b-2ee321fe3daa","objUUID":"3c10eeda-a9d3-450a-b4c2-e8aa5c28b68e","i":30,"r":[1.57,0,-1.57],"st":"VERT_CIRCLEX_0_5_PLAT","bv":1,"sf":52,"sa":1,"si":9},{"p":[48,31,37],"meshUUID":"178e5050-ecf4-4d51-b5df-47da74d2a6b1","objUUID":"b006b763-7cf5-4283-99cf-f32cafb74777","i":35,"si":10},{"p":[-122,32,37],"meshUUID":"e812e3e5-6147-4c1d-ae80-deaf5e83441d","objUUID":"aa52425c-b352-4ed9-b750-88d99192b948","i":64,"l":1,"nid":451,"si":2},{"p":[-119.96,35.09,37],"meshUUID":"6ec55d54-1ce2-421b-821a-2e2e265a4526","objUUID":"32c6709d-ae69-41e1-bba9-25a2045c0e41","i":30,"r":[1.57,0,-1.57],"st":"VERT_CIRCLEZ_0_5_PLAT","bv":1,"sf":57,"sa":1,"si":3},{"p":[48,31,203],"meshUUID":"fe8c3d4f-c43f-4d5f-9daa-0e7ed353d9cb","objUUID":"3844f396-c5e4-4650-8718-d3c2c04468f2","i":35,"si":11},{"p":[-122,32,203],"meshUUID":"c17b1e6b-67cb-4383-bdbf-f35667908ce1","objUUID":"9980a9b2-42f1-4d5d-b0fc-a6d7acdd6d5c","i":64,"l":1,"nid":551,"si":2},{"p":[-119.93,35.12,202.93],"meshUUID":"a4314c74-e18c-46f0-964a-86af845c941d","objUUID":"53c99d02-b7c7-4e47-acec-3c53c2e302f5","i":30,"r":[1.57,0,-1.57],"st":"HOR_CIRCLE_0_5_PLAT","bv":1,"sf":66,"sa":1,"si":3},{"p":[-120,31,203],"meshUUID":"839f82ef-314d-44a6-b0d2-9a3159dd8e3a","objUUID":"9e0cba83-9d4e-4b5b-8cbe-d9feea7aa1d0","i":35,"si":11},{"p":[-120,31,37],"meshUUID":"6b1f5d33-0d99-4919-961c-8f6130da1a60","objUUID":"1495e06f-9bf5-43bf-b5ef-b52a71e22dac","i":35,"si":10},{"p":[-114,31,-80],"meshUUID":"1072513b-c927-4a0a-8025-ecd1707fa063","objUUID":"b164bb5d-189c-478e-a1fc-00c3eae9e7d5","i":35,"si":12}],"config":{"classes":[9],"settings":{"maxPlayers":20,"gameTime":0}},"scripts":{"client":"IyBjb2xsaXNpb24gd2l0aCBwbGF0Zm9ybXMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTGlicmFyeTogXGxpYnNcdXRpbHNccGxheWVyc1xwbHJ1dGlsX2Mua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogd29ya2Fyb3VuZCB0byBjaGVjayBob3cgbWFueSBwbGF5ZXJzIGFyZSBzcGF3bmVkIGluCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKYm9vbCBwbHJ1dGlsX2NfaW1zcGF3bmVkID0gZmFsc2U7CgphY3Rpb24gcGxydXRpbF9jX3N0YXJ0KCkgewogICAgcGxydXRpbF9jX2ltc3Bhd25lZCA9IGZhbHNlOwp9CgphY3Rpb24gcGxydXRpbF9jX29uUGxheWVyU3Bhd24oc3RyIGlkKSB7CiAgICBvYmogdHBsciA9IEdBTUUuUExBWUVSUy5maW5kQnlJRChpZCk7CiAgICBpZiAoKGJvb2wpdHBsci5pc1lvdSkgewogICAgICAgIEdBTUUuTkVUV09SSy5zZW5kKCJzcGF3biIsIHt9KTsKICAgICAgICBwbHJ1dGlsX2NfaW1zcGF3bmVkID0gdHJ1ZTsKICAgIH0KfQoKYWN0aW9uIHBscnV0aWxfY19vblBsYXllckRlYXRoKHN0ciBpZCwgc3RyIGtpbGxlcklEKSB7CiAgICBvYmogdHBsciA9IEdBTUUuUExBWUVSUy5maW5kQnlJRChpZCk7CiAgICBpZiAoKGJvb2wpdHBsci5pc1lvdSkgewogICAgICAgIHBscnV0aWxfY19pbXNwYXduZWQgPSBmYWxzZTsgICAgCiAgICB9Cn0KCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBIZWFkZXI6IFxsaWJzXHV0aWxzXGdsb2JhbFxnLmtybmsKIyBBdXRob3I6IGJsYW5kcmljZQojICAgRGVzY3JpcHRpb246IHNvbWUgZ2xvYmFsIHZhcnMgdGhhdCBvdGhlciBsaWJzIGNhbiByZWZlcmVuY2UgdG8gcmVkdWNlIGNhbGxzCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKCm51bSBnX3Rub3cgPSAwOwoKYWN0aW9uIGdfdXBkYXRlKG51bSBkZWx0YSl7CiAgICBnX3Rub3cgPSBHQU1FLlRJTUUubm93KCk7Cn0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgSGVhZGVyOiBcbGlic1xjb2xsaXNpb25zXEFBQkIua3JuawojIEF1dGhvcjogS0cwNyAobW9kaWZpZWQgYnkgYmxhbmRyaWNlKQojIERlc2NyaXB0aW9uOiBBQUJCIChheGlzLWFsaWduZWQgYm91bmRpbmcgYm94LWJveCkgY29sbGlzaW9uICsgcmVzb2x1dGlvbgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCm51bSBBQUJCX3cgPSA0Ljk7IyBwbGF5ZXIgd2lkdGgKbnVtIEFBQkJfYyA9IDg7IyBjcm91Y2hpbmcgaGVpZ2h0Cm51bSBBQUJCX0ggPSAxMTsjIHN0YW5kaW5nIGhlaWdodAoKbnVtIEFBQkJfWE5FRyA9IDB4MTsKbnVtIEFBQkJfWFBPUyA9IDB4MjsKbnVtIEFBQkJfWU5FRyA9IDB4NDsgI2hpdCAiZ3JvdW5kIgpudW0gQUFCQl9ZUE9TID0gMHg4OyAKbnVtIEFBQkJfWk5FRyA9IDB4MTA7Cm51bSBBQUJCX1pQT1MgPSAweDIwOwoKYm9vbCBhY3Rpb24gQUFCQl9pc0NvbGxpc2lvbihvYmogY3ViZTEsIG9iaiBjdWJlMikKewogICAgIyBBZGFwdGVkIGZyb20gaHR0cHM6Ly90dXRvcmlhbGVkZ2UubmV0L2dhbWVkZXYvYWFiYi1jb2xsaXNpb24tZGV0ZWN0aW9uLXR1dG9yaWFsLwogICAgbnVtIGR4ID0gTWF0aC5hYnMoKG51bSljdWJlMS5wb3NpdGlvbi54IC0gKG51bSljdWJlMi5wb3NpdGlvbi54KSAtICgobnVtKWN1YmUxLnNjYWxlLngvMiArIChudW0pY3ViZTIuc2NhbGUueC8yKTsKICAgIG51bSBkeSA9IE1hdGguYWJzKChudW0pY3ViZTEucG9zaXRpb24ueSArKG51bSljdWJlMS5zY2FsZS55LzIgLSAobnVtKWN1YmUyLnBvc2l0aW9uLnkgLSAobnVtKWN1YmUyLnNjYWxlLnkvMikgLSAoKG51bSljdWJlMS5zY2FsZS55LzIgKyAobnVtKWN1YmUyLnNjYWxlLnkvMik7CiAgICBudW0gZHogPSAoTWF0aC5hYnMoKG51bSljdWJlMS5wb3NpdGlvbi56IC0gKG51bSljdWJlMi5wb3NpdGlvbi56KSAtICgobnVtKWN1YmUxLnNjYWxlLnovMiArIChudW0pY3ViZTIuc2NhbGUuei8yKSk7CiAgICBpZiAoKGR4IDwgMCkgJiYgKGR5IDwgMCkgJiYgKGR6IDwgMCkpCiAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgCn0KCm9iaiBhY3Rpb24gQUFCQl9DYWxjdWxhdGVBYWJiRGlzdGFuY2VUbyhvYmogY3ViZTEsIG9iaiBjdWJlMikKewogICAgbnVtIGR4ID0gTWF0aC5hYnMoKG51bSljdWJlMS5wb3NpdGlvbi54IC0gKG51bSljdWJlMi5wb3NpdGlvbi54KSAtICgobnVtKWN1YmUxLnNjYWxlLngvMiArIChudW0pY3ViZTIuc2NhbGUueC8yKTsKICAgIG51bSBkeSA9IE1hdGguYWJzKChudW0pY3ViZTEucG9zaXRpb24ueSArKG51bSljdWJlMS5zY2FsZS55LzIgLSAobnVtKWN1YmUyLnBvc2l0aW9uLnkgLSAobnVtKWN1YmUyLnNjYWxlLnkvMikgLSAoKG51bSljdWJlMS5zY2FsZS55LzIgKyAobnVtKWN1YmUyLnNjYWxlLnkvMik7CiAgICBudW0gZHogPSAoTWF0aC5hYnMoKG51bSljdWJlMS5wb3NpdGlvbi56IC0gKG51bSljdWJlMi5wb3NpdGlvbi56KSAtICgobnVtKWN1YmUxLnNjYWxlLnovMiArIChudW0pY3ViZTIuc2NhbGUuei8yKSk7CgogICAgcmV0dXJuIHt4OmR4LHk6ZHksejpken07Cn0KCm51bSBBQUJCX3N0ID0gMzsjc3RhaXIgaGVpZ2h0CgpudW0gYWN0aW9uIEFBQkJfc2lkZShudW0gQywgbnVtIFMsIG51bSBpbnB1dCl7CglpZihpbnB1dCA8PSBDLVMpe3JldHVybiAtMTt9CglpZihpbnB1dCA+PSBDK1Mpe3JldHVybiAxO30KCXJldHVybiAwOwp9CgpvYmpbXSBhY3Rpb24gQUFCQl9yZXNvbHZlKG9iaiBjdWJlMSxvYmpbXSBjdWJlcykgewogICAgb2JqW10gY29sbGlzaW9ucyA9IG9ialtdOwogICAgbnVtIHRvdGFsY29sc2lkZSA9IDA7Cglmb3IobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgY3ViZXM7IGkrKyl7CiAgICAgICAgbnVtIGNvbHNpZGUgPSAwOwogICAgICAgIG9iaiBjb2xvYmogPSB7fTsKCiAgICAgICAgbnVtIHB4ID0gKG51bSkgY3ViZTEucG9zaXRpb24ueDsKICAgICAgICBudW0gcHkgPSAobnVtKSBjdWJlMS5wb3NpdGlvbi55OwogICAgICAgIG51bSBweiA9IChudW0pIGN1YmUxLnBvc2l0aW9uLno7CiAgICAgICAgbnVtIHZ4ID0gKG51bSkgY3ViZTEudmVsb2NpdHkueDsKICAgICAgICBudW0gdnkgPSAobnVtKSBjdWJlMS52ZWxvY2l0eS55OwogICAgICAgIG51bSB2eiA9IChudW0pIGN1YmUxLnZlbG9jaXR5Lno7CiAgICAgICAgCiAgICAgICAgbnVtIGNzeCA9IChudW0pIGN1YmUxLnNjYWxlLngvMjsKICAgICAgICBudW0gY3N5ID0gKG51bSkgY3ViZTEuc2NhbGUueS8yOwogICAgICAgIG51bSBjc3ogPSAobnVtKSBjdWJlMS5zY2FsZS56LzI7CgogICAgICAgIG9iaiB0Y3ViZSA9IGN1YmVzW2ldOwogICAgICAgIG51bSBjeCA9IChudW0pIHRjdWJlLnBvc2l0aW9uLng7CiAgICAgICAgbnVtIGN5ID0gKG51bSkgdGN1YmUucG9zaXRpb24ueTsKICAgICAgICBudW0gY3ogPSAobnVtKSB0Y3ViZS5wb3NpdGlvbi56OwogICAgICAgIG51bSBzeCA9IChudW0pIHRjdWJlLnNjYWxlLnggLyAyOwogICAgICAgIG51bSBzeSA9IChudW0pIHRjdWJlLnNjYWxlLnkgLyAyOwogICAgICAgIG51bSBzeiA9IChudW0pIHRjdWJlLnNjYWxlLnogLyAyOwogICAgICAgIG51bSBvcHggPSBweDsKICAgICAgICBudW0gb3B5ID0gcHk7CiAgICAgICAgbnVtIG9weiA9IHB6OwogICAgICAgIG51bSBvY3ggPSBjeDsKICAgICAgICBudW0gb2N5ID0gY3k7CiAgICAgICAgbnVtIG9jeiA9IGN6OwogICAgICAgIAogICAgICAgIGlmIChub3RFbXB0eSAob2JqKSBjdWJlMS5vZ3Bvcyl7CiAgICAgICAgICAgIG9weCA9IChudW0pY3ViZTEub2dwb3MueDsKICAgICAgICAgICAgb3B5ID0gKG51bSljdWJlMS5vZ3Bvcy55OwogICAgICAgICAgICBvcHogPSAobnVtKWN1YmUxLm9ncG9zLno7CiAgICAgICAgfSBpZiAobm90RW1wdHkgKG9iail0Y3ViZS5vZ3Bvcyl7CiAgICAgICAgICAgIG9jeCA9IChudW0pdGN1YmUub2dwb3MueDsKICAgICAgICAgICAgb2N5ID0gKG51bSl0Y3ViZS5vZ3Bvcy55OwogICAgICAgICAgICBvY3ogPSAobnVtKXRjdWJlLm9ncG9zLno7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICMgLXgKICAgICAgICBpZihweCA8PSBjeCArIHN4ICsgY3N4ICYmIG9weCA+PSBvY3ggKyBzeCArIGNzeCAmJiBBQUJCX3NpZGUoY3osIHN6ICsgY3N6LCBweikgPT0gMCAmJiBBQUJCX3NpZGUoY3kgKyBzeSwgc3kgKyBjc3ksIHB5ICsgY3N5KSA9PSAwKXsKICAgICAgICAgICAgaWYocHkgPj0gY3kgKyAyICogc3kgLSBBQUJCX3N0ICYmICgoYm9vbCkgY3ViZTEub25Hcm91bmQpKXsKICAgICAgICAgICAgICAgIGN1YmUxLnBvc2l0aW9uLnkgPSBjeSArIDIgKiBzeTsgCiAgICAgICAgICAgICAgICBjdWJlMS52ZWxvY2l0eS55ID0gKG5vdEVtcHR5IChvYmopdGN1YmUudmVsb2NpdHkpID8gKG51bSl0Y3ViZS52ZWxvY2l0eS55IDogMDsKICAgICAgICAgICAgICAgIGN1YmUxLm9uR3JvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIGN1YmUxLnBvc2l0aW9uLnggPSBjeCArIHN4ICsgY3N4OwogICAgICAgICAgICAgICAgY3ViZTEudmVsb2NpdHkueCA9IChub3RFbXB0eSAob2JqKXRjdWJlLnZlbG9jaXR5KSA/IChudW0pdGN1YmUudmVsb2NpdHkueCA6IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3ViZTEub25XYWxsID0gdHJ1ZTsKICAgICAgICAgICAgY29sc2lkZSB8PSBBQUJCX1hORUc7CiAgICAgICAgfQogICAgICAgICMgK3gKICAgICAgICBpZihweCA+PSBjeCAtIHN4IC0gY3N4ICYmIG9weCA8PSBvY3ggLSBzeCAtIGNzeCAmJiBBQUJCX3NpZGUoY3osIHN6ICsgY3N6LCBweikgPT0gMCAmJiBBQUJCX3NpZGUoY3kgKyBzeSwgc3kgKyBjc3ksIHB5ICsgY3N5KSA9PSAwKXsKICAgICAgICAgICAgaWYocHkgPj0gY3kgKyAyICogc3kgLSBBQUJCX3N0ICYmICgoYm9vbCkgY3ViZTEub25Hcm91bmQpKXsKICAgICAgICAgICAgICAgIGN1YmUxLnBvc2l0aW9uLnkgPSBjeSArIDIgKiBzeTsgCiAgICAgICAgICAgICAgICBjdWJlMS52ZWxvY2l0eS55ID0gKG5vdEVtcHR5IChvYmopdGN1YmUudmVsb2NpdHkpID8gKG51bSl0Y3ViZS52ZWxvY2l0eS55IDogMDsKICAgICAgICAgICAgICAgIGN1YmUxLm9uR3JvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIGN1YmUxLnBvc2l0aW9uLnggPSBjeCAtIHN4IC0gY3N4OwogICAgICAgICAgICAgICAgY3ViZTEudmVsb2NpdHkueCA9IChub3RFbXB0eSAob2JqKXRjdWJlLnZlbG9jaXR5KSA/IChudW0pdGN1YmUudmVsb2NpdHkueCA6IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3ViZTEub25XYWxsID0gdHJ1ZTsKICAgICAgICAgICAgY29sc2lkZSB8PSBBQUJCX1hQT1M7CiAgICAgICAgfQogICAgICAgICMgLXkKICAgICAgICBpZihweSA8PSBjeSArIDIgKiBzeSAmJiBvcHkgPj0gb2N5ICsgMiAqIHN5ICYmIEFBQkJfc2lkZShjeCwgc3ggKyBjc3gsIHB4KSA9PSAwICYmIEFBQkJfc2lkZShjeiwgc3ogKyBjc3osIHB6KSA9PSAwKXsKICAgICAgICAgICAgY3ViZTEucG9zaXRpb24ueSA9IGN5ICsgMiAqIHN5OwogICAgICAgICAgICBjdWJlMS52ZWxvY2l0eS55ID0gKG5vdEVtcHR5IChvYmopdGN1YmUudmVsb2NpdHkpID8gKG51bSl0Y3ViZS52ZWxvY2l0eS55IDogMDsKICAgICAgICAgICAgY3ViZTEub25Hcm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWU5FRzsKICAgICAgICB9CiAgICAgICAgIyAreQogICAgICAgIGlmKHB5ICsgMiAqIGNzeSA+PSBjeSAmJiBvcHkgKyAyICogY3N5IDw9IG9jeSAmJiBBQUJCX3NpZGUoY3gsIHN4ICsgY3N4LCBweCkgPT0gMCAmJiBBQUJCX3NpZGUoY3osIHN6ICsgY3N6LCBweikgPT0gMCl7CiAgICAgICAgICAgIGN1YmUxLnBvc2l0aW9uLnkgPSBjeSAtIDIgKiBjc3k7CiAgICAgICAgICAgIGN1YmUxLnZlbG9jaXR5LnkgPSAobm90RW1wdHkgKG9iail0Y3ViZS52ZWxvY2l0eSkgPyAobnVtKXRjdWJlLnZlbG9jaXR5LnkgOiAwOwogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWVBPUzsKICAgICAgICB9CiAgICAgICAgIyAtegogICAgICAgIGlmKHB6IDw9IGN6ICsgc3ogKyBjc3ogJiYgb3B6ID49IG9jeiArIHN6ICsgY3N6ICYmIEFBQkJfc2lkZShjeCwgc3ggKyBjc3gsIHB4KSA9PSAwICYmIEFBQkJfc2lkZShjeSArIHN5LCBzeSArIGNzeiwgcHkgKyBjc3opID09IDApewogICAgICAgICAgICBpZihweSA+PSBjeSArIDIgKiBzeSAtIEFBQkJfc3QgJiYgKChib29sKSBjdWJlMS5vbkdyb3VuZCkpewogICAgICAgICAgICAgICAgY3ViZTEucG9zaXRpb24ueSA9IGN5ICsgMiAqIHN5OyAKICAgICAgICAgICAgICAgIGN1YmUxLnZlbG9jaXR5LnkgPSAobm90RW1wdHkgKG9iail0Y3ViZS52ZWxvY2l0eSkgPyAobnVtKXRjdWJlLnZlbG9jaXR5LnkgOiAwOwogICAgICAgICAgICAgICAgY3ViZTEub25Hcm91bmQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICBjdWJlMS5wb3NpdGlvbi56ID0gY3ogKyBzeiArIGNzejsKICAgICAgICAgICAgICAgIGN1YmUxLnZlbG9jaXR5LnogPSAobm90RW1wdHkgKG9iail0Y3ViZS52ZWxvY2l0eSkgPyAobnVtKXRjdWJlLnZlbG9jaXR5LnogOiAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBjdWJlMS5vbldhbGwgPSB0cnVlOwogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWk5FRzsKICAgICAgICB9CiAgICAgICAgIyAregogICAgICAgIGlmKHB6ID49IGN6IC0gc3ogLSBjc3ogJiYgb3B6IDw9IG9jeiAtIHN6IC0gY3N6ICYmIEFBQkJfc2lkZShjeCwgc3ggKyBjc3gsIHB4KSA9PSAwICYmIEFBQkJfc2lkZShjeSArIHN5LCBzeSArIGNzeSwgcHkgKyBjc3kpID09IDApewogICAgICAgICAgICBpZihweSA+PSBjeSArIDIgKiBzeSAtIEFBQkJfc3QgJiYgKChib29sKSBjdWJlMS5vbkdyb3VuZCkpewogICAgICAgICAgICAgICAgY3ViZTEucG9zaXRpb24ueSA9IGN5ICsgMiAqIHN5OyAKICAgICAgICAgICAgICAgIGN1YmUxLnZlbG9jaXR5LnkgPSAobm90RW1wdHkgKG9iail0Y3ViZS52ZWxvY2l0eSkgPyAobnVtKXRjdWJlLnZlbG9jaXR5LnkgOiAwOyAKICAgICAgICAgICAgICAgIGN1YmUxLm9uR3JvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgY3ViZTEucG9zaXRpb24ueiA9IGN6IC0gc3ogLSBjc3o7CiAgICAgICAgICAgICAgICBjdWJlMS52ZWxvY2l0eS56ID0gKG5vdEVtcHR5IChvYmopdGN1YmUudmVsb2NpdHkpID8gKG51bSl0Y3ViZS52ZWxvY2l0eS56IDogMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdWJlMS5vbldhbGwgPSB0cnVlOwogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWlBPUzsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbHNpZGUgPiAwKXsKICAgICAgICAgICAgY29sb2JqID0gdGN1YmU7CiAgICAgICAgICAgIGFkZFRvIGNvbGxpc2lvbnMge2NvbHNpZGU6Y29sc2lkZSxjb2xvYmo6Y29sb2JqfTsKICAgICAgICB9IAogICAgICAgIHRvdGFsY29sc2lkZSB8PSBjb2xzaWRlOwoJfQogICAgaWYgKG5vdEVtcHR5IChvYmopY3ViZTEub2dwb3MpIHsKICAgICAgICBjdWJlMS5vZ3Bvcy54ID0gKG51bSkgY3ViZTEucG9zaXRpb24ueCArIDA7CiAgICAgICAgY3ViZTEub2dwb3MueSA9IChudW0pIGN1YmUxLnBvc2l0aW9uLnkgKyAwOwogICAgICAgIGN1YmUxLm9ncG9zLnogPSAobnVtKSBjdWJlMS5wb3NpdGlvbi56ICsgMDsKICAgIH0gZWxzZSB7CiAgICAgICAgY3ViZTEub2dwb3MgPSAKICAgICAgICB7CiAgICAgICAgICAgIHg6KG51bSljdWJlMS5wb3NpdGlvbi54ICsgMCwKICAgICAgICAgICAgeToobnVtKWN1YmUxLnBvc2l0aW9uLnkgKyAwLAogICAgICAgICAgICB6OihudW0pY3ViZTEucG9zaXRpb24ueiArIDAKICAgICAgICB9OwogICAgfQogICAgIyBHQU1FLmxvZyhjb2xsaXNpb25zKTsKICAgIHJldHVybiBjb2xsaXNpb25zOwoJCn0KCm9ialtdIGFjdGlvbiBBQUJCX2RldGVjdChvYmogY3ViZTEsb2JqW10gY3ViZXMpIHsKICAgIG9ialtdIGNvbGxpc2lvbnMgPSBvYmpbXTsKICAgIG51bSB0b3RhbGNvbHNpZGUgPSAwOwoJZm9yKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIGN1YmVzOyBpKyspewogICAgICAgIG51bSBjb2xzaWRlID0gMDsKICAgICAgICBvYmogY29sb2JqID0ge307CgogICAgICAgIG51bSBweCA9IChudW0pIGN1YmUxLnBvc2l0aW9uLng7CiAgICAgICAgbnVtIHB5ID0gKG51bSkgY3ViZTEucG9zaXRpb24ueTsKICAgICAgICBudW0gcHogPSAobnVtKSBjdWJlMS5wb3NpdGlvbi56OwogICAgICAgIG51bSB2eCA9IChudW0pIGN1YmUxLnZlbG9jaXR5Lng7CiAgICAgICAgbnVtIHZ5ID0gKG51bSkgY3ViZTEudmVsb2NpdHkueTsKICAgICAgICBudW0gdnogPSAobnVtKSBjdWJlMS52ZWxvY2l0eS56OwogICAgICAgIAogICAgICAgIG51bSBjc3ggPSAobnVtKSBjdWJlMS5zY2FsZS54LzI7CiAgICAgICAgbnVtIGNzeSA9IChudW0pIGN1YmUxLnNjYWxlLnkvMjsKICAgICAgICBudW0gY3N6ID0gKG51bSkgY3ViZTEuc2NhbGUuei8yOwoKICAgICAgICBvYmogdGN1YmUgPSBjdWJlc1tpXTsKICAgICAgICBudW0gY3ggPSAobnVtKSB0Y3ViZS5wb3NpdGlvbi54OwogICAgICAgIG51bSBjeSA9IChudW0pIHRjdWJlLnBvc2l0aW9uLnk7CiAgICAgICAgbnVtIGN6ID0gKG51bSkgdGN1YmUucG9zaXRpb24uejsKICAgICAgICBudW0gc3ggPSAobnVtKSB0Y3ViZS5zY2FsZS54IC8gMjsKICAgICAgICBudW0gc3kgPSAobnVtKSB0Y3ViZS5zY2FsZS55IC8gMjsKICAgICAgICBudW0gc3ogPSAobnVtKSB0Y3ViZS5zY2FsZS56IC8gMjsKICAgICAgICBudW0gb3B4ID0gcHg7CiAgICAgICAgbnVtIG9weSA9IHB5OwogICAgICAgIG51bSBvcHogPSBwejsKICAgICAgICBudW0gb2N4ID0gY3g7CiAgICAgICAgbnVtIG9jeSA9IGN5OwogICAgICAgIG51bSBvY3ogPSBjejsKICAgICAgICAKICAgICAgICBpZiAobm90RW1wdHkgKG9iaikgY3ViZTEub2dwb3MpewogICAgICAgICAgICBvcHggPSAobnVtKWN1YmUxLm9ncG9zLng7CiAgICAgICAgICAgIG9weSA9IChudW0pY3ViZTEub2dwb3MueTsKICAgICAgICAgICAgb3B6ID0gKG51bSljdWJlMS5vZ3Bvcy56OwogICAgICAgIH0gaWYgKG5vdEVtcHR5IChvYmopdGN1YmUub2dwb3MpewogICAgICAgICAgICBvY3ggPSAobnVtKXRjdWJlLm9ncG9zLng7CiAgICAgICAgICAgIG9jeSA9IChudW0pdGN1YmUub2dwb3MueTsKICAgICAgICAgICAgb2N6ID0gKG51bSl0Y3ViZS5vZ3Bvcy56OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAjIC14CiAgICAgICAgaWYocHggPD0gY3ggKyBzeCArIGNzeCAmJiBvcHggPj0gb2N4ICsgc3ggKyBjc3ggJiYgQUFCQl9zaWRlKGN6LCBzeiArIGNzeiwgcHopID09IDAgJiYgQUFCQl9zaWRlKGN5ICsgc3ksIHN5ICsgY3N5LCBweSArIGNzeSkgPT0gMCl7CiAgICAgICAgICAgIGlmKHB5ID49IGN5ICsgMiAqIHN5IC0gQUFCQl9zdCAmJiAoKGJvb2wpIGN1YmUxLm9uR3JvdW5kKSl7CiAgICAgICAgICAgICAgICBjdWJlMS5vbkdyb3VuZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3ViZTEub25XYWxsID0gdHJ1ZTsKICAgICAgICAgICAgY29sc2lkZSB8PSBBQUJCX1hORUc7CiAgICAgICAgfQogICAgICAgICMgK3gKICAgICAgICBpZihweCA+PSBjeCAtIHN4IC0gY3N4ICYmIG9weCA8PSBvY3ggLSBzeCAtIGNzeCAmJiBBQUJCX3NpZGUoY3osIHN6ICsgY3N6LCBweikgPT0gMCAmJiBBQUJCX3NpZGUoY3kgKyBzeSwgc3kgKyBjc3ksIHB5ICsgY3N5KSA9PSAwKXsKICAgICAgICAgICAgaWYocHkgPj0gY3kgKyAyICogc3kgLSBBQUJCX3N0ICYmICgoYm9vbCkgY3ViZTEub25Hcm91bmQpKXsKICAgICAgICAgICAgICAgIGN1YmUxLm9uR3JvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdWJlMS5vbldhbGwgPSB0cnVlOwogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWFBPUzsKICAgICAgICB9CiAgICAgICAgIyAteQogICAgICAgIGlmKHB5IDw9IGN5ICsgMiAqIHN5ICYmIG9weSA+PSBvY3kgKyAyICogc3kgJiYgQUFCQl9zaWRlKGN4LCBzeCArIGNzeCwgcHgpID09IDAgJiYgQUFCQl9zaWRlKGN6LCBzeiArIGNzeiwgcHopID09IDApewogICAgICAgICAgICBjdWJlMS5vbkdyb3VuZCA9IHRydWU7CiAgICAgICAgICAgIGNvbHNpZGUgfD0gQUFCQl9ZTkVHOwogICAgICAgIH0KICAgICAgICAjICt5CiAgICAgICAgaWYocHkgKyAyICogY3N5ID49IGN5ICYmIG9weSArIDIgKiBjc3kgPD0gb2N5ICYmIEFBQkJfc2lkZShjeCwgc3ggKyBjc3gsIHB4KSA9PSAwICYmIEFBQkJfc2lkZShjeiwgc3ogKyBjc3osIHB6KSA9PSAwKXsKICAgICAgICAgICAgY29sc2lkZSB8PSBBQUJCX1lQT1M7CiAgICAgICAgfQogICAgICAgICMgLXoKICAgICAgICBpZihweiA8PSBjeiArIHN6ICsgY3N6ICYmIG9weiA+PSBvY3ogKyBzeiArIGNzeiAmJiBBQUJCX3NpZGUoY3gsIHN4ICsgY3N4LCBweCkgPT0gMCAmJiBBQUJCX3NpZGUoY3kgKyBzeSwgc3kgKyBjc3osIHB5ICsgY3N6KSA9PSAwKXsKICAgICAgICAgICAgaWYocHkgPj0gY3kgKyAyICogc3kgLSBBQUJCX3N0ICYmICgoYm9vbCkgY3ViZTEub25Hcm91bmQpKXsKICAgICAgICAgICAgICAgIGN1YmUxLm9uR3JvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdWJlMS5vbldhbGwgPSB0cnVlOwogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWk5FRzsKICAgICAgICB9CiAgICAgICAgIyAregogICAgICAgIGlmKHB6ID49IGN6IC0gc3ogLSBjc3ogJiYgb3B6IDw9IG9jeiAtIHN6IC0gY3N6ICYmIEFBQkJfc2lkZShjeCwgc3ggKyBjc3gsIHB4KSA9PSAwICYmIEFBQkJfc2lkZShjeSArIHN5LCBzeSArIGNzeSwgcHkgKyBjc3kpID09IDApewogICAgICAgICAgICBpZihweSA+PSBjeSArIDIgKiBzeSAtIEFBQkJfc3QgJiYgKChib29sKSBjdWJlMS5vbkdyb3VuZCkpewogICAgICAgICAgICAgICAgY3ViZTEub25Hcm91bmQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1YmUxLm9uV2FsbCA9IHRydWU7CiAgICAgICAgICAgIGNvbHNpZGUgfD0gQUFCQl9aUE9TOwogICAgICAgIH0KICAgICAgICBpZiAoY29sc2lkZSA+IDApewogICAgICAgICAgICBjb2xvYmogPSB0Y3ViZTsKICAgICAgICAgICAgYWRkVG8gY29sbGlzaW9ucyB7Y29sc2lkZTpjb2xzaWRlLGNvbG9iajpjb2xvYmp9OwogICAgICAgIH0gCiAgICAgICAgdG90YWxjb2xzaWRlIHw9IGNvbHNpZGU7Cgl9CiAgICBpZiAobm90RW1wdHkgKG9iailjdWJlMS5vZ3BvcykgewogICAgICAgIGN1YmUxLm9ncG9zLnggPSAobnVtKSBjdWJlMS5wb3NpdGlvbi54ICsgMDsKICAgICAgICBjdWJlMS5vZ3Bvcy55ID0gKG51bSkgY3ViZTEucG9zaXRpb24ueSArIDA7CiAgICAgICAgY3ViZTEub2dwb3MueiA9IChudW0pIGN1YmUxLnBvc2l0aW9uLnogKyAwOwogICAgfSBlbHNlIHsKICAgICAgICBjdWJlMS5vZ3BvcyA9IAogICAgICAgIHsKICAgICAgICAgICAgeDoobnVtKWN1YmUxLnBvc2l0aW9uLnggKyAwLAogICAgICAgICAgICB5OihudW0pY3ViZTEucG9zaXRpb24ueSArIDAsCiAgICAgICAgICAgIHo6KG51bSljdWJlMS5wb3NpdGlvbi56ICsgMAogICAgICAgIH07CiAgICB9CiAgICAjIEdBTUUubG9nKGNvbGxpc2lvbnMpOwogICAgcmV0dXJuIGNvbGxpc2lvbnM7CgkKfQoKCm9ialtdIGFjdGlvbiBBQUJCX3Jlc29sdmVwbHIob2JqIHBscixib29sIGNyb3VjaCxvYmpbXSBjdWJlcyl7CiAgICBpZiAoY3JvdWNoKXsKICAgICAgICBwbHIuc2NhbGUgPSAKICAgICAgICB7CiAgICAgICAgICAgIHg6QUFCQl93LAogICAgICAgICAgICB5OkFBQkJfYywKICAgICAgICAgICAgejpBQUJCX3cKICAgICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgICBwbHIuc2NhbGU9CiAgICAgICAgewogICAgICAgICAgICB4OkFBQkJfdywKICAgICAgICAgICAgeTpBQUJCX0gsCiAgICAgICAgICAgIHo6QUFCQl93CiAgICAgICAgfTsKICAgIH0KICAgIHJldHVybiBBQUJCX3Jlc29sdmUocGxyLGN1YmVzKTsKfQoKYWN0aW9uIEFBQkJfb25QbGF5ZXJTcGF3bihzdHIgaWQpIHsKICAgIG9iaiBwbHIgPSBHQU1FLlBMQVlFUlMuZmluZEJ5SUQoaWQpOwogICAgcGxyLnNjYWxlID0ge3g6QUFCQl93LHk6QUFCQl93LHo6QUFCQl9IfTsKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgSGVhZGVyOiBcbGlic1xmbG9hdFxkdHlwZXMua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogY3VzdG9tIGZsb2F0IGRhdGEgdHlwZXMtLT4gYmluYXJ5IHJlcHJlc2VudGF0aW9uIGNhbGN1bGF0aW9ucy4KIyAgIEdvYWwgd2FzIHRvIHBhY2sgZmxvYXQgZGF0YSBpbnRvIDE2LWJpdHMgYW5kIHNlbmQgb3ZlciBOZXR3b3JrTWVzc2FnZSAKIyAgIChtdWNoIHNtYWxsZXIgdGhhbiBBU0NJSSBzdHJpbmcgcmVwcmVzZW50YXRpb24pCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpudW0gYWN0aW9uIGR0eXBlc19maW5kTVNCTG9jKG51bSB2KXsKCSMgdiBiZXR0ZXIgYmUgYW4gaW50ZWdlciB1IGR1bWJvCgludW0gciA9IC0xOwoJIyB2ID0gdiA+PiAxOwoJd2hpbGUgKHYgPiAwKSB7CgkJcisrOwoJCXYgPSB2ID4+IDE7Cgl9CglyZXR1cm4gcjsKfQpudW0gYWN0aW9uIGR0eXBlc19mbW9kKG51bSB4LCBudW0gcil7CglyZXR1cm4geCAtIChyKk1hdGguZmxvb3IoeCAvIHIpKTsJCn0Kc3RyIGFjdGlvbiBkdHlwZXNfcHJpbnRCaW5hcnkobnVtIGYpewoJc3RyIHJldHN0ciA9ICIiOwoJZm9yIChudW0gaSA9IDMyLTE7IGkgPj0gMDsgaS0tKSB7CgkJcmV0c3RyICs9IHRvU3RyIChmID4+IGkgJiAweDEpOwoJfQoJcmV0dXJuIHJldHN0cjsKfQpudW0gYWN0aW9uIGR0eXBlc19vbmVzKG51bSBmKXsKCW51bSByZXRudW0gPSAwOwoJZm9yIChudW0gaSA9IDA7IGkgPCBmOyBpKyspewoJCXJldG51bSA9IChyZXRudW0gPDwgMSkgfCAxOwoJfQoJcmV0dXJuIHJldG51bTsJCn0KCgojIGFkYXB0ZWQgZnJvbSBJRUVFIDc1NCBTdGFuZGFyZCBmb3IgU2luZ2xlIFByZWNpc2lvbiAzMiBiaXQgZmxvYXRpbmcKIyBidXQgYWxsb3dzIGZvciB5b3UgdG8gc2VsZWN0ICMgb2YgZXhwb25lbnQgLyBtYW50aXNzYSBiaXRzCiMgaGFsZi1wcmVjaXNpb24gKDE2IGJpdCksIHNpbmdsZS1wcmVjaXNpb24gKDMyIGJpdCkKIyBudW0gZHR5cGVzX01BWF9CSVRTID0gMzI7IG51bSBCSVRTX0VYUCA9IDg7Cm51bSBkdHlwZXNfTUFYX0JJVFMgPSAxNjsgbnVtIEJJVFNfRVhQID0gNTsgCiNkb24ndCBjaGFuZ2UgdG8gc29tZXRoaW5nIGxpa2UgMTYtMy4uIGVycm9yIHVwIHRvIDMwIHVuaXRzIG9ic2VydmVkCgojIChlLmcuIDMyLWJpdCkgZnJvbSBsZWZ0IHRvIHJpZ2h0OgojIDEgYml0IC0gU2lnbiBiaXQgKDIncyBjb21wbGVtZW50KSArPSAoLTEpICogMl5wbGFjZSBpbiBleHBvbmVudAojIDggYml0cyAtIEV4cG9uZW50ICgyXmUpCiMgMjMgYml0cyAtIE1hbnRpc3NhIChwYXJ0IGFmdGVyIGRlY2ltYWwpCiMgcmFuZ2UgPSAyXkJJVFNfRVhQIAojIHByZWNpc2lvbiA9IDEvKDJeZHR5cGVzX0JJVFNfTUFOVCkKCm51bSBkdHlwZXNfQklBUyA9IDIqKihCSVRTX0VYUC0xKS0xOwpudW0gZHR5cGVzX0JJVFNfTUFOVCA9IGR0eXBlc19NQVhfQklUUyAtIDEgLSBCSVRTX0VYUDsKbnVtIGR0eXBlc19TSUdOX0xPQyA9IGR0eXBlc19NQVhfQklUUy0xOwoKbnVtIGFjdGlvbiBkdHlwZXNfbnVtVG9GbG9hdDE2KG51bSBkYXRhKSB7CgkjIDEuIGRldGVybWluZSB0aGUgc2lnbiBiaXQKCW51bSBzaWduYml0ID0gMDsKCWlmIChkYXRhIDwgMCkge3NpZ25iaXQgPSAxOyBkYXRhID0gLWRhdGE7fQogICAgaWYgKGRhdGEgPT0gMCkge3JldHVybiAwO30KCSMgMi4gQ29udmVydCAgd2hvbGUgLyBkZWNpbWFsIGJpdHMgdG8gcHVyZSBiaW5hcnkKCW51bSB3aG9sZSA9IE1hdGguZmxvb3IoZGF0YSk7ICMgZmxvb3IgaXQgc28gaXQncyBqdXN0IGFuIGludGVnZXIgKHdpbGwgYmUgYmV0d2VlbiAwIGFuZCAyXmJpdHNleHApLiBtYXggaXMgdGhlIDIgXiBiaXRzIG9mIHRoZSBleHBvbmVudAoJbnVtIGRlY2ltYWwgPSAoZGF0YSAtIHdob2xlID4gMCkgPyBkYXRhIC0gd2hvbGUgOiAwOwoJbnVtIGRlY2JpdCA9IDB4MDAwOyAKCWZvciAobnVtIGkgPSAwOyBpIDwgZHR5cGVzX0JJVFNfTUFOVDsgaSsrKXsgIyBjb252ZXJ0IGRlY2ltYWxzIGludG8gYmluYXJ5CgkJZGVjaW1hbCAqPSAyOwoJCW51bSB0ZGVjYml0ID0gKGRlY2ltYWwgPj0gMSA/IDEgOiAwKTsKCQlkZWNiaXQgfD0gIHRkZWNiaXQgPDwgKGR0eXBlc19CSVRTX01BTlQtMS1pKTsgIyAxMiAtIGkgCgkJaWYgKGRlY2ltYWwgPj0gMSkge2RlY2ltYWwgLT0xO30KCX0KCQkjIEdBTUUubG9nKCJkZWNiaXQiLGR0eXBlc19wcmludEJpbmFyeShkZWNiaXQpKTsKCgludW0gcHVyYmluYXJ5ID0gKHdob2xlIDw8IGR0eXBlc19CSVRTX01BTlQpIHwgZGVjYml0OwoJCSMgR0FNRS5sb2coInB1cmJpbmFyeSIsZHR5cGVzX3ByaW50QmluYXJ5KHB1cmJpbmFyeSkpOwoJCSMgR0FNRS5sb2coImR0eXBlc19maW5kTVNCTG9jKHB1cmJpbmFyeSkiLGR0eXBlc19maW5kTVNCTG9jKHB1cmJpbmFyeSkpOwoJCgkjIDMuIG5vcm1hbGl6ZSB0byBkZXRlcm1pbmUgbWFudGlzc2EgYW5kIHVuYmlhc2VkIGV4cG9uZW50CgludW0gdW5iaWFzZWRleHAgPSBkdHlwZXNfZmluZE1TQkxvYyhwdXJiaW5hcnkpIC0gZHR5cGVzX0JJVFNfTUFOVDsKCQkjIEdBTUUubG9nKCJ1bmJpYXNlZGV4cCIsdW5iaWFzZWRleHApOwoJIyA0LiBkZXRlcm1pbmUgYmlhc2VkIGV4cG9uZW50CgludW0gYmlhc2VkZXhwID0gdW5iaWFzZWRleHAgKyBkdHlwZXNfQklBUzsKCSMgNS4gcmVtb3ZlIGxlYWRpbmcgMSAoTVNCKQoJCSMgYWxpZ24gZmlyc3QKCW51bSBtYW50aXNzYSA9IHB1cmJpbmFyeTsKCW51bSBhbGlnbm1hbnRpc3NhID0gKGR0eXBlc19CSVRTX01BTlQtMSktZHR5cGVzX2ZpbmRNU0JMb2MobWFudGlzc2EpOwoJaWYgKGFsaWdubWFudGlzc2EgPiAwKSB7CgkJbWFudGlzc2EgPSBtYW50aXNzYSA8PCBhbGlnbm1hbnRpc3NhOwoJfSBlbHNlIHsKCQltYW50aXNzYSA9IG1hbnRpc3NhID4+ICgtMSAqIGFsaWdubWFudGlzc2EpOwoJfQoJbWFudGlzc2EgPSAobWFudGlzc2EgXiAoMSA8PCAoZHR5cGVzX2ZpbmRNU0JMb2MobWFudGlzc2EpKSkpIDw8IDE7ICMgcmVtb3ZlIGxlYWRpbmcgMQoJCSMgR0FNRS5sb2coIm1hbnRpc3NhOiIsZHR5cGVzX3ByaW50QmluYXJ5KG1hbnRpc3NhKSk7CgkJIyBHQU1FLmxvZygibGVmdC1zaGlmdCBieToiLGFsaWdubWFudGlzc2EpOwkKCW51bSBmbG9hdDE2ID0gKHNpZ25iaXQgPDwgZHR5cGVzX1NJR05fTE9DKSB8IChiaWFzZWRleHAgPDwgZHR5cGVzX0JJVFNfTUFOVCkgfCAoIG1hbnRpc3NhICk7CglyZXR1cm4gZmxvYXQxNjsKfQoKbnVtIGFjdGlvbiBkdHlwZXNfZmxvYXQxNlRvTnVtKG51bSBmKSB7CglpZiAoZiA9PSAwKSB7cmV0dXJuIDA7fQogICAgIyBEZXRlcm1pbmUgc2lnbgoJbnVtIHNpZ24gPSAoKChmID4+IGR0eXBlc19TSUdOX0xPQykgJiAweDEpID4gMCkgPyAtMSA6IDE7CgkjIERldGVybWluZSBleHBvbmVudCAyKmUgCgludW0gZXhwID0gKGYgPj4gZHR5cGVzX0JJVFNfTUFOVCkgJiBkdHlwZXNfb25lcyhCSVRTX0VYUCk7IAoJZXhwIC09IGR0eXBlc19CSUFTOwoJIyBDb252ZXJ0IG1hbnRpc3NhIHRvIGRlbmFyeQoJbnVtIG1hbnRpc3NhID0gZiAmIGR0eXBlc19vbmVzKGR0eXBlc19CSVRTX01BTlQpOwoJIyBHQU1FLmxvZygibWFudGlzc2E6ICIsIGR0eXBlc19wcmludEJpbmFyeShtYW50aXNzYSkpOwoJbnVtIG1hbnRkZW4gPSAwOwoJZm9yIChudW0gaSA9IGR0eXBlc19maW5kTVNCTG9jKG1hbnRpc3NhKTsgaSA+PTAgOyBpLS0pIHsKCQludW0gdG1hbiA9IDEvKDIqKihkdHlwZXNfQklUU19NQU5ULWkpKSAqICgobWFudGlzc2EgPj4gaSkgJiAweDEpOwoJCW1hbnRkZW4gKz0gdG1hbjsKCQkKCX0KCW1hbnRkZW4gKz0gMTsgIyBhZGQgMSBiYWNrIAoJbnVtIFJhZCA9IHNpZ24gKiBtYW50ZGVuICogKDIgKiogZXhwKTsKCXJldHVybiBSYWQ7Cn0KCm51bSBhY3Rpb24gZHR5cGVzX251bVRvVWludDE2KG51bSB4KXsKCXJldHVybiAoeCAmIDB4RkZGRik7ICMgY2FwIDY1NTM2IAp9CgpudW0gYWN0aW9uIGR0eXBlc19udW1Ub0ludDE2KG51bSB4KXsKCSMgcmV0dXJuICh4ICYgMHhGRik7ICMgY2FwIDY1NTM2IAoJbnVtIHJldG51bSA9IDA7Cgl4ID0gTWF0aC5yb3VuZCh4KTsKCXggPSAoeCA+IDMyNzY3KSA/IDMyNzY3IDogeDsKCXggPSAoeCA8IC0zMjc2NykgPyAtMzI3NjcgOiB4OwoJIyBjYXAgdG8gbGFyZ2VzdCAvIHNtYWxsZXN0IGludCBzaXplCgoJbnVtIHNpZ24gPSB4IDwgMCA/IDEgOiAwOwoKCWlmIChzaWduID09IDEpIHsKCQl4ID0gLXg7Cgl9CglyZXRudW0gfD0gc2lnbiA8PCAxNTsKCgludW0gaSA9IDE0OyAjIDE1IC0gMQoJd2hpbGUgKHggPiAwKSB7CgkJaWYgKHggLyAoMioqaSkgPj0gMSkgewoJCQlyZXRudW0gfD0gICgxIDw8IGkpOwoJCQl4LT0gKDIqKmkpOwoJCX0KCQlpLS07Cgl9CglyZXR1cm4gcmV0bnVtOwp9CgpudW1bXSBhY3Rpb24gZHR5cGVzX251bVRvX3VpbnQxNkJ5dGVBcnJheShudW0gZGF0YSkgewoJZGF0YSA9IE1hdGgucm91bmQoZGF0YSk7CgludW1bXSByZXRBcnJheSA9IG51bVtdOwoJYWRkVG8gcmV0QXJyYXkgKGRhdGEgPj4gOCkgJiAweGZmOwoJYWRkVG8gcmV0QXJyYXkgKGRhdGEgPj4gMCkgJiAweGZmOwoJCglyZXR1cm4gcmV0QXJyYXk7Cgp9CgpudW0gYWN0aW9uIGR0eXBlc19tZXJnZTJCeXRlcyhudW0gYSxudW0gYikgewoJcmV0dXJuIChiIDw8IDgpIHwgYTsKfQoKbnVtIGFjdGlvbiBkdHlwZXNfSW50MTZUb051bShudW0gYmluKSB7CgkjIG51bSBiaW4gPSAoYiA8PCAweGZmKSB8IGE7CgludW0gc2lnbiA9ICgoYmluICYgMHg4MDAwKSA+IDApID8gLTEgOiAxOwoJbnVtIGRlbmFyeSA9IGJpbiAmIDB4N0ZGRjsKCglyZXR1cm4gc2lnbiAqIGRlbmFyeTsKfQoKIyBpbnQgTnVtYmVycyB0byBieXRlIGFycmF5Cm51bVtdIGFjdGlvbiBkdHlwZXNfaW50MTZ0b0J5dGVBcnJheShudW0gZGF0YSl7CglyZXR1cm4gbnVtWygoZGF0YSA+PiAwKSAmIDB4ZmYpLChkYXRhID4+IDgpICYgMHhmZl07Cn0KCm51bVtdIGFjdGlvbiBkdHlwZXNfaW50MzJ0b0J5dGVBcnJheShudW0gZGF0YSl7CgludW1bXSByZXRhcnIgPSBudW1bXTsKCWFkZFRvIHJldGFyciAoZGF0YSA+PiAwKSAmIDB4ZmY7IAoJYWRkVG8gcmV0YXJyIChkYXRhID4+IDgpICYgMHhmZjsgCglhZGRUbyByZXRhcnIgKGRhdGEgPj4gMTYpICYgMHhmZjsgCglhZGRUbyByZXRhcnIgKGRhdGEgPj4gMjQpICYgMHhmZjsgCglyZXR1cm4gcmV0YXJyOwp9CgpudW1bXSBhY3Rpb24gZHR5cGVzX0NvbG9yVG9CeXRlQXJyYXkobnVtIGNvbG9yKSB7CgludW1bXSByZXRBcnJheSA9IG51bVtdOwoJYWRkVG8gcmV0QXJyYXkgKGNvbG9yID4+IDApICYgMHhmZjsKCWFkZFRvIHJldEFycmF5IChjb2xvciA+PiA4KSAmIDB4ZmY7CglhZGRUbyByZXRBcnJheSAoY29sb3IgPj4gMTYpICYgMHhmZjsKCQoJcmV0dXJuIHJldEFycmF5Owp9CgpzdHIgZHR5cGVzX2FscGhhYmV0ID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5ISMkJSYoKSorLC4vOjs8PT4/QFtdXl9ge3x9fi0iOwoKIyBSZWN1cnNpb24gZHVlIHRvIGxvb3AgbGltaXRzCm51bSBhY3Rpb24gZHR5cGVzX2dldFZhbHVlKHN0ciBjLCBudW0gaW5kZXgpIHsKCWlmKGluZGV4ID49IGxlbmd0aE9mIGR0eXBlc19hbHBoYWJldCkgewoJCXJldHVybiAtMTsKCX0KCQoJaWYoZHR5cGVzX2FscGhhYmV0W2luZGV4XSA9PSBjKSB7CgkJcmV0dXJuIGluZGV4OwoJfQoJCglyZXR1cm4gZHR5cGVzX2dldFZhbHVlKGMsIGluZGV4ICsgMSk7Cn0KCm51bVtdIGFjdGlvbiBkdHlwZXNfc3RydG9CeXRlQXJyYXkoc3RyIHMpewoJbnVtW10gcmV0QXJyYXkgPSBudW1bXTsKCWZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgczsgaSsrKXsKCQlhZGRUbyByZXRBcnJheSBkdHlwZXNfZ2V0VmFsdWUoc1tpXSwwKTsKCX0KCXJldHVybiByZXRBcnJheTsKfQoKc3RyIGFjdGlvbiBkdHlwZXNfQnl0ZUFycmF5VG9TdHIobnVtW10gYil7CglzdHIgcyA9ICIiOwoJZm9yIChudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBiOyBpKyspewoJCWlmIChiW2ldID49MCkKCQl7CgkJCXMgKz0gZHR5cGVzX2FscGhhYmV0W2JbaV1dOwkKCQl9Cgl9CglyZXR1cm4gczsKfQoKc3RyW10gZHR5cGVzX2xvb2t1cCA9IHN0clsiMCIsIjEiLCIyIiwiMyIsIjQiLCI1IiwiNiIsIjciLCI4IiwiOSIsIkEiLCJCIiwiQyIsIkQiLCJFIiwiRiJdOwoKc3RyIGFjdGlvbiBkdHlwZXNfbnVtMmhleHN0cmluZyhudW0gbil7CglzdHIgaGV4c3RyID0gIiI7Cglmb3IgKG51bSBpID0wOyBpIDwgNjsgaSsrKXsKCQloZXhzdHIgPSBkdHlwZXNfbG9va3VwW24gJiAweEZdICsgaGV4c3RyOwoJCW4gPSBuID4+IDQ7Cgl9CglyZXR1cm4gaGV4c3RyOwp9CgpudW0gYWN0aW9uIGR0eXBlc19oZXhzdHJpbmcybnVtKHN0ciBoKXsKCW51bSBuID0gMDsKCWggPSBVVElMUy50b1VwcGVyKGgpOwoJZm9yIChudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBoOyBpKyspewoJCWZvciAobnVtIGogPSAwOyBqIDwgbGVuZ3RoT2YgZHR5cGVzX2xvb2t1cDsgaisrKXsKCQkJaWYgKGR0eXBlc19sb29rdXBbal0gPT0gaFtpXSl7CgkJCQluIHw9IGogPDwgKGxlbmd0aE9mIGggLSAxIC0gaSkqNDsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoJcmV0dXJuIG47Cn0KCm51bSBhY3Rpb24gZHR5cGVzX2NvbnN0cmFpblJhZGlhbnMobnVtIHgpewoJeCA9IGR0eXBlc19mbW9kKHgsTWF0aC5QSTIpOwoJaWYgKHggPCAwKXsKCQl4ICs9IDM2MDsKCX0KICAgIHJldHVybiB4Owp9CgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgSGVhZGVyOiBiOTFlbmNvZGluZ1xiOTEua3JuawojIEF1dGhvcjogU2x4VG5UCiMgRGVzY3JpcHRpb246IEJhc2U5MSBkZWNvZGluZyBjb252ZXJ0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vS3ZhblRUVC9CYXNlTmNvZGluZwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgpvYmogYjkxX2Jhc2U5MSA9IHsKICAgIGFscGhhYmV0OiAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkhIyQlJigpKissLi86Ozw9Pj9AW11eX2B7fH1+LSIKfTsKCiMgUmVjdXJzaW9uIGR1ZSB0byBsb29wIGxpbWl0cwpudW0gYWN0aW9uIGI5MV9nZXRWYWx1ZShzdHIgYywgbnVtIGluZGV4KSB7CglpZihpbmRleCA+PSBsZW5ndGhPZiBiOTFfYmFzZTkxLmFscGhhYmV0KSB7CgkJcmV0dXJuIC0xOwoJfQoJCglpZigoc3RyKWI5MV9iYXNlOTEuYWxwaGFiZXRbaW5kZXhdID09IGMpIHsKCQlyZXR1cm4gaW5kZXg7Cgl9CgkKCXJldHVybiBiOTFfZ2V0VmFsdWUoYywgaW5kZXggKyAxKTsKfQoKbnVtW10gYWN0aW9uIGI5MV9kZWNvZGUoc3RyIGRhdGEpIHsKICAgIG51bSBkdiA9IC0xOwogICAgbnVtIGRuID0gMDsKICAgIG51bSBkYnEgPSAwOwogICAgbnVtW10gcmVzdWx0ID0gbnVtW107CgogICAgZm9yKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIGRhdGE7IGkrKykgewogICAgICAgIG51bSBpdiA9IGI5MV9nZXRWYWx1ZShkYXRhW2ldLCAwKTsKCiAgICAgICAgaWYoaXYgPT0gLTEpIHsgY29udGludWU7IH0KCiAgICAgICAgaWYoZHYgPT0gLTEpIHsKICAgICAgICAgICAgZHYgPSBpdjsgCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBkdiArPSBpdiAqIDkxOwogICAgICAgICAgICBkYnEgfD0gKGR2IDw8IGRuKTsKCiAgICAgICAgICAgIGlmKChkdiAmIDgxOTEpID4gODgpIHsKICAgICAgICAgICAgICAgIGRuICs9IDEzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZG4gKz0gMTQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZG8gLi4uIHdoaWxlPwogICAgICAgICAgICBib29sIGZpcnN0ID0gdHJ1ZTsKCiAgICAgICAgICAgIHdoaWxlKGZpcnN0IHx8IGRuID4gNykgewogICAgICAgICAgICAgICAgYWRkVG8gcmVzdWx0IGRicSAlIDI1NjsKICAgICAgICAgICAgICAgIGRicSA+Pj49IDg7CiAgICAgICAgICAgICAgICBkbiAtPSA4OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkdiA9IC0xOwogICAgICAgIH0KICAgIH0KCglpZihkdiAhPSAtMSkgewoJCWFkZFRvIHJlc3VsdCAoZGJxIHwgZHYgPDwgZG4pICYgMjU1OwoJfQoKCXJldHVybiByZXN1bHQ7Cn0KCiMgQmVpbmcgdXNlZCBzZXJ2ZXItc2lkZQpzdHIgYWN0aW9uIGI5MV9lbmNvZGUobnVtW10gZGF0YSkgewogICAgbnVtIGVuID0gMDsKICAgIG51bSBlYnEgPSAwOwogICAgc3RyIHJlc3VsdCA9ICIiOwoKCWZvcihudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBkYXRhOyBpKyspIHsKCQllYnEgfD0gKGRhdGFbaV0gJiAyNTUpIDw8IGVuOwoJCWVuICs9IDg7CgkJCgkJaWYoZW4gPiAxMykgewoJCQludW0gZXYgPSBlYnEgJiA4MTkxOwoJCQkKCQkJaWYoZXYgPiA4OCkgewoJCQkJZWJxID4+Pj0gMTM7CgkJCQllbiAtPSAxMzsKCQkJfQoJCQllbHNlIHsKCQkJCWV2ID0gZWJxICYgMTYzODM7CgkJCQllYnEgPj4+PSAxNDsKCQkJCWVuIC09IDE0OwoJCQl9CgkJCQoJCQludW0gcXVvdGllbnQgPSBNYXRoLmZsb29yKGV2IC8gOTEpOwoJCQludW0gcmVtYWluZGVyID0gZXYgJSA5MTsKCQkKCQkJcmVzdWx0ICs9IChzdHIpYjkxX2Jhc2U5MS5hbHBoYWJldFtyZW1haW5kZXJdOwoJCQlyZXN1bHQgKz0gKHN0ciliOTFfYmFzZTkxLmFscGhhYmV0W3F1b3RpZW50XTsKCQl9Cgl9CgoJaWYoZW4gPiAwKSB7CgkJCW51bSBxdW90aWVudCA9IE1hdGguZmxvb3IoZWJxIC8gOTEpOwoJCQludW0gcmVtYWluZGVyID0gZWJxICUgOTE7CgoJCQlyZXN1bHQgKz0gKHN0ciliOTFfYmFzZTkxLmFscGhhYmV0W3JlbWFpbmRlcl07CgoJCQlpZihlbiA+IDcgfHwgZWJxID4gOTApIHsKCQkJCXJlc3VsdCArPSAoc3RyKWI5MV9iYXNlOTEuYWxwaGFiZXRbcXVvdGllbnRdOwoJCQl9Cgl9CgoJcmV0dXJuIHJlc3VsdDsKfQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBoZWFkZXI6IFxsaWJzXHN5bmNvYmpzXHN5bmNvYmpzX2gua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogbm90IHJlYWR5IQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgpudW0gc3luY29ianNfaF9lSEVBTFRIID0gMHgwMTsKbnVtIHN5bmNvYmpzX2hfZVBPU0lUSU9OID0gMHgwMjsKbnVtIHN5bmNvYmpzX2hfZVJPVEFUSU9OID0gMHgwNDsKbnVtIHN5bmNvYmpzX2hfZVNDQUxFID0gMHgwODsKbnVtIHN5bmNvYmpzX2hfZVRZUEUgPSAweDEwOwpudW0gc3luY29ianNfaF9lVEVYVFVSRSA9IDB4MjA7Cm51bSBzeW5jb2Jqc19oX2VDT0xPUiA9IDB4NDA7Cm51bSBzeW5jb2Jqc19oX2VFTUlTU0lWRSA9IDB4ODA7CgoKIyBCaW5hcnkgZGVjb2Rpbmcgb2YgYW4gYXJyYXkgb2YgYnl0ZXMgdG8gT2JqZWN0cwpvYmogYWN0aW9uIHN5bmNvYmpzX2hfYnl0ZUFycmF5VG9PYmpzKG51bVtdIGJ5dGVBcnJheSkgewoJb2JqW10gb2JqbGlzdCA9IG9ialtdOwoJbnVtW10gZGVsTGlzdCA9IG51bVtdOwoJbnVtIGkgPSAwOyAjIHBjIGluIGFycmF5CgludW0gdG90YWxvYmpzID0gMDsKCW51bSB0b3RhbGRlbG9ianMgPSAwOwoJaWYgKGxlbmd0aE9mIGJ5dGVBcnJheSA+PTIpCgl7CiAgICAgICAgdG90YWxvYmpzID0gYnl0ZUFycmF5WzBdOwogICAgICAgIGkrKzsKCQl0b3RhbGRlbG9ianMgPSBieXRlQXJyYXlbMV07CgkJaSsrOwogICAgfSBlbHNlCgl7CiAgICAgICAgcmV0dXJuIHtvYmpsaXN0Om9iamxpc3QsZGVsTGlzdDpkZWxMaXN0fTsKICAgIH0KCQoJZm9yIChudW0gaiA9IDA7IGogPCB0b3RhbG9ianM7IGorKyl7CgkJb2JqIHRvYmogPSB7fTsKCQkjIGNvbnRlbnRzIGJ5dGUKCQludW0gY29udGVudHMgPSBieXRlQXJyYXlbaV07CgkJaSsrOwoJCSMgb2JqZWN0IGlkIDIgYnl0ZXMKCQl0b2JqLm9iamlkID0gZHR5cGVzX21lcmdlMkJ5dGVzKGJ5dGVBcnJheVtpXSxieXRlQXJyYXlbaSsxXSk7CgkJaSs9MjsKCQkjIDQgYnl0ZXMgaGVhbHRoIC8gZnVsbGhlYWx0aAoJCWlmICgoY29udGVudHMgJiBzeW5jb2Jqc19oX2VIRUFMVEgpID4gMCkgewoJCQl0b2JqLmhlYWx0aCA9IGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaV0sYnl0ZUFycmF5W2krMV0pOwoJCQl0b2JqLmZoZWFsdGggPSBkdHlwZXNfbWVyZ2UyQnl0ZXMoYnl0ZUFycmF5W2krMl0sYnl0ZUFycmF5W2krM10pOwoJCQlpKz0gNDsKCQl9CgkJIyA2IGJ5dGVzIHBvc2l0aW9uCgkJaWYgKChjb250ZW50cyAmIHN5bmNvYmpzX2hfZVBPU0lUSU9OKSA+IDApewoJCQl0b2JqLnBvc2l0aW9uID0gewoJCQkJeCA6IGR0eXBlc19JbnQxNlRvTnVtKGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaV0sYnl0ZUFycmF5W2krMV0pKSwKCQkJCXkgOiBkdHlwZXNfSW50MTZUb051bShkdHlwZXNfbWVyZ2UyQnl0ZXMoYnl0ZUFycmF5W2krMl0sYnl0ZUFycmF5W2krM10pKSwKCQkJCXogOiBkdHlwZXNfSW50MTZUb051bShkdHlwZXNfbWVyZ2UyQnl0ZXMoYnl0ZUFycmF5W2krNF0sYnl0ZUFycmF5W2krNV0pKQoJCQl9OwoJCQlpKz0gNjsKCQl9CgkJIyA2IGJ5dGVzIHJvdGF0aW9uCgkJaWYgKChjb250ZW50cyAmIHN5bmNvYmpzX2hfZVJPVEFUSU9OKSA+IDApIHsKCQkJdG9iai5yb3RhdGlvbiA9ewoJCQkJeDogZHR5cGVzX2Zsb2F0MTZUb051bShkdHlwZXNfbWVyZ2UyQnl0ZXMoYnl0ZUFycmF5W2ldLGJ5dGVBcnJheVtpKzFdKSksCgkJCQl5OiBkdHlwZXNfZmxvYXQxNlRvTnVtKGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaSsyXSxieXRlQXJyYXlbaSszXSkpLAoJCQkJejogZHR5cGVzX2Zsb2F0MTZUb051bShkdHlwZXNfbWVyZ2UyQnl0ZXMoYnl0ZUFycmF5W2krNF0sYnl0ZUFycmF5W2krNV0pKQoJCQl9OwoJCQlpKz0gNjsKCQl9CgkJIyA2IGJ5dGVzIHNjYWxlCgkJaWYgKChjb250ZW50cyAmIHN5bmNvYmpzX2hfZVNDQUxFKSA+IDApIHsKCQkJdG9iai5zY2FsZSA9IHsKCQkJCXg6IGR0eXBlc19JbnQxNlRvTnVtKGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaV0sYnl0ZUFycmF5W2krMV0pKSwKCQkJCXk6IGR0eXBlc19JbnQxNlRvTnVtKGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaSsyXSxieXRlQXJyYXlbaSszXSkpLAoJCQkJejogZHR5cGVzX0ludDE2VG9OdW0oZHR5cGVzX21lcmdlMkJ5dGVzKGJ5dGVBcnJheVtpKzRdLGJ5dGVBcnJheVtpKzVdKSkKCQkJfTsKCQkJaSs9IDY7CgkJfQoJCSMgNyBieXRlcyBkZXRhaWxzICgyIHR5cGUsIDIgdGV4dHVyZSwgMyBjb2xvcikKCQlpZiAoKGNvbnRlbnRzICYgc3luY29ianNfaF9lVFlQRSkgPiAwKSB7CgkJCSMgdG9iai50eXBlID0gZHR5cGVzX21lcmdlMkJ5dGVzKGJ5dGVBcnJheVtpXSxieXRlQXJyYXlbaSsxXSk7CgkJCSMgaSs9MjsKCQkJbnVtIGxlbiA9IGJ5dGVBcnJheVtpXTsKCQkJaSsrOwoJCQludW1bXSBieXRlQSA9IG51bVtdOwoJCQlmb3IgKG51bSBrID0gMDsgayA8IGxlbjsgaysrKQoJCQl7CgkJCQlhZGRUbyBieXRlQSBieXRlQXJyYXlbaV07CgkJCQlpKys7CgkJCX0KCQkJIyBudW1bXSBieXRlQSA9IG51bVtdOyBhZGRUbyBieXRlQSBieXRlQXJyYXlbaV07CgkJCXRvYmoudHlwZSA9IGR0eXBlc19CeXRlQXJyYXlUb1N0cihieXRlQSk7CiAgICAgICAgICAgICMgaSs9MTsKCQkJIyBHQU1FLmxvZygidHlwZToiLHRvYmoudHlwZSk7CgkJfQogICAgICAgIGlmICgoY29udGVudHMgJiBzeW5jb2Jqc19oX2VURVhUVVJFKSA+IDApIHsKCQkJdG9iai5haWQgPSBkdHlwZXNfbWVyZ2UyQnl0ZXMoYnl0ZUFycmF5W2ldLGJ5dGVBcnJheVtpKzFdKTsKICAgICAgICAgICAgaSs9MjsKCQl9CiAgICAgICAgaWYgKChjb250ZW50cyAmIHN5bmNvYmpzX2hfZUNPTE9SKSA+IDApIHsKCQkJdG9iai5jb2xvciA9IGJ5dGVBcnJheVtpXSB8IChieXRlQXJyYXlbaSsxXSA8PCA4KSB8IChieXRlQXJyYXlbaSsyXSA8PCAxNik7CiAgICAgICAgICAgIGkrPTM7CgkJfQogICAgICAgIGlmICgoY29udGVudHMgJiBzeW5jb2Jqc19oX2VFTUlTU0lWRSkgPiAwKSB7CgkJCXRvYmouZW1pc3NpdmUgPSBieXRlQXJyYXlbaV0gfCAoYnl0ZUFycmF5W2krMV0gPDwgOCkgfCAoYnl0ZUFycmF5W2krMl0gPDwgMTYpOwogICAgICAgICAgICBpKz0zOwoJCX0KICAgICAgICAKCQlhZGRUbyBvYmpsaXN0IHRvYmo7CgkJIyBqKys7Cgl9Cglmb3IgKG51bSBqID0gMDsgaiA8IHRvdGFsZGVsb2JqczsgaisrKXsKCQkjIEdBTUUubG9nKCJpIixpLCJqIixqKTsKCQkjIEdBTUUubG9nKGJ5dGVBcnJheSk7CgkJIyBHQU1FLmxvZygibmV3IGRlbGV0ZSBvYmplY3Qgd2l0aCBpZCIsYnl0ZUFycmF5W2kra10pOwoJCW51bSBvYmppZCA9IGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaV0sYnl0ZUFycmF5W2krMV0pOwoJCWFkZFRvIGRlbExpc3Qgb2JqaWQ7CgkJaSs9MjsKCX0KCgoJcmV0dXJuIHtvYmpsaXN0Om9iamxpc3QsZGVsTGlzdDpkZWxMaXN0fTsKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTGlicmFyeTogXGxpYnNcc3luY29ianNcc3luY29ianNfYy5rcm5rCiMgQXV0aG9yOiBibGFuZHJpY2UKIyAgIERlc2NyaXB0aW9uOiBub3QgcmVhZHkhCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKb2JqW10gc3luY29ianNfY19vYmpsaXN0ID0gb2JqW107CnN0ciBzeW5jb2Jqc19jX25ldGRhdGEgPSAiIjsKc3RyW10gc3luY29ianNfY19kZWxMaXN0ID0gc3RyW107CgojIGludGVycG9sYXRpb24KbnVtIHN5bmNvYmpzX2NfbmV3VGltZSA9IDA7Cm51bSBzeW5jb2Jqc19jX29sZFRpbWUgPSAwOwpudW0gc3luY29ianNfY19kYXRhQnVmZmVyID0gMDsKbnVtIHN5bmNvYmpzX2NfaW50ZXJwTSA9IDA7CgojIHVwZGF0ZSB3aXRoIG5ldyBvYmplY3QgZGF0YQpib29sIGFjdGlvbiBzeW5jb2Jqc19jX3VwZGF0ZW9ianByb3BlcnRpZXMob2JqIGN1cnJlbnRPYmosIG9iaiBuZXdPYmpEYXRhKSB7CiAgICBjdXJyZW50T2JqLm9sZHBvcy54ID0gKG51bSkgY3VycmVudE9iai5uZXdwb3MueDsKICAgIGN1cnJlbnRPYmoub2xkcG9zLnkgPSAobnVtKSBjdXJyZW50T2JqLm5ld3Bvcy55OwogICAgY3VycmVudE9iai5vbGRwb3MueiA9IChudW0pIGN1cnJlbnRPYmoubmV3cG9zLno7CiAgICBjdXJyZW50T2JqLm9sZHJvdC54ID0gKG51bSkgY3VycmVudE9iai5uZXdyb3QueDsKICAgIGN1cnJlbnRPYmoub2xkcm90LnkgPSAobnVtKSBjdXJyZW50T2JqLm5ld3JvdC55OwogICAgY3VycmVudE9iai5vbGRyb3QueiA9IChudW0pIGN1cnJlbnRPYmoubmV3cm90Lno7CgogICAgaWYgKG5vdEVtcHR5IChvYmopIG5ld09iakRhdGEucG9zaXRpb24pewogICAgICAgIGN1cnJlbnRPYmoubmV3cG9zLnggPSAobnVtKSBuZXdPYmpEYXRhLnBvc2l0aW9uLng7CiAgICAgICAgY3VycmVudE9iai5uZXdwb3MueSA9IChudW0pIG5ld09iakRhdGEucG9zaXRpb24ueTsKICAgICAgICBjdXJyZW50T2JqLm5ld3Bvcy56ID0gKG51bSkgbmV3T2JqRGF0YS5wb3NpdGlvbi56OwogICAgfQogICAgaWYgKG5vdEVtcHR5IChvYmopIG5ld09iakRhdGEuc2NhbGUpewogICAgICAgIGN1cnJlbnRPYmouc2NhbGUueCA9IChudW0pIG5ld09iakRhdGEuc2NhbGUueDsKICAgICAgICBjdXJyZW50T2JqLnNjYWxlLnkgPSAobnVtKSBuZXdPYmpEYXRhLnNjYWxlLnk7CiAgICAgICAgY3VycmVudE9iai5zY2FsZS56ID0gKG51bSkgbmV3T2JqRGF0YS5zY2FsZS56OwogICAgfQogICAgaWYgKCEhKG51bSluZXdPYmpEYXRhLmhlYWx0aCkgewogICAgICAgIGN1cnJlbnRPYmouaGVhbHRoID0gKG51bSluZXdPYmpEYXRhLmhlYWx0aDsKICAgIH0KICAgIGlmICghIShudW0pbmV3T2JqRGF0YS5maGVhbHRoKSB7CiAgICAgICAgY3VycmVudE9iai5maGVhbHRoID0gKG51bSluZXdPYmpEYXRhLmZoZWFsdGg7CiAgICB9CiAgICBpZiAobm90RW1wdHkgKG9iailuZXdPYmpEYXRhLnJvdGF0aW9uKSB7CiAgICAgICAgY3VycmVudE9iai5uZXdyb3QueCA9IChudW0pIG5ld09iakRhdGEucm90YXRpb24ueDsKICAgICAgICBjdXJyZW50T2JqLm5ld3JvdC55ID0gKG51bSkgbmV3T2JqRGF0YS5yb3RhdGlvbi55OwogICAgICAgIGN1cnJlbnRPYmoubmV3cm90LnogPSAobnVtKSBuZXdPYmpEYXRhLnJvdGF0aW9uLno7CiAgICB9CiAgICBpZiAoKHN0ciluZXdPYmpEYXRhLmVtaXNzaXZlICE9InVuZGVmaW5lZCIpewogICAgICAgIHN0ciBjb2xyID0gIiMiICsgZHR5cGVzX251bTJoZXhzdHJpbmcoKG51bSkgbmV3T2JqRGF0YS5lbWlzc2l2ZSk7CiAgICAgICAgY3VycmVudE9iai5lbWlzc2l2ZSA9IGNvbHI7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKfQoKIyBGaXJzdCBjcmVhdGlvbiBvZiBvYmplY3QKb2JqIGFjdGlvbiBzeW5jb2Jqc19jX2NyZWF0ZU9iaihvYmogbmV3T2JqRGF0YSkgewogICAgb2JqIGN1YmUgPSB7fTsKICAgIGlmICgoc3RyKSBuZXdPYmpEYXRhLnR5cGUgPT0gIjAiKSB7CiAgICAgICAgIyBzdHIgYWlkID0gKHN0cikgbmV3T2JqRGF0YS5haWQ7CiAgICAgICAgIyBzdHIgYWlkID0gIjM0Mzc5IjsgIyB0ZW1wIGZpeCBmb3Igbm93CiAgICAgICAgc3RyIGNvbHIgPSAiIyIgKyBkdHlwZXNfbnVtMmhleHN0cmluZygobnVtKSBuZXdPYmpEYXRhLmNvbG9yKTsKICAgICAgICAjIG9iaiBjdWJlID0gR0FNRS5TQ0VORS5hZGRDdWJlKHRvU3RyIChudW0pbmV3T2JqRGF0YS5haWQsIGNvbHIsIChudW0pbmV3T2JqRGF0YS5wb3NpdGlvbi54LChudW0pbmV3T2JqRGF0YS5wb3NpdGlvbi55LChudW0pbmV3T2JqRGF0YS5wb3NpdGlvbi56LCAwLDAsMCk7CiAgICAgICAgY3ViZSA9IEdBTUUuU0NFTkUuYWRkQ3ViZSh0b1N0ciAobnVtKW5ld09iakRhdGEuYWlkLCBjb2xyLCAobnVtKW5ld09iakRhdGEucG9zaXRpb24ueCwobnVtKW5ld09iakRhdGEucG9zaXRpb24ueSwobnVtKW5ld09iakRhdGEucG9zaXRpb24ueiwgKG51bSluZXdPYmpEYXRhLnNjYWxlLngsKG51bSluZXdPYmpEYXRhLnNjYWxlLnksKG51bSluZXdPYmpEYXRhLnNjYWxlLnopOwogICAgICAgICMgcmV0dXJuIGN1YmU7CiAgICB9IGVsc2UgaWYgKFVUSUxTLnRleHRDb250YWlucygoc3RyKW5ld09iakRhdGEudHlwZSwidGciKSl7CiAgICAgICAgR0FNRS5sb2coIm5ldyB0eXBlIGVuY291bnRlcmVkOiIsKHN0cikgbmV3T2JqRGF0YS50eXBlKTsKICAgICAgICBzdHIgY29sciA9ICIjIiArIGR0eXBlc19udW0yaGV4c3RyaW5nKChudW0pIG5ld09iakRhdGEuY29sb3IpOwogICAgICAgIGN1YmUgPSBHQU1FLlNDRU5FLmFkZEFzc2V0KChzdHIpbmV3T2JqRGF0YS50eXBlLCAobnVtKW5ld09iakRhdGEucG9zaXRpb24ueCwobnVtKW5ld09iakRhdGEucG9zaXRpb24ueSwobnVtKW5ld09iakRhdGEucG9zaXRpb24ueiwgMSwgY29sciwge30pOwoKICAgIH0KICAgIGN1YmUub2JqaWQgPSAobnVtKSBuZXdPYmpEYXRhLm9iamlkOwogICAgY3ViZS5vbGRwb3MgPSB7eDoobnVtKW5ld09iakRhdGEucG9zaXRpb24ueCx5OihudW0pbmV3T2JqRGF0YS5wb3NpdGlvbi55LHo6KG51bSluZXdPYmpEYXRhLnBvc2l0aW9uLnp9OwogICAgY3ViZS5uZXdwb3MgPSB7eDoobnVtKW5ld09iakRhdGEucG9zaXRpb24ueCx5OihudW0pbmV3T2JqRGF0YS5wb3NpdGlvbi55LHo6KG51bSluZXdPYmpEYXRhLnBvc2l0aW9uLnp9OwoKICAgIGN1YmUub2xkcm90ID0ge3g6KG51bSluZXdPYmpEYXRhLnJvdGF0aW9uLngseToobnVtKW5ld09iakRhdGEucm90YXRpb24ueSx6OihudW0pbmV3T2JqRGF0YS5yb3RhdGlvbi56fTsKICAgIGN1YmUubmV3cm90ID0ge3g6KG51bSluZXdPYmpEYXRhLnJvdGF0aW9uLngseToobnVtKW5ld09iakRhdGEucm90YXRpb24ueSx6OihudW0pbmV3T2JqRGF0YS5yb3RhdGlvbi56fTsKCiAgICBjdWJlLmhlYWx0aCA9IChudW0pbmV3T2JqRGF0YS5oZWFsdGg7CiAgICBjdWJlLmZoZWFsdGggPSAobnVtKW5ld09iakRhdGEuZmhlYWx0aDsKICAgIGN1YmUuaGl0ID0gKG51bSluZXdPYmpEYXRhLmhpdDsKICAgIAogICAgc3luY29ianNfY191cGRhdGVvYmpwcm9wZXJ0aWVzKGN1YmUsIG5ld09iakRhdGEpOwoKICAgIHJldHVybiBjdWJlOwp9CgphY3Rpb24gc3luY29ianNfY19sZXJwT2JqKG51bSBkZWx0YSkgewogICAgc3luY29ianNfY19pbnRlcnBNID0gTWF0aC5taW4oMS41LCAoR0FNRS5USU1FLm5vdygpIC0gc3luY29ianNfY19uZXdUaW1lKSAvIHN5bmNvYmpzX2NfZGF0YUJ1ZmZlcik7CiAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIHN5bmNvYmpzX2Nfb2JqbGlzdDsgaSsrKXsKICAgICAgICBvYmogY3VyT2JqID0gc3luY29ianNfY19vYmpsaXN0W2ldOwogICAgICAgIGlmICghbm90RW1wdHkgKG9iaikgY3VyT2JqLm9ncG9zKXsKICAgICAgICAgICAgY3VyT2JqLm9ncG9zID0ge307CiAgICAgICAgfQogICAgICAgIGN1ck9iai5vZ3BvcyA9IAogICAgICAgIHsKICAgICAgICAgICAgeDpjdXJPYmoucG9zaXRpb24ueCwKICAgICAgICAgICAgeTpjdXJPYmoucG9zaXRpb24ueSwKICAgICAgICAgICAgejpjdXJPYmoucG9zaXRpb24uegogICAgICAgIH07CiAgICAgICAgKG51bSkgY3VyT2JqLnBvc2l0aW9uLnggKz0gKE1hdGgubGVycCgobnVtKWN1ck9iai5vbGRwb3MueCwgKG51bSljdXJPYmoubmV3cG9zLngsIHN5bmNvYmpzX2NfaW50ZXJwTSktKG51bSljdXJPYmoucG9zaXRpb24ueCkqZGVsdGEvMTAwMCo2MC80OwogICAgICAgIChudW0pIGN1ck9iai5wb3NpdGlvbi55ICs9IChNYXRoLmxlcnAoKG51bSljdXJPYmoub2xkcG9zLnksIChudW0pY3VyT2JqLm5ld3Bvcy55LCBzeW5jb2Jqc19jX2ludGVycE0pLShudW0pY3VyT2JqLnBvc2l0aW9uLnkpKmRlbHRhLzEwMDAqNjAvNDsKICAgICAgICAobnVtKSBjdXJPYmoucG9zaXRpb24ueiArPSAoTWF0aC5sZXJwKChudW0pY3VyT2JqLm9sZHBvcy56LCAobnVtKWN1ck9iai5uZXdwb3Mueiwgc3luY29ianNfY19pbnRlcnBNKS0obnVtKWN1ck9iai5wb3NpdGlvbi56KSpkZWx0YS8xMDAwKjYwLzQ7CiAgICAgICAgaWYgKCFub3RFbXB0eSAob2JqKSBjdXJPYmoub2dyb3QpewogICAgICAgICAgICBjdXJPYmoub2dyb3QgPSB7fTsKICAgICAgICB9CiAgICAgICAgY3VyT2JqLm9ncm90ID0gCiAgICAgICAgewogICAgICAgICAgICB4OmN1ck9iai5yb3RhdGlvbi54LAogICAgICAgICAgICB5OmN1ck9iai5yb3RhdGlvbi55LAogICAgICAgICAgICB6OmN1ck9iai5yb3RhdGlvbi56CiAgICAgICAgfTsKICAgICAgICAobnVtKSBjdXJPYmoucm90YXRpb24ueCArPSAoTWF0aC5sZXJwKChudW0pY3VyT2JqLm9sZHJvdC54LCAobnVtKWN1ck9iai5uZXdyb3QueCwgc3luY29ianNfY19pbnRlcnBNKS0obnVtKWN1ck9iai5yb3RhdGlvbi54KSpkZWx0YS8xMDAwKjYwLzQ7CiAgICAgICAgKG51bSkgY3VyT2JqLnJvdGF0aW9uLnkgKz0gKE1hdGgubGVycCgobnVtKWN1ck9iai5vbGRyb3QueSwgKG51bSljdXJPYmoubmV3cm90LnksIHN5bmNvYmpzX2NfaW50ZXJwTSktKG51bSljdXJPYmoucm90YXRpb24ueSkqZGVsdGEvMTAwMCo2MC80OwogICAgICAgIChudW0pIGN1ck9iai5yb3RhdGlvbi56ICs9IChNYXRoLmxlcnAoKG51bSljdXJPYmoub2xkcm90LnosIChudW0pY3VyT2JqLm5ld3JvdC56LCBzeW5jb2Jqc19jX2ludGVycE0pLShudW0pY3VyT2JqLnJvdGF0aW9uLnopKmRlbHRhLzEwMDAqNjAvNDsKCiAgICAgICAgaWYgKCFub3RFbXB0eSAob2JqKSBjdXJPYmoudmVsb2NpdHkpewogICAgICAgICAgICBjdXJPYmoudmVsb2NpdHkgPSB7fTsKICAgICAgICB9CiAgICAgICAgY3VyT2JqLnZlbG9jaXR5LnggPSAoKG51bSkgY3VyT2JqLnBvc2l0aW9uLnggLSAobnVtKSBjdXJPYmoub2dwb3MueCkgLyBkZWx0YTsKICAgICAgICBjdXJPYmoudmVsb2NpdHkueSA9ICgobnVtKSBjdXJPYmoucG9zaXRpb24ueSAtIChudW0pIGN1ck9iai5vZ3Bvcy55KSAvIGRlbHRhOwogICAgICAgIGN1ck9iai52ZWxvY2l0eS56ID0gKChudW0pIGN1ck9iai5wb3NpdGlvbi56IC0gKG51bSkgY3VyT2JqLm9ncG9zLnopIC8gZGVsdGE7CiAgICB9CiAgICAKICAgIAogICAgIAp9CgpvYmogYWN0aW9uIHN5bmNvYmpzX2NfZmluZE9iamJ5SUQobnVtIGlkKSB7CiAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIHN5bmNvYmpzX2Nfb2JqbGlzdDsgaSsrKSB7CiAgICAgICAgaWYgKChudW0pIHN5bmNvYmpzX2Nfb2JqbGlzdFtpXS5vYmppZCA9PSBpZCkgewogICAgICAgICAgICByZXR1cm4gc3luY29ianNfY19vYmpsaXN0W2ldOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7fTsKfQoKYm9vbCBhY3Rpb24gc3luY29ianNfY19kZWxldGVvYmoobnVtIGlkKSB7CiAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIHN5bmNvYmpzX2Nfb2JqbGlzdDsgaSsrKSB7CiAgICAgICAgaWYgKChudW0pIHN5bmNvYmpzX2Nfb2JqbGlzdFtpXS5vYmppZCA9PSBpZCkgewogICAgICAgICAgICBvYmogY3ViZSA9IHN5bmNvYmpzX2Nfb2JqbGlzdFtpXTsKICAgICAgICAgICAgYWRkVG8gc3luY29ianNfY19kZWxMaXN0IChzdHIpIGN1YmUub2JqaWQ7CiAgICAgICAgICAgIHJlbW92ZSBzeW5jb2Jqc19jX29iamxpc3RbaV07CiAgICAgICAgICAgIGN1YmUuZGVsZXRlKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKYWN0aW9uIHN5bmNvYmpzX2NfY2xlYXJBbGxPYmpzKCl7CiAgICBmb3IgKG51bSBpID0gbGVuZ3RoT2Ygc3luY29ianNfY19vYmpsaXN0IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICBzeW5jb2Jqc19jX2RlbGV0ZW9iaigobnVtKXN5bmNvYmpzX2Nfb2JqbGlzdFtpXS5vYmppZCk7CiAgICB9CiAgICBzeW5jb2Jqc19jX29iamxpc3QgPSBvYmpbXTsKICAgIHN5bmNvYmpzX2NfZGVsTGlzdCA9IHN0cltdOwp9Cgpib29sIGFjdGlvbiBzeW5jb2Jqc19jX29iaklEV2FzRGVsZXRlZChzdHIgaWQpIHsKICAgIGZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2Ygc3luY29ianNfY19kZWxMaXN0OyBpKyspIHsKICAgICAgICBpZiAoaWQgPT0gc3luY29ianNfY19kZWxMaXN0W2ldKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKbnVtW10gYWN0aW9uIHN5bmNvYmpzX2NfZ2V0QWxsT2JqSURzKCkgewogICAgbnVtW10gcmV0b2JqaWRzID0gbnVtW107CiAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIHN5bmNvYmpzX2Nfb2JqbGlzdDsgaSsrKQogICAgewogICAgICAgIGFkZFRvIHJldG9iamlkcyAobnVtKXN5bmNvYmpzX2Nfb2JqbGlzdFtpXS5vYmppZDsKICAgIH0KICAgIHJldHVybiByZXRvYmppZHM7Cn0KCmJvb2wgYWN0aW9uIHN5bmNvYmpzX2NfdXBkYXRlb2JqcyhvYmpbXSBuZXRvYmpzKSB7CiAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIG5ldG9ianM7IGkrKyl7CiAgICAgICAgb2JqIG5ld09iakRhdGEgPSBuZXRvYmpzW2ldOwogICAgICAgICMgYWRkIG5ldyBPYmplY3QKICAgICAgICBpZiAoKGxlbmd0aE9mIHN5bmNvYmpzX2Nfb2JqbGlzdCA9PSAwKSB8fCAoKG51bSluZXdPYmpEYXRhLm9iamlkID4gKG51bSkgc3luY29ianNfY19vYmpsaXN0W2xlbmd0aE9mIHN5bmNvYmpzX2Nfb2JqbGlzdCAtIDFdLm9iamlkKSkgewogICAgICAgICAgICBpZiAoIXN5bmNvYmpzX2Nfb2JqSURXYXNEZWxldGVkKChzdHIpbmV3T2JqRGF0YS5vYmppZCkpIHsKICAgICAgICAgICAgICAgIG9iaiBuZXdPYmogPSBzeW5jb2Jqc19jX2NyZWF0ZU9iaihuZXdPYmpEYXRhKTsKICAgICAgICAgICAgICAgIGFkZFRvIHN5bmNvYmpzX2Nfb2JqbGlzdCBuZXdPYmo7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBHQU1FLmxvZygib2JqZWN0IGFscmVhZHkgZGVsZXRlZCEgIiArIChzdHIpbmV3T2JqRGF0YS5vYmppZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IAogICAgICAgICMgVXBkYXRlIGN1cnJlbnQgb2JqZWN0IHByb3BlcnRpZXMKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgb2JqIGN1ck9iaiA9IHN5bmNvYmpzX2NfZmluZE9iamJ5SUQoKG51bSluZXdPYmpEYXRhLm9iamlkKTsKICAgICAgICAgICAgYm9vbCBzdWNjZXNzID0gc3luY29ianNfY191cGRhdGVvYmpwcm9wZXJ0aWVzKGN1ck9iaiwgbmV3T2JqRGF0YSk7CiAgICAgICAgICAgIGlmICghc3VjY2VzcykgewogICAgICAgICAgICAgICAgR0FNRS5sb2coIkVSUk9SOiBwcm9wZXJ0aWVzIG5vdCB1cGRhdGVkIGZvciBvYmppZDogIiwgdG9TdHIgbmV3T2JqRGF0YS5vYmppZCk7CiAgICAgICAgICAgICAgICBHQU1FLmxvZyhuZXdPYmpEYXRhKTsKICAgICAgICAgICAgICAgIEdBTUUubG9nKHN5bmNvYmpzX2Nfb2JqbGlzdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKfQoKIyByZXNldCBvYmplY3QgbGlzdHMsIHRpbWUgdmFycywgYXR0ZW1wdGVkIHRvIHByZWxvYWQgc291bmRzIGludG8gZ2FtZSBlbmdpbmUgdG8gYXZvaWQgdGhlIGZpcnN0IHNvdW5kJ3MgbGFnLgphY3Rpb24gc3luY29ianNfY19zdGFydCgpIHsKICAgIHN5bmNvYmpzX2NfY2xlYXJBbGxPYmpzKCk7CiAgICAjIHN5bmNvYmpzX2Nfb2JqbGlzdCA9IG9ialtdOwogICAgIyBzeW5jb2Jqc19jX2RlbExpc3QgPSBzdHJbXTsKICAgIAogICAgc3luY29ianNfY19vbGRUaW1lID0gR0FNRS5USU1FLm5vdygpOwogICAgc3luY29ianNfY19uZXdUaW1lID0gR0FNRS5USU1FLm5vdygpOwp9CgphY3Rpb24gc3luY29ianNfY19vbk5ldHdvcmtNZXNzYWdlKHN0ciBpZCwgb2JqIGRhdGEpIHsKICAgIGlmIChpZCA9PSAic3luYyIpIHsKICAgICAgICAKICAgICAgICAjIGNsZWFyIGFsbCBvYmplY3QgLyBuZXR3b3JrIGRhdGEgaWYgcmVzZXQgZ2l2ZW4KICAgICAgICBpZiAoKHN0cilkYXRhLnJzdCAhPSAidW5kZWZpbmVkIiAmJiAobnVtKWRhdGEucnN0ID09IDEpewogICAgICAgICAgICBzeW5jb2Jqc19jX2NsZWFyQWxsT2JqcygpOwogICAgICAgICAgICBzeW5jb2Jqc19jX25ldGRhdGEgPSAiIjsKICAgICAgICB9CiAgICAgICAgc3luY29ianNfY19uZXRkYXRhICs9IChzdHIpZGF0YS5kOwoKICAgICAgICBpZiAoKHN0cilkYXRhLnBjbnQgIT0gInVuZGVmaW5lZCIgJiYgKG51bSlkYXRhLnBjbnQgPT0gMTAwKQogICAgICAgIHsKICAgICAgICAgICAgIyBkYXRhIHNlbnQsIHBlcmZvcm0gZGVjb2RlIGFuZCB1cGRhdGUgb2JqZWN0cwogICAgICAgICAgICBvYmogZGVjb2RlZGRhdGEgPSBzeW5jb2Jqc19oX2J5dGVBcnJheVRvT2JqcyhiOTFfZGVjb2RlKHN5bmNvYmpzX2NfbmV0ZGF0YSkpOwogICAgICAgICAgICBvYmpbXSBuZXRvYmpzID0gKG9ialtdKSBkZWNvZGVkZGF0YS5vYmpsaXN0OwogICAgICAgICAgICBzeW5jb2Jqc19jX29sZFRpbWUgPSBzeW5jb2Jqc19jX25ld1RpbWU7CiAgICAgICAgICAgIHN5bmNvYmpzX2NfbmV3VGltZSA9IEdBTUUuVElNRS5ub3coKTsKICAgICAgICAgICAgc3luY29ianNfY19kYXRhQnVmZmVyID0gc3luY29ianNfY19uZXdUaW1lIC0gc3luY29ianNfY19vbGRUaW1lOwogICAgICAgICAgICAKICAgICAgICAgICAgc3luY29ianNfY191cGRhdGVvYmpzKG5ldG9ianMpOwogICAgICAgICAgICBudW1bXSBuZXdkZWxsaXN0ID0gKG51bVtdKSBkZWNvZGVkZGF0YS5kZWxMaXN0OwogICAgICAgICAgICAjIG51bVtdIG5ld2RlbGxpc3QgPSAobnVtW10pIGRhdGEuZGVsbGlzdDsKICAgICAgICAgICAgbnVtIGRlbGV0ZWQgPSAwOwogICAgICAgICAgICBudW1bXSBub3RkZWxldGVkID0gbnVtW107CiAgICAgICAgICAgIGZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgbmV3ZGVsbGlzdDsgaSsrKSB7CiAgICAgICAgICAgICAgICBib29sIHN1Y2Nlc3MgPSBzeW5jb2Jqc19jX2RlbGV0ZW9iaihuZXdkZWxsaXN0W2ldKTsKICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKQoJCQkJewoJCQkJCWRlbGV0ZWQrKzsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlhZGRUbyBub3RkZWxldGVkIG5ld2RlbGxpc3RbaV07CgkJCQl9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxlbmd0aE9mIG5ld2RlbGxpc3QgPiAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBHQU1FLmxvZygiZGVsZXRlZCB0aGlzIG1hbnk6ICIsZGVsZXRlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxlbmd0aE9mIG5vdGRlbGV0ZWQgPiAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBHQU1FLmxvZygiZGlkIG5vdCBkZWxldGUgb2JqZWN0cyB3aXRoIGlkczogIiwgbm90ZGVsZXRlZCk7CiAgICAgICAgICAgICAgICBudW1bXSBhbGxvYmppZHMgPSBzeW5jb2Jqc19jX2dldEFsbE9iaklEcygpOwogICAgICAgICAgICAgICAgR0FNRS5sb2coImN1cnJlbnQgb2JqZWN0IGlkczogIixhbGxvYmppZHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICMgY2xlYXIgc3luY29ianNfY19uZXRkYXRhIHN0cmluZyBidWZmZXIKICAgICAgICAgICAgc3luY29ianNfY19uZXRkYXRhID0gIiI7CiAgICAgICAgfQoKICAgICAgICAKICAgIH0gZWxzZSBpZiAoaWQgPT0gImNsZWFyIikgewogICAgICAgIHN5bmNvYmpzX2NfY2xlYXJBbGxPYmpzKCk7ICAgICAgIAogICAgfQp9CgphY3Rpb24gc3luY29ianNfY191cGRhdGUobnVtIGRlbHRhKXsKICAgICMgb2JqZWN0IHBvc2l0aW9uIGxlcnBpbmcKICAgIHN5bmNvYmpzX2NfbGVycE9iaihkZWx0YSk7Cn0KCmFjdGlvbiBzeW5jb2Jqc19jX29uR2FtZUVuZCgpewogICAgc3luY29ianNfY19jbGVhckFsbE9ianMoKTsKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTGlicmFyeTogbGlic1x1dGlsc1xwbHJiZWhhdmlvclxwbHJiaHZyX2Mua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogZGlzYWJsZSBzZXJ2ZXIgc3luYyArIGJlaGF2aW9yIGZvciBjdXN0b20gbW92ZW1lbnQKIyAgIHNlbmQgcGxyIHBvc2l0aW9uL3ZlbCB0byBzZXJ2ZXIgbWFudWFsbHkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cm51bSBwbHJiaHZyX2NfdGxhc3RzeW5jID0gMDsKbnVtIHBscmJodnJfY19SQVRFID0gMjU7ICMgTUlOIDI1bXMgLyA0MCBtc2cgcGVyIHNlY29uZApvYmpbXSBwbHJiaHZyX2NfcGxycyA9IG9ialtdOwpvYmogcGxyYmh2cl9jX3NlbGYgPSB7fTsKb2JqIHBscmJodnJfY19zYXZlc3RhdGUgPSB7fTsKCm51bSBwbHJiaHZyX2NfU0laRU5BTUUgPSAyMDsKbnVtIHBscmJodnJfY19IQUxGU05BTUUgPSAxMDsKCgojIGludGVycG9sYXRpb24KbnVtIHBscmJodnJfY19uZXdUaW1lID0gMDsKbnVtIHBscmJodnJfY19vbGRUaW1lID0gMDsKbnVtIHBscmJodnJfY19kYXRhQnVmZmVyID0gMDsKbnVtIHBscmJodnJfY19pbnRlcnBNID0gMDsKCiMgd2Fsa2luZyBvbiBwbGF0Zm9ybXMKYm9vbCBwbHJiaHZyX2NfY3IgPSBmYWxzZTsKbnVtIHBscmJodnJfY19NQVhXQUxLU1BFRUQgPSAwLjA0OwpudW0gcGxyYmh2cl9jX3Rub3cgPSAwOwoKCmFjdGlvbiBwbHJiaHZyX2NfbGVycFBscnMobnVtIGRlbHRhKSB7CiAgICBwbHJiaHZyX2NfaW50ZXJwTSA9IE1hdGgubWluKDEuNSwgKGdfdG5vdyAtIHBscmJodnJfY19uZXdUaW1lKSAvIHBscmJodnJfY19kYXRhQnVmZmVyKTsKICAgIGZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgcGxyYmh2cl9jX3BscnM7IGkrKyl7CiAgICAgICAgb2JqIHBsciA9IHBscmJodnJfY19wbHJzW2ldOwogICAgICAgIAogICAgICAgIChudW0pIHBsci5wb3NpdGlvbi54ICs9IChNYXRoLmxlcnAoKG51bSlwbHIub2xkcG9zLngsIChudW0pcGxyLm5ld3Bvcy54LCBwbHJiaHZyX2NfaW50ZXJwTSktKG51bSlwbHIucG9zaXRpb24ueCkqZGVsdGEvMTAwMCo2MC80OwogICAgICAgIChudW0pIHBsci5wb3NpdGlvbi55ICs9IChNYXRoLmxlcnAoKG51bSlwbHIub2xkcG9zLnksIChudW0pcGxyLm5ld3Bvcy55LCBwbHJiaHZyX2NfaW50ZXJwTSktKG51bSlwbHIucG9zaXRpb24ueSkqZGVsdGEvMTAwMCo2MC80OwogICAgICAgIChudW0pIHBsci5wb3NpdGlvbi56ICs9IChNYXRoLmxlcnAoKG51bSlwbHIub2xkcG9zLnosIChudW0pcGxyLm5ld3Bvcy56LCBwbHJiaHZyX2NfaW50ZXJwTSktKG51bSlwbHIucG9zaXRpb24ueikqZGVsdGEvMTAwMCo2MC80OwogICAgICAgICMgKG51bSkgcGxyLnJvdGF0aW9uLnggKz0gKE1hdGgubGVycCgobnVtKXBsci5vbGRyb3QueCwgKG51bSlwbHIubmV3cm90LngsIHBscmJodnJfY19pbnRlcnBNKS0obnVtKXBsci5yb3RhdGlvbi54KSpkZWx0YS8xMDAwKjYwLzQ7CiAgICAgICAgKG51bSkgcGxyLnJvdGF0aW9uLnggKz0gKE1hdGgubGVycCgobnVtKXBsci5vbGRyb3QueCwgKG51bSlwbHIubmV3cm90LngsIHBscmJodnJfY19pbnRlcnBNKS0obnVtKXBsci5yb3RhdGlvbi54KSpkZWx0YS8xMDAwKjYwLzQ7CiAgICAgICAgIyAobnVtKSBwbHIucm90YXRpb24ueiArPSAoTWF0aC5sZXJwKChudW0pcGxyLm9sZHJvdC56LCAobnVtKXBsci5uZXdyb3QueiwgcGxyYmh2cl9jX2ludGVycE0pLShudW0pcGxyLnJvdGF0aW9uLnopKmRlbHRhLzEwMDAqNjAvNDsKICAgIH0KICAgIAogICAgCiAgICAgCn0KCm9iaiBhY3Rpb24gcGxyYmh2cl9jX2ZpbmRCeVVzZXJuYW1lKHN0ciBuKXsKICAgIGZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgcGxyYmh2cl9jX3BscnM7IGkrKyl7CiAgICAgICAgaWYgKG4gPT0gKHN0cilwbHJiaHZyX2NfcGxyc1tpXS51c2VybmFtZSkgewogICAgICAgICAgICByZXR1cm4gcGxyYmh2cl9jX3BscnNbaV07CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHt9Owp9CgoKCm9iaiBhY3Rpb24gcGxyYmh2cl9jX2ZpbmRCeUlkKHN0ciBpZCl7CiAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIHBscmJodnJfY19wbHJzOyBpKyspewogICAgICAgIGlmIChpZCA9PSAoc3RyKXBscmJodnJfY19wbHJzW2ldLmlkKSB7CiAgICAgICAgICAgIHJldHVybiBwbHJiaHZyX2NfcGxyc1tpXTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4ge307Cn0KCmFjdGlvbiBwbHJiaHZyX2NfcmVtb3ZlQnlJZChzdHIgaWQpewogICAgZm9yIChudW0gaSA9IGxlbmd0aE9mIHBscmJodnJfY19wbHJzLTE7IGkgPj0gMDsgaS0tKXsKICAgICAgICBpZiAoaWQgPT0gKHN0cilwbHJiaHZyX2NfcGxyc1tpXS5pZCkgewogICAgICAgICAgICBHQU1FLmxvZygicmVtb3ZpbmcgcGxyIGlkIixpZCk7CiAgICAgICAgICAgIHBscmJodnJfY19wbHJzW2ldLm1vZGVsLmRlbGV0ZSgpOwogICAgICAgICAgICByZW1vdmUgcGxyYmh2cl9jX3BscnNbaV07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9Cn0KCmFjdGlvbiBwbHJiaHZyX2NfdXBkYXRlKG51bSBkZWx0YSl7CiAgICAjIG51bSBwbHJiaHZyX2NfdG5vdyA9IEdBTUUuVElNRS5ub3coKTsKICAgIHBscmJodnJfY19sZXJwUGxycyhkZWx0YSk7CiAgICBpZiAocGxydXRpbF9jX2ltc3Bhd25lZCAmJiAoZ190bm93IC0gcGxyYmh2cl9jX3RsYXN0c3luYz4gcGxyYmh2cl9jX1JBVEUpKXsKICAgICAgICBwbHJiaHZyX2Nfc2VsZiA9IEdBTUUuUExBWUVSUy5nZXRTZWxmKCk7CiAgICAgICAgaWYgKG5vdEVtcHR5IChvYmopcGxyYmh2cl9jX3NhdmVzdGF0ZS5wb3NpdGlvbil7CiAgICAgICAgICAgIEdBTUUuTkVUV09SSy5zZW5kKCJwbHJiaHZyIiwge3Bvc2l0aW9uOnBscmJodnJfY19zYXZlc3RhdGUucG9zaXRpb24sdmVsb2NpdHk6cGxyYmh2cl9jX3NhdmVzdGF0ZS52ZWxvY2l0eSxyb3RhdGlvbjpwbHJiaHZyX2Nfc2F2ZXN0YXRlLnJvdGF0aW9ufSk7CiAgICAgICAgICAgIHBscmJodnJfY19zYXZlc3RhdGUgPSB7fTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBHQU1FLk5FVFdPUksuc2VuZCgicGxyYmh2ciIsIHtwb3NpdGlvbjpwbHJiaHZyX2Nfc2VsZi5wb3NpdGlvbix2ZWxvY2l0eTpwbHJiaHZyX2Nfc2VsZi52ZWxvY2l0eSxyb3RhdGlvbjpwbHJiaHZyX2Nfc2VsZi5yb3RhdGlvbn0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBwbHJiaHZyX2NfdGxhc3RzeW5jID0gZ190bm93OwogICAgfQogICAgZm9yIChudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBwbHJiaHZyX2NfcGxycztpKyspCiAgICB7CiAgICAgICAgb2JqIHBsciA9IHBscmJodnJfY19wbHJzW2ldOwogICAgICAgIHBsci5tb2RlbC5wb3NpdGlvbi54ID0gKG51bSlwbHIucG9zaXRpb24ueDsKICAgICAgICBwbHIubW9kZWwucG9zaXRpb24ueSA9IChudW0pcGxyLnBvc2l0aW9uLnk7CiAgICAgICAgcGxyLm1vZGVsLnBvc2l0aW9uLnogPSAobnVtKXBsci5wb3NpdGlvbi56OwogICAgICAgIHBsci5tb2RlbC5yb3RhdGlvbi55ID0gKG51bSlwbHIucm90YXRpb24ueDsKICAgIH0KfQoKYWN0aW9uIHBscmJodnJfY19vbk5ldHdvcmtNZXNzYWdlKHN0ciBpZCwgb2JqIGRhdGEpIHsKICAgIGlmIChpZCA9PSAicGxycyIpewogICAgICAgIHBscmJodnJfY19vbGRUaW1lID0gcGxyYmh2cl9jX25ld1RpbWU7CiAgICAgICAgcGxyYmh2cl9jX25ld1RpbWUgPSBnX3Rub3c7CiAgICAgICAgcGxyYmh2cl9jX2RhdGFCdWZmZXIgPSBwbHJiaHZyX2NfbmV3VGltZSAtIHBscmJodnJfY19vbGRUaW1lOwoKICAgICAgICBvYmpbXSBuZXRwbHJzID0gKG9ialtdKWRhdGEucGxycyA7CiAgICAgICAgc3RyW10gbGVmdHBscnMgPSAoc3RyW10pZGF0YS5sZWZ0OwogICAgICAgIGZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgbGVmdHBscnM7aSsrKXsKICAgICAgICAgICAgb2JqIHVzciA9IHBscmJodnJfY19maW5kQnlJZChsZWZ0cGxyc1tpXSk7CiAgICAgICAgICAgIGlmICgoc3RyKXVzci5pZCE9InVuZGVmaW5lZCIpewogICAgICAgICAgICAgICAgcGxyYmh2cl9jX3JlbW92ZUJ5SWQoKHN0cil1c3IuaWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgbmV0cGxyczsgaSsrKXsKICAgICAgICAgICAgb2JqIHBscmRhdGEgPSBuZXRwbHJzW2ldOwogICAgICAgICAgICBvYmogdXNyID0gcGxyYmh2cl9jX2ZpbmRCeUlkKChzdHIpcGxyZGF0YS5pZCk7CiAgICAgICAgICAgICMgb2JqIHVzciA9IHBscmJodnJfY19maW5kQnlVc2VybmFtZSgoc3RyKXBscmRhdGEubik7CiAgICAgICAgICAgIGlmICgoc3RyKXVzci5pZCE9InVuZGVmaW5lZCIpewogICAgICAgICAgICAgICAgIyBHQU1FLmxvZygidXNyIGZvdW5kIix1c3IpOwogICAgICAgICAgICAgICAgIyB1c3IucG9zaXRpb24ueCA9IChudW0pcGxyZGF0YS5wb3MueDsKICAgICAgICAgICAgICAgICMgdXNyLnBvc2l0aW9uLnkgPSAobnVtKXBscmRhdGEucG9zLnkrNTsKICAgICAgICAgICAgICAgICMgdXNyLnBvc2l0aW9uLnogPSAobnVtKXBscmRhdGEucG9zLno7CiAgICAgICAgICAgICAgICAjIHVzci5yb3RhdGlvbi54ID0gKG51bSlwbHJkYXRhLnJvdC54OwogICAgICAgICAgICAgICAgIyB1c3Iucm90YXRpb24ueSA9IChudW0pcGxyZGF0YS5yb3QueTsKCiAgICAgICAgICAgICAgICB1c3Iub2xkcG9zLnggPSAobnVtKSB1c3IubmV3cG9zLng7CiAgICAgICAgICAgICAgICB1c3Iub2xkcG9zLnkgPSAobnVtKSB1c3IubmV3cG9zLnk7CiAgICAgICAgICAgICAgICB1c3Iub2xkcG9zLnogPSAobnVtKSB1c3IubmV3cG9zLno7CgogICAgICAgICAgICAgICAgdXNyLm9sZHJvdC54ID0gKG51bSkgdXNyLm5ld3JvdC54OwogICAgICAgICAgICAgICAgdXNyLm9sZHJvdC55ID0gKG51bSkgdXNyLm5ld3JvdC55OwoKICAgICAgICAgICAgICAgIHVzci5uZXdwb3MueCA9IChudW0pIHBscmRhdGEucG9zLng7CiAgICAgICAgICAgICAgICB1c3IubmV3cG9zLnkgPSAobnVtKSBwbHJkYXRhLnBvcy55KzU7CiAgICAgICAgICAgICAgICB1c3IubmV3cG9zLnogPSAobnVtKSBwbHJkYXRhLnBvcy56OwogICAgICAgICAgICAgICAgdXNyLm5ld3JvdC54ID0gKG51bSkgcGxyZGF0YS5yb3QueDsKICAgICAgICAgICAgICAgIHVzci5uZXdyb3QueSA9IChudW0pIHBscmRhdGEucm90Lnk7CgoKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoKChzdHIpcGxyZGF0YS5pZCAhPShzdHIpcGxyYmh2cl9jX3NlbGYuaWQpICYmICgoc3RyKXBscmJodnJfY19zZWxmLmlkIT0gInVuZGVmaW5lZCIpKXsKICAgICAgICAgICAgICAgIEdBTUUubG9nKCJuZXcgdXNlciIscGxyZGF0YSk7CiAgICAgICAgICAgICAgICAjIEdBTUUubG9nKCJuZXcgdXNlciBmb3VuZC4gY3JlYXRpbmcgbW9kZWwiKTsKICAgICAgICAgICAgICAgICMgR0FNRS5sb2coInVzciIsdXNyKTsKICAgICAgICAgICAgICAgICMgR0FNRS5sb2coInNlbGYiLHBscmJodnJfY19zZWxmKTsKICAgICAgICAgICAgICAgIG9iaiBtb2RlbCA9IEdBTUUuU0NFTkUuYWRkQXNzZXQoIjEzMjZuZXNhIiwwLDUsMCAsMSwiI2ZmZmZmZiIsIHtvcGFjaXR5OjF9KTsKICAgICAgICAgICAgICAgIGFkZFRvIHBscmJodnJfY19wbHJzIHsKICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTooc3RyKXBscmRhdGEubiwKICAgICAgICAgICAgICAgICAgICBpZDooc3RyKXBscmRhdGEuaWQsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ewogICAgICAgICAgICAgICAgICAgICAgICB4IDoobnVtKXBscmRhdGEucG9zLngsCiAgICAgICAgICAgICAgICAgICAgICAgIHkgOihudW0pcGxyZGF0YS5wb3MueSwKICAgICAgICAgICAgICAgICAgICAgICAgeiA6KG51bSlwbHJkYXRhLnBvcy56CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICByb3RhdGlvbjp7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6KG51bSlwbHJkYXRhLnJvdC54LAogICAgICAgICAgICAgICAgICAgICAgICB5OihudW0pcGxyZGF0YS5yb3QueQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb2xkcm90OnsKICAgICAgICAgICAgICAgICAgICAgICAgeDoobnVtKXBscmRhdGEucm90LngsCiAgICAgICAgICAgICAgICAgICAgICAgIHk6KG51bSlwbHJkYXRhLnJvdC55CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBuZXdyb3Q6ewogICAgICAgICAgICAgICAgICAgICAgICB4OihudW0pcGxyZGF0YS5yb3QueCwKICAgICAgICAgICAgICAgICAgICAgICAgeToobnVtKXBscmRhdGEucm90LnkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9sZHBvczogewogICAgICAgICAgICAgICAgICAgICAgICB4IDoobnVtKXBscmRhdGEucG9zLngsCiAgICAgICAgICAgICAgICAgICAgICAgIHkgOihudW0pcGxyZGF0YS5wb3MueSwKICAgICAgICAgICAgICAgICAgICAgICAgeiA6KG51bSlwbHJkYXRhLnBvcy56CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBuZXdwb3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgeCA6KG51bSlwbHJkYXRhLnBvcy54LAogICAgICAgICAgICAgICAgICAgICAgICB5IDoobnVtKXBscmRhdGEucG9zLnksCiAgICAgICAgICAgICAgICAgICAgICAgIHogOihudW0pcGxyZGF0YS5wb3MuegogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbW9kZWw6bW9kZWwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlkID09ICJjbHJwbHJzIil7CiAgICAgICAgZm9yIChudW0gaSA9IGxlbmd0aE9mIHBscmJodnJfY19wbHJzIC0gMTsgaSA+PSAwOyBpKyspewogICAgICAgICAgICBvYmogcGxyID0gcGxyYmh2cl9jX3BscnNbaV07CiAgICAgICAgICAgIHBsci5tb2RlbC5kZWxldGUoKTsKICAgICAgICAgICAgcmVtb3ZlIHBscmJodnJfY19wbHJzW2ldOwogICAgICAgIH0KICAgIH0KfQoKCmFjdGlvbiBwbHJiaHZyX2Nfb25QbGF5ZXJTcGF3bihzdHIgaWQpIHsKICAgIG9iaiB1c3IgPSBwbHJiaHZyX2NfZmluZEJ5SWQoaWQpOwogICAgaWYgKChzdHIpdXNyLmlkIT0idW5kZWZpbmVkIil7CiAgICAgICAgdXNyLm1vZGVsLm9wYWNpdHkgPSAxOwogICAgfQp9CmFjdGlvbiBwbHJiaHZyX2Nfb25QbGF5ZXJEZWF0aChzdHIgaWQsIHN0ciBraWxsZXJJRCkgewogICAgR0FNRS5sb2coInBsciBkaWVkIixpZCk7CiAgICBvYmogdXNyID0gcGxyYmh2cl9jX2ZpbmRCeUlkKGlkKTsKICAgIGlmICgoc3RyKXVzci5pZCE9InVuZGVmaW5lZCIpewogICAgICAgIHVzci5tb2RlbC5vcGFjaXR5ID0gMDsKICAgIH0KfQoKIyBwdWJsaWMgYWN0aW9uIG9uR2FtZUVuZCgpewojICAgICBmb3IgKG51bSBpID0gbGVuZ3RoT2YgcGxyYmh2cl9jX3BscnMgLSAxOyBpID49IDA7IGkrKyl7CiMgICAgICAgICBvYmogcGxyID0gcGxyYmh2cl9jX3BscnNbaV07CiMgICAgICAgICBwbHIubW9kZWwuZGVsZXRlKCk7CiMgICAgICAgICByZW1vdmUgcGxyYmh2cl9jX3BscnNbaV07CiMgICAgIH0KIyB9CgphY3Rpb24gcGxyYmh2cl9jX3N0YXJ0KCl7CiAgICBwbHJiaHZyX2Nfc2VsZiA9IEdBTUUuUExBWUVSUy5nZXRTZWxmKCk7Cn0KCmFjdGlvbiBwbHJiaHZyX2NfcmVuZGVyKG51bSBkZWx0YSl7CiAgICAjIG9ialtdIHBscmJodnJfY19wbHJzID0gR0FNRS5QTEFZRVJTLmxpc3QoKTsKICAgIG9iaiB5b3UgPSBHQU1FLlBMQVlFUlMuZ2V0U2VsZigpOwoJZm9yIChudW0gaT0wOyBpIDwgbGVuZ3RoT2YgcGxyYmh2cl9jX3BscnM7IGkrKykgewoJCW9iaiBwbHIgPSBwbHJiaHZyX2NfcGxyc1tpXTsKICAgICAgICBpZiAoMTAwID4gVVRJTFMuZ2V0RGlzdDNEKChudW0peW91LnBvc2l0aW9uLngsKG51bSl5b3UucG9zaXRpb24ueSwobnVtKXlvdS5wb3NpdGlvbi56LChudW0pcGxyLnBvc2l0aW9uLngsKG51bSlwbHIucG9zaXRpb24ueSwobnVtKXBsci5wb3NpdGlvbi56KSkgewogICAgICAgICAgICBvYmogcG9zID0gR0FNRS5TQ0VORS5wb3NUb1NjcmVlbigobnVtKSBwbHIubW9kZWwucG9zaXRpb24ueCwgKG51bSlwbHIubW9kZWwucG9zaXRpb24ueSs3LCAobnVtKXBsci5tb2RlbC5wb3NpdGlvbi56KTsKICAgICAgICAgICAgaWYgKChib29sKXBvcy5vblNjcmVlbil7CiAgICAgICAgICAgICAgICBHQU1FLk9WRVJMQVkuZHJhd1RleHQoKHN0cilwbHIudXNlcm5hbWUsIChudW0pcG9zLngtcGxyYmh2cl9jX1NJWkVOQU1FKjIsIChudW0pcG9zLnksIDAsIHBscmJodnJfY19TSVpFTkFNRSwgIiIsICIjRkZGRkZGIiwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CQoJfQp9CgphY3Rpb24gcGxyYmh2cl9jX29uUGxheWVyVXBkYXRlKHN0ciBpZCwgbnVtIGRlbHRhLCBvYmogaW5wdXRzKSB7CiAgICBvYmogeW91ID0gR0FNRS5QTEFZRVJTLmdldFNlbGYoKTsKICAgICMgR0FNRS5sb2coeW91KTsKICAgIGlmICgoYm9vbCl5b3Uub25Hcm91bmQgPT0gdHJ1ZSl7CiAgICAgICAgcGxyYmh2cl9jX3NhdmVzdGF0ZSA9IHsKICAgICAgICAgICAgcG9zaXRpb246ewogICAgICAgICAgICAgICAgeDoobnVtKXlvdS5wb3NpdGlvbi54LAogICAgICAgICAgICAgICAgeToobnVtKXlvdS5wb3NpdGlvbi55LAogICAgICAgICAgICAgICAgejoobnVtKXlvdS5wb3NpdGlvbi56CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZlbG9jaXR5OnsKICAgICAgICAgICAgICAgIHg6KG51bSl5b3UudmVsb2NpdHkueCwKICAgICAgICAgICAgICAgIHk6KG51bSl5b3UudmVsb2NpdHkueSwKICAgICAgICAgICAgICAgIHo6KG51bSl5b3UudmVsb2NpdHkuegogICAgICAgICAgICB9LAogICAgICAgICAgICByb3RhdGlvbjp7CiAgICAgICAgICAgICAgICB4OihudW0peW91LnJvdGF0aW9uLngsCiAgICAgICAgICAgICAgICB5OihudW0peW91LnJvdGF0aW9uLnkKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgcGxyYmh2cl9jX3Rub3cgPSBnX3Rub3c7CiAgICBwbHJiaHZyX2NfY3IgPSAoYm9vbClpbnB1dHMuY3JvdWNoOwogICAgb2JqIHRQbHIgPSBHQU1FLlBMQVlFUlMuZmluZEJ5SUQoaWQpOwogICAgCiAgICAjY3VycmVudGx5IGNvbGxpZGVzIHdpdGggQUxMIG9iamVjdHMKICAgIGlmIChub3RFbXB0eSB0UGxyKSB7CiAgICAgICAgb2JqW10gcmVzID0gQUFCQl9yZXNvbHZlcGxyKHRQbHIscGxyYmh2cl9jX2NyLHN5bmNvYmpzX2Nfb2JqbGlzdCk7CiAgICAgICAgaWYgKChzdHIpdFBsci50T25PYmpJZGxlID09ICJ1bmRlZmluZWQiKXsKICAgICAgICAgICAgdFBsci50T25PYmpJZGxlID0gMDsKICAgICAgICB9IAogICAgICAgIGlmICgoc3RyKXRQbHIudE9uT2JqTW92ID09ICJ1bmRlZmluZWQiKXsKICAgICAgICAgICAgdFBsci50T25PYmpNb3YgPSAwOwogICAgICAgIH0gCiAgICAgICAgZm9yIChudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiByZXM7IGkrKyl7CiAgICAgICAgICAgIG9iaiBjZGF0YSA9IHJlc1tpXTsKICAgICAgICAgICAgbnVtIGNvbHNpZGUgPSAobnVtKSBjZGF0YS5jb2xzaWRlOwogICAgICAgICAgICBvYmogY29iaiA9IChvYmopY2RhdGEuY29sb2JqOwoKICAgICAgICAgICAgaWYgKGNvbHNpZGUgPT0gQUFCQl9ZTkVHKXsKICAgICAgICAgICAgICAgIGlmICgoc3RyKWlucHV0cy5tb3ZEaXIgIT0idW5kZWZpbmVkIil7CiAgICAgICAgICAgICAgICAgICAgaWYgKChudW0pdFBsci50T25PYmpNb3YgPT0gMCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRQbHIudE9uT2JqTW92ID0gcGxyYmh2cl9jX3Rub3c7CiAgICAgICAgICAgICAgICAgICAgICAgIHRQbHIudE9uT2JqSWRsZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICBudW0gbW92RGlyID0gKG51bSlpbnB1dHMubW92RGlyOwogICAgICAgICAgICAgICAgICAgIG1vdkRpciAtPSAoKG51bSlpbnB1dHMubW91c2VYKTsKICAgICAgICAgICAgICAgICAgICAjIHZlbG9jaXR5IHJlbGF0aXZlIHRvIG1vdmluZyBwbGF0Zm9ybQogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicygobnVtKSBjb2JqLnZlbG9jaXR5LngpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0UGxyLnZlbG9jaXR5LnggPSAobnVtKWNvYmoudmVsb2NpdHkueCArIChwbHJiaHZyX2NfTUFYV0FMS1NQRUVEICogTWF0aC5jb3MobW92RGlyKSkgKiAocGxyYmh2cl9jX3Rub3ctKG51bSl0UGxyLnRPbk9iak1vdikvKChwbHJiaHZyX2NfdG5vdy0obnVtKXRQbHIudE9uT2JqTW92KSsxMDApIDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKChudW0pIGNvYmoudmVsb2NpdHkueikgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRQbHIudmVsb2NpdHkueiA9IChudW0pY29iai52ZWxvY2l0eS56ICsgKHBscmJodnJfY19NQVhXQUxLU1BFRUQgKiBNYXRoLnNpbihtb3ZEaXIpKSAqIChwbHJiaHZyX2NfdG5vdy0obnVtKXRQbHIudE9uT2JqTW92KS8oKHBscmJodnJfY190bm93LShudW0pdFBsci50T25PYmpNb3YpKzEwMCkgOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKG51bSl0UGxyLnRPbk9iaklkbGUgPT0wKSAKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRQbHIudE9uT2JqSWRsZSA9IHBscmJodnJfY190bm93OwogICAgICAgICAgICAgICAgICAgICAgICB0UGxyLnRPbk9iak1vdiA9IDA7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICAjIGRlY2NlbGVyYXRlIHJlbGF0aXZlIHRvIG1vdmluZyBwbGF0Zm9ybQogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicygobnVtKSBjb2JqLnZlbG9jaXR5LngpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAobnVtKSB0UGxyLnZlbG9jaXR5LnggKz0gKChudW0pY29iai52ZWxvY2l0eS54IC0gKG51bSl0UGxyLnZlbG9jaXR5LngpICogKHBscmJodnJfY190bm93LShudW0pdFBsci50T25PYmpJZGxlKS8oKHBscmJodnJfY190bm93LShudW0pdFBsci50T25PYmpJZGxlKSsxNTApOwogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKChudW0pIGNvYmoudmVsb2NpdHkueikgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIChudW0pIHRQbHIudmVsb2NpdHkueiArPSAoKG51bSljb2JqLnZlbG9jaXR5LnogLSAobnVtKXRQbHIudmVsb2NpdHkueikgKiAocGxyYmh2cl9jX3Rub3ctKG51bSl0UGxyLnRPbk9iaklkbGUpLygocGxyYmh2cl9jX3Rub3ctKG51bSl0UGxyLnRPbk9iaklkbGUpKzE1MCk7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH0gICAKICAgICAgICB9CiAgICB9Cn0KIyBlbnRpdHkgY29tcG9uZW50IHN5c3RlbQojaW5jbHVkZSA8c3luY29ianNfYy5rcm5rPgojaW5jbHVkZSA8cGxydXRpbF9jLmtybms+CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBMaWJyYXJ5OiBcbGlic1xFQ1NcZWNzX2Mua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogRW50aXR5ISBDb21wb25lbnQhIFN5c3RlbSEhIQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgoKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIGF1dG8tZGV0ZWN0ZWQgcHVibGljIGFjdGlvbnMgZnJvbSBsaWJyYXJpZXMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CnB1YmxpYyBhY3Rpb24gb25HYW1lRW5kICgpewogICAgc3luY29ianNfY19vbkdhbWVFbmQoKTsKfQoKcHVibGljIGFjdGlvbiB1cGRhdGUgKG51bSBkZWx0YSl7CiAgICBnX3VwZGF0ZShkZWx0YSk7CiAgICBzeW5jb2Jqc19jX3VwZGF0ZShkZWx0YSk7CiAgICBwbHJiaHZyX2NfdXBkYXRlKGRlbHRhKTsKfQoKcHVibGljIGFjdGlvbiBvblBsYXllclVwZGF0ZSAoc3RyIGlkLCBudW0gZGVsdGEsIG9iaiBpbnB1dHMpewogICAgcGxyYmh2cl9jX29uUGxheWVyVXBkYXRlKGlkLCAgZGVsdGEsICBpbnB1dHMpOwp9CgpwdWJsaWMgYWN0aW9uIHN0YXJ0ICgpewogICAgcGxydXRpbF9jX3N0YXJ0KCk7CiAgICBzeW5jb2Jqc19jX3N0YXJ0KCk7CiAgICBwbHJiaHZyX2Nfc3RhcnQoKTsKfQoKcHVibGljIGFjdGlvbiBvblBsYXllclNwYXduIChzdHIgaWQpewogICAgcGxydXRpbF9jX29uUGxheWVyU3Bhd24oaWQpOwogICAgQUFCQl9vblBsYXllclNwYXduKGlkKTsKICAgIHBscmJodnJfY19vblBsYXllclNwYXduKGlkKTsKfQoKcHVibGljIGFjdGlvbiBvbk5ldHdvcmtNZXNzYWdlIChzdHIgaWQsIG9iaiBkYXRhKXsKICAgIHN5bmNvYmpzX2Nfb25OZXR3b3JrTWVzc2FnZShpZCwgIGRhdGEpOwogICAgcGxyYmh2cl9jX29uTmV0d29ya01lc3NhZ2UoaWQsICBkYXRhKTsKfQoKcHVibGljIGFjdGlvbiBvblBsYXllckRlYXRoIChzdHIgaWQsIHN0ciBraWxsZXJJRCl7CiAgICBwbHJ1dGlsX2Nfb25QbGF5ZXJEZWF0aChpZCwgIGtpbGxlcklEKTsKICAgIHBscmJodnJfY19vblBsYXllckRlYXRoKGlkLCAga2lsbGVySUQpOwp9CgpwdWJsaWMgYWN0aW9uIHJlbmRlciAobnVtIGRlbHRhKXsKICAgIHBscmJodnJfY19yZW5kZXIoZGVsdGEpOwp9Cgo=","server":"IyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgSGVhZGVyOiBcbGlic1x1dGlsc1xnbG9iYWxcZy5rcm5rCiMgQXV0aG9yOiBibGFuZHJpY2UKIyAgIERlc2NyaXB0aW9uOiBzb21lIGdsb2JhbCB2YXJzIHRoYXQgb3RoZXIgbGlicyBjYW4gcmVmZXJlbmNlIHRvIHJlZHVjZSBjYWxscwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgpudW0gZ190bm93ID0gMDsKCmFjdGlvbiBnX3VwZGF0ZShudW0gZGVsdGEpewogICAgZ190bm93ID0gR0FNRS5USU1FLm5vdygpOwp9CiNpbmNsdWRlIDxnLmtybms+CiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIExpYnJhcnk6IFxsaWJzXHBscnV0aWxfc19zcGF3bmVkUGxheWVyc1xwbHJ1dGlsX3Mua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogd29ya2Fyb3VuZCB0byBjaGVjayBob3cgbWFueSBwbGF5ZXJzIGFyZSBzcGF3bmVkIGluCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKc3RyW10gcGxydXRpbF9zX3NwYXduZWRQbGF5ZXJzID0gc3RyW107CmJvb2wgcGxydXRpbF9zX3NvbG9nYW1lID0gdHJ1ZTsKbnVtIHBscnV0aWxfc190Rmlyc3RTcGF3bmVkUGxheWVyID0gMDsKbnVtIHBscnV0aWxfc190TGFzdFNwYXduZWRQbGF5ZXIgPSAwOwoKCmFjdGlvbiBwbHJ1dGlsX3Nfc3RhcnQoKSB7CiAgICBwbHJ1dGlsX3Nfc3Bhd25lZFBsYXllcnMgPSBzdHJbXTsKICAgIHBscnV0aWxfc190Rmlyc3RTcGF3bmVkUGxheWVyID0gMDsKICAgIHBscnV0aWxfc190TGFzdFNwYXduZWRQbGF5ZXIgPSAwOwogICAgcGxydXRpbF9zX3NvbG9nYW1lID0gdHJ1ZTsKfQoKCiMgUGxheWVyIGRpZWQKYWN0aW9uIHBscnV0aWxfc19vblBsYXllckRlYXRoKHN0ciBpZCwgc3RyIGtpbGxlcklEKSB7CiAgICBmb3IgKG51bSBpID0gbGVuZ3RoT2YgcGxydXRpbF9zX3NwYXduZWRQbGF5ZXJzLTE7IGkgPj0wOyBpLS0pIHsKICAgICAgICBpZiAoaWQgPT0gcGxydXRpbF9zX3NwYXduZWRQbGF5ZXJzW2ldKSB7CiAgICAgICAgICAgIHJlbW92ZSBwbHJ1dGlsX3Nfc3Bhd25lZFBsYXllcnNbaV07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KfQojIFdoZW4gYSBwbGF5ZXIgbGVhdmVzIHRoZSBzZXJ2ZXIKYWN0aW9uIHBscnV0aWxfc19vblBsYXllckxlYXZlKHN0ciBwbGF5ZXJJRCkgewogICAgZm9yIChudW0gaSA9IGxlbmd0aE9mIHBscnV0aWxfc19zcGF3bmVkUGxheWVycy0xOyBpID49MDsgaS0tKSB7CiAgICAgICAgaWYgKHBsYXllcklEID09IHBscnV0aWxfc19zcGF3bmVkUGxheWVyc1tpXSkgewogICAgICAgICAgICByZW1vdmUgcGxydXRpbF9zX3NwYXduZWRQbGF5ZXJzW2ldOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9Cn0KIyBTcGF3biBOb3RpZmljYXRpb24gbXVzdCBjb21lIGZyb20gQ2xpZW50CmFjdGlvbiBwbHJ1dGlsX3Nfb25OZXR3b3JrTWVzc2FnZShzdHIgaWQsIG9iaiBkYXRhLCBzdHIgcGxheWVySUQpIHsKICAgIGlmIChpZCA9PSAic3Bhd24iKSB7CiAgICAgICAgYm9vbCBoYXNTcGF3bmVkID0gZmFsc2U7CiAgICAgICAgZm9yIChudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBwbHJ1dGlsX3Nfc3Bhd25lZFBsYXllcnM7IGkrKykgewogICAgICAgICAgICBpZiAocGxydXRpbF9zX3NwYXduZWRQbGF5ZXJzW2ldID09IGlkKSB7CiAgICAgICAgICAgICAgICBoYXNTcGF3bmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghaGFzU3Bhd25lZCkge2FkZFRvIHBscnV0aWxfc19zcGF3bmVkUGxheWVycyBwbGF5ZXJJRDt9CiAgICAgICAgaWYgKGxlbmd0aE9mIHBscnV0aWxfc19zcGF3bmVkUGxheWVycyA+PSAyKSB7cGxydXRpbF9zX3NvbG9nYW1lID0gZmFsc2U7fQogICAgICAgIGlmIChwbHJ1dGlsX3NfdEZpcnN0U3Bhd25lZFBsYXllciA9PSAwKSB7cGxydXRpbF9zX3RGaXJzdFNwYXduZWRQbGF5ZXIgPSBnX3Rub3c7fQogICAgICAgIHBscnV0aWxfc190TGFzdFNwYXduZWRQbGF5ZXIgPSBnX3Rub3c7CiAgICB9Cn0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTGlicmFyeTogbGlic1x1dGlsc1xwbHJiZWhhdmlvclxwbHJiaHZyX3Mua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogZGlzYWJsZSBzZXJ2ZXIgc3luYyArIGJlaGF2aW9yIGZvciBjdXN0b20gbW92ZW1lbnQKIyAgIHNlbmQgcGxyIHBvc2l0aW9uL3ZlbCB0byBzZXJ2ZXIgbWFudWFsbHkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpudW0gcGxyYmh2cl9zX3RsYXN0YnJvYWRjYXN0ID0gMDsKbnVtIHBscmJodnJfc19JTlRFUlZBTF9CUk9BRENBU1QgPSAxMDA7CnN0cltdIHBscmJodnJfc19wbHJzbGVmdCA9IHN0cltdOwoKYWN0aW9uIHBscmJodnJfc19zdGFydCgpewogICAgR0FNRS5ERUZBVUxULmRpc2FibGVTZXJ2ZXJTeW5jKCk7CglHQU1FLkRFRkFVTFQuZGlzYWJsZVBsYXllckJlaGF2aW91cigpOwp9CgphY3Rpb24gcGxyYmh2cl9zX29uTmV0d29ya01lc3NhZ2Uoc3RyIGlkLCBvYmogZGF0YSwgc3RyIHBsYXllcklEKSB7CiAgICBvYmogcGxyID0gR0FNRS5QTEFZRVJTLmZpbmRCeUlEKHBsYXllcklEKTsKICAgIGlmIChpZCA9PSAicGxyYmh2ciIpewogICAgICAgIHBsci5wb3NpdGlvbi54ID0gKG51bSlkYXRhLnBvc2l0aW9uLng7CiAgICAgICAgcGxyLnBvc2l0aW9uLnkgPSAobnVtKWRhdGEucG9zaXRpb24ueTsKICAgICAgICBwbHIucG9zaXRpb24ueiA9IChudW0pZGF0YS5wb3NpdGlvbi56OwogICAgICAgIHBsci52ZWxvY2l0eS54ID0gKG51bSlkYXRhLnZlbG9jaXR5Lng7CiAgICAgICAgcGxyLnZlbG9jaXR5LnkgPSAobnVtKWRhdGEudmVsb2NpdHkueTsKICAgICAgICBwbHIudmVsb2NpdHkueiA9IChudW0pZGF0YS52ZWxvY2l0eS56OwogICAgICAgIHBsci5yb3RhdGlvbi54ID0gKG51bSlkYXRhLnJvdGF0aW9uLng7CiAgICAgICAgcGxyLnJvdGF0aW9uLnkgPSAobnVtKWRhdGEucm90YXRpb24ueTsKICAgIH0gICAKfQoKYWN0aW9uIHBscmJodnJfc191cGRhdGUobnVtIGRlbHRhKSB7CiAgICBvYmpbXSBwbHJzID0gR0FNRS5QTEFZRVJTLmxpc3QoKTsKICAgIG9ialtdIHBscnNwb3Nyb3QgPSBvYmpbXTsKICAgIGlmICgoZ190bm93IC0gcGxyYmh2cl9zX3RsYXN0YnJvYWRjYXN0KSA+IHBscmJodnJfc19JTlRFUlZBTF9CUk9BRENBU1QpewogICAgICAgIHBscmJodnJfc190bGFzdGJyb2FkY2FzdCA9IGdfdG5vdzsKCiAgICAgICAgZm9yIChudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBwbHJzOyBpKyspewogICAgICAgICAgICBvYmogcGxyID0gcGxyc1tpXTsKICAgICAgICAgICAgYWRkVG8gcGxyc3Bvc3JvdCB7CiAgICAgICAgICAgICAgICBuOiAoc3RyKXBsci51c2VybmFtZSwKICAgICAgICAgICAgICAgIGlkOiAoc3RyKXBsci5pZCwKICAgICAgICAgICAgICAgIHBvczp7CiAgICAgICAgICAgICAgICAgICAgeDpNYXRoLnJvdW5kKChudW0pcGxyLnBvc2l0aW9uLngpLAogICAgICAgICAgICAgICAgICAgIHk6TWF0aC5yb3VuZCgobnVtKXBsci5wb3NpdGlvbi55KSwKICAgICAgICAgICAgICAgICAgICB6Ok1hdGgucm91bmQoKG51bSlwbHIucG9zaXRpb24ueikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByb3Q6IHsKICAgICAgICAgICAgICAgICAgICB4Ok1hdGgucm91bmREZWNpbWFsKChudW0pcGxyLnJvdGF0aW9uLngsMiksCiAgICAgICAgICAgICAgICAgICAgeTpNYXRoLnJvdW5kRGVjaW1hbCgobnVtKXBsci5yb3RhdGlvbi55LDIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIEdBTUUuTkVUV09SSy5icm9hZGNhc3QoInBscnMiLCB7cGxyczpwbHJzcG9zcm90LGxlZnQ6cGxyYmh2cl9zX3BscnNsZWZ0fSk7CiAgICAgICAgcGxyYmh2cl9zX3BscnNsZWZ0ID0gc3RyW107CiAgICB9CiAgICAKICAgIAp9CgojIHB1YmxpYyBhY3Rpb24gb25QbGF5ZXJTcGF3bihzdHIgaWQpIHt9CiMgcHVibGljIGFjdGlvbiBvblBsYXllckRlYXRoKHN0ciBpZCwgc3RyIGtpbGxlcklEKSB7fQphY3Rpb24gcGxyYmh2cl9zX29uUGxheWVyTGVhdmUoc3RyIHBsYXllcklEKSB7CiAgICBHQU1FLmxvZygicGxheWVyIGxlZnQiKTsKICAgIGFkZFRvIHBscmJodnJfc19wbHJzbGVmdCBwbGF5ZXJJRDsKCn0KCmFjdGlvbiBwbHJiaHZyX3Nfb25HYW1lRW5kKCl7CiAgICBHQU1FLk5FVFdPUksuYnJvYWRjYXN0KCJjbHJwbHJzIiwge30pOwp9CiNpbmNsdWRlIDxnLmtybms+CiNpbmNsdWRlIDxwbHJ1dGlsX3Mua3Juaz4KI2luY2x1ZGUgPHBscmJodnJfcy5rcm5rPgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBMaWJyYXJ5OiBsaWJzXEVDU1xjb21wb25lbnRzXHNoYWtlXHNoYWtlX3Mua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogdGltZSB0byBzaGFrZSB0aGF0IQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmFjdGlvbiBzaGFrZV9zX29uRUNTVXBkYXRlKG51bSBkZWx0YSwgb2JqIHRvYmosIG9ialtdIG9iamxpc3QpewogICAgaWYgKG5vdEVtcHR5IChvYmopIHRvYmouc2hha2UpewogICAgICAgIGlmICgobnVtKXRvYmouc2hha2UuZW4gPT0gMSl7CiAgICAgICAgICAgIGlmICghbm90RW1wdHkgKG9iail0b2JqLnNoYWtlLm9nKSB7CiAgICAgICAgICAgICAgICB0b2JqLnNoYWtlLm9nID0gewogICAgICAgICAgICAgICAgICAgIHg6KG51bSl0b2JqLnBvc2l0aW9uLngsCiAgICAgICAgICAgICAgICAgICAgeToobnVtKXRvYmoucG9zaXRpb24ueSwKICAgICAgICAgICAgICAgICAgICB6OihudW0pdG9iai5wb3NpdGlvbi56CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghbm90RW1wdHkgKG9iail0b2JqLnNoYWtlLmludGVuc2l0eSkgewogICAgICAgICAgICAgICAgICAgIHRvYmouc2hha2UuaW50ZW5zaXR5ID0ge3g6MSx5OjAsejoxfTsKICAgICAgICAgICAgfSAKICAgICAgICAgICAgaWYgKChzdHIpIHRvYmouc2hha2UudGxhc3RzaGFrZSA9PSAidW5kZWZpbmVkIil7CiAgICAgICAgICAgICAgICB0b2JqLnNoYWtlLnRsYXN0c2hha2UgPSBnX3Rub3c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChudW0pIHRvYmouc2hha2UudGxhc3RzaGFrZSA9PSAwKSB7CiAgICAgICAgICAgICAgICB0b2JqLnNoYWtlLnRsYXN0c2hha2UgPSBnX3Rub3c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGdfdG5vdyAtIChudW0pdG9iai5zaGFrZS50bGFzdHNoYWtlID4gKG51bSl0b2JqLnNoYWtlLmR1cmF0aW9uKXsKICAgICAgICAgICAgICAgIHRvYmouc2hha2UudGxhc3RzaGFrZSA9IDA7CiAgICAgICAgICAgICAgICB0b2JqLnNoYWtlLmVuID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRvYmoucG9zaXRpb24ueCA9ICgobnVtKXRvYmouc2hha2UuaW50ZW5zaXR5LnggIT0gMCkgPyAobnVtKXRvYmouc2hha2Uub2cueCArIFVUSUxTLnJhbmRJbnQoLShudW0pdG9iai5zaGFrZS5pbnRlbnNpdHkueCwgKG51bSl0b2JqLnNoYWtlLmludGVuc2l0eS54KSA6IChudW0pdG9iai5wb3NpdGlvbi54OwogICAgICAgICAgICAgICAgdG9iai5wb3NpdGlvbi55ID0gKChudW0pdG9iai5zaGFrZS5pbnRlbnNpdHkueSAhPSAwKSA/IChudW0pdG9iai5zaGFrZS5vZy55ICsgVVRJTFMucmFuZEludCgtKG51bSl0b2JqLnNoYWtlLmludGVuc2l0eS55LCAobnVtKXRvYmouc2hha2UuaW50ZW5zaXR5LnopIDogKG51bSl0b2JqLnBvc2l0aW9uLnk7CiAgICAgICAgICAgICAgICB0b2JqLnBvc2l0aW9uLnogPSAoKG51bSl0b2JqLnNoYWtlLmludGVuc2l0eS56ICE9IDApID8gKG51bSl0b2JqLnNoYWtlLm9nLnogKyBVVElMUy5yYW5kSW50KC0obnVtKXRvYmouc2hha2UuaW50ZW5zaXR5LnosIChudW0pdG9iai5zaGFrZS5pbnRlbnNpdHkueikgOiAobnVtKXRvYmoucG9zaXRpb24uejsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChub3RFbXB0eSAob2JqKXRvYmouc2hha2Uub2cpIHsKICAgICAgICAgICAgICAgIHRvYmoucG9zaXRpb24ueCA9ICgobnVtKXRvYmouc2hha2UuaW50ZW5zaXR5LnggIT0gMCkgPyAobnVtKXRvYmouc2hha2Uub2cueCA6IChudW0pIHRvYmoucG9zaXRpb24ueDsKICAgICAgICAgICAgICAgIHRvYmoucG9zaXRpb24ueSA9ICgobnVtKXRvYmouc2hha2UuaW50ZW5zaXR5LnkgIT0gMCkgPyAobnVtKXRvYmouc2hha2Uub2cueSA6IChudW0pIHRvYmoucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgIHRvYmoucG9zaXRpb24ueiA9ICgobnVtKXRvYmouc2hha2UuaW50ZW5zaXR5LnogIT0gMCkgPyAobnVtKXRvYmouc2hha2Uub2cueiA6IChudW0pIHRvYmoucG9zaXRpb24uejsKICAgICAgICAgICAgICAgIHRvYmouc2hha2Uub2cgPSB7fTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKI2luY2x1ZGUgPGcua3Juaz4KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgSGVhZGVyOiBcbGlic1xmbG9hdFxkdHlwZXMua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogY3VzdG9tIGZsb2F0IGRhdGEgdHlwZXMtLT4gYmluYXJ5IHJlcHJlc2VudGF0aW9uIGNhbGN1bGF0aW9ucy4KIyAgIEdvYWwgd2FzIHRvIHBhY2sgZmxvYXQgZGF0YSBpbnRvIDE2LWJpdHMgYW5kIHNlbmQgb3ZlciBOZXR3b3JrTWVzc2FnZSAKIyAgIChtdWNoIHNtYWxsZXIgdGhhbiBBU0NJSSBzdHJpbmcgcmVwcmVzZW50YXRpb24pCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpudW0gYWN0aW9uIGR0eXBlc19maW5kTVNCTG9jKG51bSB2KXsKCSMgdiBiZXR0ZXIgYmUgYW4gaW50ZWdlciB1IGR1bWJvCgludW0gciA9IC0xOwoJIyB2ID0gdiA+PiAxOwoJd2hpbGUgKHYgPiAwKSB7CgkJcisrOwoJCXYgPSB2ID4+IDE7Cgl9CglyZXR1cm4gcjsKfQpudW0gYWN0aW9uIGR0eXBlc19mbW9kKG51bSB4LCBudW0gcil7CglyZXR1cm4geCAtIChyKk1hdGguZmxvb3IoeCAvIHIpKTsJCn0Kc3RyIGFjdGlvbiBkdHlwZXNfcHJpbnRCaW5hcnkobnVtIGYpewoJc3RyIHJldHN0ciA9ICIiOwoJZm9yIChudW0gaSA9IDMyLTE7IGkgPj0gMDsgaS0tKSB7CgkJcmV0c3RyICs9IHRvU3RyIChmID4+IGkgJiAweDEpOwoJfQoJcmV0dXJuIHJldHN0cjsKfQpudW0gYWN0aW9uIGR0eXBlc19vbmVzKG51bSBmKXsKCW51bSByZXRudW0gPSAwOwoJZm9yIChudW0gaSA9IDA7IGkgPCBmOyBpKyspewoJCXJldG51bSA9IChyZXRudW0gPDwgMSkgfCAxOwoJfQoJcmV0dXJuIHJldG51bTsJCn0KCgojIGFkYXB0ZWQgZnJvbSBJRUVFIDc1NCBTdGFuZGFyZCBmb3IgU2luZ2xlIFByZWNpc2lvbiAzMiBiaXQgZmxvYXRpbmcKIyBidXQgYWxsb3dzIGZvciB5b3UgdG8gc2VsZWN0ICMgb2YgZXhwb25lbnQgLyBtYW50aXNzYSBiaXRzCiMgaGFsZi1wcmVjaXNpb24gKDE2IGJpdCksIHNpbmdsZS1wcmVjaXNpb24gKDMyIGJpdCkKIyBudW0gZHR5cGVzX01BWF9CSVRTID0gMzI7IG51bSBCSVRTX0VYUCA9IDg7Cm51bSBkdHlwZXNfTUFYX0JJVFMgPSAxNjsgbnVtIEJJVFNfRVhQID0gNTsgCiNkb24ndCBjaGFuZ2UgdG8gc29tZXRoaW5nIGxpa2UgMTYtMy4uIGVycm9yIHVwIHRvIDMwIHVuaXRzIG9ic2VydmVkCgojIChlLmcuIDMyLWJpdCkgZnJvbSBsZWZ0IHRvIHJpZ2h0OgojIDEgYml0IC0gU2lnbiBiaXQgKDIncyBjb21wbGVtZW50KSArPSAoLTEpICogMl5wbGFjZSBpbiBleHBvbmVudAojIDggYml0cyAtIEV4cG9uZW50ICgyXmUpCiMgMjMgYml0cyAtIE1hbnRpc3NhIChwYXJ0IGFmdGVyIGRlY2ltYWwpCiMgcmFuZ2UgPSAyXkJJVFNfRVhQIAojIHByZWNpc2lvbiA9IDEvKDJeZHR5cGVzX0JJVFNfTUFOVCkKCm51bSBkdHlwZXNfQklBUyA9IDIqKihCSVRTX0VYUC0xKS0xOwpudW0gZHR5cGVzX0JJVFNfTUFOVCA9IGR0eXBlc19NQVhfQklUUyAtIDEgLSBCSVRTX0VYUDsKbnVtIGR0eXBlc19TSUdOX0xPQyA9IGR0eXBlc19NQVhfQklUUy0xOwoKbnVtIGFjdGlvbiBkdHlwZXNfbnVtVG9GbG9hdDE2KG51bSBkYXRhKSB7CgkjIDEuIGRldGVybWluZSB0aGUgc2lnbiBiaXQKCW51bSBzaWduYml0ID0gMDsKCWlmIChkYXRhIDwgMCkge3NpZ25iaXQgPSAxOyBkYXRhID0gLWRhdGE7fQogICAgaWYgKGRhdGEgPT0gMCkge3JldHVybiAwO30KCSMgMi4gQ29udmVydCAgd2hvbGUgLyBkZWNpbWFsIGJpdHMgdG8gcHVyZSBiaW5hcnkKCW51bSB3aG9sZSA9IE1hdGguZmxvb3IoZGF0YSk7ICMgZmxvb3IgaXQgc28gaXQncyBqdXN0IGFuIGludGVnZXIgKHdpbGwgYmUgYmV0d2VlbiAwIGFuZCAyXmJpdHNleHApLiBtYXggaXMgdGhlIDIgXiBiaXRzIG9mIHRoZSBleHBvbmVudAoJbnVtIGRlY2ltYWwgPSAoZGF0YSAtIHdob2xlID4gMCkgPyBkYXRhIC0gd2hvbGUgOiAwOwoJbnVtIGRlY2JpdCA9IDB4MDAwOyAKCWZvciAobnVtIGkgPSAwOyBpIDwgZHR5cGVzX0JJVFNfTUFOVDsgaSsrKXsgIyBjb252ZXJ0IGRlY2ltYWxzIGludG8gYmluYXJ5CgkJZGVjaW1hbCAqPSAyOwoJCW51bSB0ZGVjYml0ID0gKGRlY2ltYWwgPj0gMSA/IDEgOiAwKTsKCQlkZWNiaXQgfD0gIHRkZWNiaXQgPDwgKGR0eXBlc19CSVRTX01BTlQtMS1pKTsgIyAxMiAtIGkgCgkJaWYgKGRlY2ltYWwgPj0gMSkge2RlY2ltYWwgLT0xO30KCX0KCQkjIEdBTUUubG9nKCJkZWNiaXQiLGR0eXBlc19wcmludEJpbmFyeShkZWNiaXQpKTsKCgludW0gcHVyYmluYXJ5ID0gKHdob2xlIDw8IGR0eXBlc19CSVRTX01BTlQpIHwgZGVjYml0OwoJCSMgR0FNRS5sb2coInB1cmJpbmFyeSIsZHR5cGVzX3ByaW50QmluYXJ5KHB1cmJpbmFyeSkpOwoJCSMgR0FNRS5sb2coImR0eXBlc19maW5kTVNCTG9jKHB1cmJpbmFyeSkiLGR0eXBlc19maW5kTVNCTG9jKHB1cmJpbmFyeSkpOwoJCgkjIDMuIG5vcm1hbGl6ZSB0byBkZXRlcm1pbmUgbWFudGlzc2EgYW5kIHVuYmlhc2VkIGV4cG9uZW50CgludW0gdW5iaWFzZWRleHAgPSBkdHlwZXNfZmluZE1TQkxvYyhwdXJiaW5hcnkpIC0gZHR5cGVzX0JJVFNfTUFOVDsKCQkjIEdBTUUubG9nKCJ1bmJpYXNlZGV4cCIsdW5iaWFzZWRleHApOwoJIyA0LiBkZXRlcm1pbmUgYmlhc2VkIGV4cG9uZW50CgludW0gYmlhc2VkZXhwID0gdW5iaWFzZWRleHAgKyBkdHlwZXNfQklBUzsKCSMgNS4gcmVtb3ZlIGxlYWRpbmcgMSAoTVNCKQoJCSMgYWxpZ24gZmlyc3QKCW51bSBtYW50aXNzYSA9IHB1cmJpbmFyeTsKCW51bSBhbGlnbm1hbnRpc3NhID0gKGR0eXBlc19CSVRTX01BTlQtMSktZHR5cGVzX2ZpbmRNU0JMb2MobWFudGlzc2EpOwoJaWYgKGFsaWdubWFudGlzc2EgPiAwKSB7CgkJbWFudGlzc2EgPSBtYW50aXNzYSA8PCBhbGlnbm1hbnRpc3NhOwoJfSBlbHNlIHsKCQltYW50aXNzYSA9IG1hbnRpc3NhID4+ICgtMSAqIGFsaWdubWFudGlzc2EpOwoJfQoJbWFudGlzc2EgPSAobWFudGlzc2EgXiAoMSA8PCAoZHR5cGVzX2ZpbmRNU0JMb2MobWFudGlzc2EpKSkpIDw8IDE7ICMgcmVtb3ZlIGxlYWRpbmcgMQoJCSMgR0FNRS5sb2coIm1hbnRpc3NhOiIsZHR5cGVzX3ByaW50QmluYXJ5KG1hbnRpc3NhKSk7CgkJIyBHQU1FLmxvZygibGVmdC1zaGlmdCBieToiLGFsaWdubWFudGlzc2EpOwkKCW51bSBmbG9hdDE2ID0gKHNpZ25iaXQgPDwgZHR5cGVzX1NJR05fTE9DKSB8IChiaWFzZWRleHAgPDwgZHR5cGVzX0JJVFNfTUFOVCkgfCAoIG1hbnRpc3NhICk7CglyZXR1cm4gZmxvYXQxNjsKfQoKbnVtIGFjdGlvbiBkdHlwZXNfZmxvYXQxNlRvTnVtKG51bSBmKSB7CglpZiAoZiA9PSAwKSB7cmV0dXJuIDA7fQogICAgIyBEZXRlcm1pbmUgc2lnbgoJbnVtIHNpZ24gPSAoKChmID4+IGR0eXBlc19TSUdOX0xPQykgJiAweDEpID4gMCkgPyAtMSA6IDE7CgkjIERldGVybWluZSBleHBvbmVudCAyKmUgCgludW0gZXhwID0gKGYgPj4gZHR5cGVzX0JJVFNfTUFOVCkgJiBkdHlwZXNfb25lcyhCSVRTX0VYUCk7IAoJZXhwIC09IGR0eXBlc19CSUFTOwoJIyBDb252ZXJ0IG1hbnRpc3NhIHRvIGRlbmFyeQoJbnVtIG1hbnRpc3NhID0gZiAmIGR0eXBlc19vbmVzKGR0eXBlc19CSVRTX01BTlQpOwoJIyBHQU1FLmxvZygibWFudGlzc2E6ICIsIGR0eXBlc19wcmludEJpbmFyeShtYW50aXNzYSkpOwoJbnVtIG1hbnRkZW4gPSAwOwoJZm9yIChudW0gaSA9IGR0eXBlc19maW5kTVNCTG9jKG1hbnRpc3NhKTsgaSA+PTAgOyBpLS0pIHsKCQludW0gdG1hbiA9IDEvKDIqKihkdHlwZXNfQklUU19NQU5ULWkpKSAqICgobWFudGlzc2EgPj4gaSkgJiAweDEpOwoJCW1hbnRkZW4gKz0gdG1hbjsKCQkKCX0KCW1hbnRkZW4gKz0gMTsgIyBhZGQgMSBiYWNrIAoJbnVtIFJhZCA9IHNpZ24gKiBtYW50ZGVuICogKDIgKiogZXhwKTsKCXJldHVybiBSYWQ7Cn0KCm51bSBhY3Rpb24gZHR5cGVzX251bVRvVWludDE2KG51bSB4KXsKCXJldHVybiAoeCAmIDB4RkZGRik7ICMgY2FwIDY1NTM2IAp9CgpudW0gYWN0aW9uIGR0eXBlc19udW1Ub0ludDE2KG51bSB4KXsKCSMgcmV0dXJuICh4ICYgMHhGRik7ICMgY2FwIDY1NTM2IAoJbnVtIHJldG51bSA9IDA7Cgl4ID0gTWF0aC5yb3VuZCh4KTsKCXggPSAoeCA+IDMyNzY3KSA/IDMyNzY3IDogeDsKCXggPSAoeCA8IC0zMjc2NykgPyAtMzI3NjcgOiB4OwoJIyBjYXAgdG8gbGFyZ2VzdCAvIHNtYWxsZXN0IGludCBzaXplCgoJbnVtIHNpZ24gPSB4IDwgMCA/IDEgOiAwOwoKCWlmIChzaWduID09IDEpIHsKCQl4ID0gLXg7Cgl9CglyZXRudW0gfD0gc2lnbiA8PCAxNTsKCgludW0gaSA9IDE0OyAjIDE1IC0gMQoJd2hpbGUgKHggPiAwKSB7CgkJaWYgKHggLyAoMioqaSkgPj0gMSkgewoJCQlyZXRudW0gfD0gICgxIDw8IGkpOwoJCQl4LT0gKDIqKmkpOwoJCX0KCQlpLS07Cgl9CglyZXR1cm4gcmV0bnVtOwp9CgpudW1bXSBhY3Rpb24gZHR5cGVzX251bVRvX3VpbnQxNkJ5dGVBcnJheShudW0gZGF0YSkgewoJZGF0YSA9IE1hdGgucm91bmQoZGF0YSk7CgludW1bXSByZXRBcnJheSA9IG51bVtdOwoJYWRkVG8gcmV0QXJyYXkgKGRhdGEgPj4gOCkgJiAweGZmOwoJYWRkVG8gcmV0QXJyYXkgKGRhdGEgPj4gMCkgJiAweGZmOwoJCglyZXR1cm4gcmV0QXJyYXk7Cgp9CgpudW0gYWN0aW9uIGR0eXBlc19tZXJnZTJCeXRlcyhudW0gYSxudW0gYikgewoJcmV0dXJuIChiIDw8IDgpIHwgYTsKfQoKbnVtIGFjdGlvbiBkdHlwZXNfSW50MTZUb051bShudW0gYmluKSB7CgkjIG51bSBiaW4gPSAoYiA8PCAweGZmKSB8IGE7CgludW0gc2lnbiA9ICgoYmluICYgMHg4MDAwKSA+IDApID8gLTEgOiAxOwoJbnVtIGRlbmFyeSA9IGJpbiAmIDB4N0ZGRjsKCglyZXR1cm4gc2lnbiAqIGRlbmFyeTsKfQoKIyBpbnQgTnVtYmVycyB0byBieXRlIGFycmF5Cm51bVtdIGFjdGlvbiBkdHlwZXNfaW50MTZ0b0J5dGVBcnJheShudW0gZGF0YSl7CglyZXR1cm4gbnVtWygoZGF0YSA+PiAwKSAmIDB4ZmYpLChkYXRhID4+IDgpICYgMHhmZl07Cn0KCm51bVtdIGFjdGlvbiBkdHlwZXNfaW50MzJ0b0J5dGVBcnJheShudW0gZGF0YSl7CgludW1bXSByZXRhcnIgPSBudW1bXTsKCWFkZFRvIHJldGFyciAoZGF0YSA+PiAwKSAmIDB4ZmY7IAoJYWRkVG8gcmV0YXJyIChkYXRhID4+IDgpICYgMHhmZjsgCglhZGRUbyByZXRhcnIgKGRhdGEgPj4gMTYpICYgMHhmZjsgCglhZGRUbyByZXRhcnIgKGRhdGEgPj4gMjQpICYgMHhmZjsgCglyZXR1cm4gcmV0YXJyOwp9CgpudW1bXSBhY3Rpb24gZHR5cGVzX0NvbG9yVG9CeXRlQXJyYXkobnVtIGNvbG9yKSB7CgludW1bXSByZXRBcnJheSA9IG51bVtdOwoJYWRkVG8gcmV0QXJyYXkgKGNvbG9yID4+IDApICYgMHhmZjsKCWFkZFRvIHJldEFycmF5IChjb2xvciA+PiA4KSAmIDB4ZmY7CglhZGRUbyByZXRBcnJheSAoY29sb3IgPj4gMTYpICYgMHhmZjsKCQoJcmV0dXJuIHJldEFycmF5Owp9CgpzdHIgZHR5cGVzX2FscGhhYmV0ID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5ISMkJSYoKSorLC4vOjs8PT4/QFtdXl9ge3x9fi0iOwoKIyBSZWN1cnNpb24gZHVlIHRvIGxvb3AgbGltaXRzCm51bSBhY3Rpb24gZHR5cGVzX2dldFZhbHVlKHN0ciBjLCBudW0gaW5kZXgpIHsKCWlmKGluZGV4ID49IGxlbmd0aE9mIGR0eXBlc19hbHBoYWJldCkgewoJCXJldHVybiAtMTsKCX0KCQoJaWYoZHR5cGVzX2FscGhhYmV0W2luZGV4XSA9PSBjKSB7CgkJcmV0dXJuIGluZGV4OwoJfQoJCglyZXR1cm4gZHR5cGVzX2dldFZhbHVlKGMsIGluZGV4ICsgMSk7Cn0KCm51bVtdIGFjdGlvbiBkdHlwZXNfc3RydG9CeXRlQXJyYXkoc3RyIHMpewoJbnVtW10gcmV0QXJyYXkgPSBudW1bXTsKCWZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgczsgaSsrKXsKCQlhZGRUbyByZXRBcnJheSBkdHlwZXNfZ2V0VmFsdWUoc1tpXSwwKTsKCX0KCXJldHVybiByZXRBcnJheTsKfQoKc3RyIGFjdGlvbiBkdHlwZXNfQnl0ZUFycmF5VG9TdHIobnVtW10gYil7CglzdHIgcyA9ICIiOwoJZm9yIChudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBiOyBpKyspewoJCWlmIChiW2ldID49MCkKCQl7CgkJCXMgKz0gZHR5cGVzX2FscGhhYmV0W2JbaV1dOwkKCQl9Cgl9CglyZXR1cm4gczsKfQoKc3RyW10gZHR5cGVzX2xvb2t1cCA9IHN0clsiMCIsIjEiLCIyIiwiMyIsIjQiLCI1IiwiNiIsIjciLCI4IiwiOSIsIkEiLCJCIiwiQyIsIkQiLCJFIiwiRiJdOwoKc3RyIGFjdGlvbiBkdHlwZXNfbnVtMmhleHN0cmluZyhudW0gbil7CglzdHIgaGV4c3RyID0gIiI7Cglmb3IgKG51bSBpID0wOyBpIDwgNjsgaSsrKXsKCQloZXhzdHIgPSBkdHlwZXNfbG9va3VwW24gJiAweEZdICsgaGV4c3RyOwoJCW4gPSBuID4+IDQ7Cgl9CglyZXR1cm4gaGV4c3RyOwp9CgpudW0gYWN0aW9uIGR0eXBlc19oZXhzdHJpbmcybnVtKHN0ciBoKXsKCW51bSBuID0gMDsKCWggPSBVVElMUy50b1VwcGVyKGgpOwoJZm9yIChudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBoOyBpKyspewoJCWZvciAobnVtIGogPSAwOyBqIDwgbGVuZ3RoT2YgZHR5cGVzX2xvb2t1cDsgaisrKXsKCQkJaWYgKGR0eXBlc19sb29rdXBbal0gPT0gaFtpXSl7CgkJCQluIHw9IGogPDwgKGxlbmd0aE9mIGggLSAxIC0gaSkqNDsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoJcmV0dXJuIG47Cn0KCm51bSBhY3Rpb24gZHR5cGVzX2NvbnN0cmFpblJhZGlhbnMobnVtIHgpewoJeCA9IGR0eXBlc19mbW9kKHgsTWF0aC5QSTIpOwoJaWYgKHggPCAwKXsKCQl4ICs9IDM2MDsKCX0KICAgIHJldHVybiB4Owp9CgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgSGVhZGVyOiBiOTFlbmNvZGluZ1xiOTEua3JuawojIEF1dGhvcjogU2x4VG5UCiMgRGVzY3JpcHRpb246IEJhc2U5MSBkZWNvZGluZyBjb252ZXJ0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vS3ZhblRUVC9CYXNlTmNvZGluZwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgpvYmogYjkxX2Jhc2U5MSA9IHsKICAgIGFscGhhYmV0OiAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkhIyQlJigpKissLi86Ozw9Pj9AW11eX2B7fH1+LSIKfTsKCiMgUmVjdXJzaW9uIGR1ZSB0byBsb29wIGxpbWl0cwpudW0gYWN0aW9uIGI5MV9nZXRWYWx1ZShzdHIgYywgbnVtIGluZGV4KSB7CglpZihpbmRleCA+PSBsZW5ndGhPZiBiOTFfYmFzZTkxLmFscGhhYmV0KSB7CgkJcmV0dXJuIC0xOwoJfQoJCglpZigoc3RyKWI5MV9iYXNlOTEuYWxwaGFiZXRbaW5kZXhdID09IGMpIHsKCQlyZXR1cm4gaW5kZXg7Cgl9CgkKCXJldHVybiBiOTFfZ2V0VmFsdWUoYywgaW5kZXggKyAxKTsKfQoKbnVtW10gYWN0aW9uIGI5MV9kZWNvZGUoc3RyIGRhdGEpIHsKICAgIG51bSBkdiA9IC0xOwogICAgbnVtIGRuID0gMDsKICAgIG51bSBkYnEgPSAwOwogICAgbnVtW10gcmVzdWx0ID0gbnVtW107CgogICAgZm9yKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIGRhdGE7IGkrKykgewogICAgICAgIG51bSBpdiA9IGI5MV9nZXRWYWx1ZShkYXRhW2ldLCAwKTsKCiAgICAgICAgaWYoaXYgPT0gLTEpIHsgY29udGludWU7IH0KCiAgICAgICAgaWYoZHYgPT0gLTEpIHsKICAgICAgICAgICAgZHYgPSBpdjsgCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBkdiArPSBpdiAqIDkxOwogICAgICAgICAgICBkYnEgfD0gKGR2IDw8IGRuKTsKCiAgICAgICAgICAgIGlmKChkdiAmIDgxOTEpID4gODgpIHsKICAgICAgICAgICAgICAgIGRuICs9IDEzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZG4gKz0gMTQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZG8gLi4uIHdoaWxlPwogICAgICAgICAgICBib29sIGZpcnN0ID0gdHJ1ZTsKCiAgICAgICAgICAgIHdoaWxlKGZpcnN0IHx8IGRuID4gNykgewogICAgICAgICAgICAgICAgYWRkVG8gcmVzdWx0IGRicSAlIDI1NjsKICAgICAgICAgICAgICAgIGRicSA+Pj49IDg7CiAgICAgICAgICAgICAgICBkbiAtPSA4OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkdiA9IC0xOwogICAgICAgIH0KICAgIH0KCglpZihkdiAhPSAtMSkgewoJCWFkZFRvIHJlc3VsdCAoZGJxIHwgZHYgPDwgZG4pICYgMjU1OwoJfQoKCXJldHVybiByZXN1bHQ7Cn0KCiMgQmVpbmcgdXNlZCBzZXJ2ZXItc2lkZQpzdHIgYWN0aW9uIGI5MV9lbmNvZGUobnVtW10gZGF0YSkgewogICAgbnVtIGVuID0gMDsKICAgIG51bSBlYnEgPSAwOwogICAgc3RyIHJlc3VsdCA9ICIiOwoKCWZvcihudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBkYXRhOyBpKyspIHsKCQllYnEgfD0gKGRhdGFbaV0gJiAyNTUpIDw8IGVuOwoJCWVuICs9IDg7CgkJCgkJaWYoZW4gPiAxMykgewoJCQludW0gZXYgPSBlYnEgJiA4MTkxOwoJCQkKCQkJaWYoZXYgPiA4OCkgewoJCQkJZWJxID4+Pj0gMTM7CgkJCQllbiAtPSAxMzsKCQkJfQoJCQllbHNlIHsKCQkJCWV2ID0gZWJxICYgMTYzODM7CgkJCQllYnEgPj4+PSAxNDsKCQkJCWVuIC09IDE0OwoJCQl9CgkJCQoJCQludW0gcXVvdGllbnQgPSBNYXRoLmZsb29yKGV2IC8gOTEpOwoJCQludW0gcmVtYWluZGVyID0gZXYgJSA5MTsKCQkKCQkJcmVzdWx0ICs9IChzdHIpYjkxX2Jhc2U5MS5hbHBoYWJldFtyZW1haW5kZXJdOwoJCQlyZXN1bHQgKz0gKHN0ciliOTFfYmFzZTkxLmFscGhhYmV0W3F1b3RpZW50XTsKCQl9Cgl9CgoJaWYoZW4gPiAwKSB7CgkJCW51bSBxdW90aWVudCA9IE1hdGguZmxvb3IoZWJxIC8gOTEpOwoJCQludW0gcmVtYWluZGVyID0gZWJxICUgOTE7CgoJCQlyZXN1bHQgKz0gKHN0ciliOTFfYmFzZTkxLmFscGhhYmV0W3JlbWFpbmRlcl07CgoJCQlpZihlbiA+IDcgfHwgZWJxID4gOTApIHsKCQkJCXJlc3VsdCArPSAoc3RyKWI5MV9iYXNlOTEuYWxwaGFiZXRbcXVvdGllbnRdOwoJCQl9Cgl9CgoJcmV0dXJuIHJlc3VsdDsKfQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBIZWFkZXI6IFxzdHJ1dGlsc1xzdHJ1dGlscy5rcm5rCiMgQXV0aG9yOiBibGFuZHJpY2UsIFByb2ZOb29iIChyZXBsYWNlYWxsKSwgTWFuaWFNYXBwZXIgKFNwbGljZSkKIyBEZXNjcmlwdGlvbjogQWRkaXRpb25hbCBTdHJpbmcgdXRpbGl0aWVzCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpzdHIgYWN0aW9uIHN0cnV0aWxzX3RydW5jYXRlKHN0ciB0ZXh0LCBudW0gbG4pIHsKICAgIHN0ciByZXQgPSAiIjsKICAgIGZvciAobnVtIGkgPSAwOyBpIDwgbG47IGkrKykgewogICAgICAgIHJldCArPSB0ZXh0W2ldOwogICAgfQogICAgcmV0dXJuIHJldDsKfQoKc3RyIGFjdGlvbiBzdHJ1dGlsc19zcGxpY2Uoc3RyIGlucHV0LCBudW0gc3RhcnQsIG51bSBlbmQpIHsKICAgIG51bSBjaGFyc0xlbiA9IGxlbmd0aE9mIGlucHV0OwogICAgaWYoY2hhcnNMZW4gPT0gMCB8fCBzdGFydCA+PSBjaGFyc0xlbiB8fCBzdGFydCA+PSBlbmQpIHsKICAgICAgICByZXR1cm4gJyc7CiAgICB9CiAgICBpZihlbmQgPiBjaGFyc0xlbikgewogICAgICAgIGVuZCA9IGNoYXJzTGVuOwogICAgfQogICAgc3RyIG91dHB1dCA9ICcnOwogICAgZm9yKG51bSBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykgewogICAgICAgIG91dHB1dCArPSBpbnB1dFtpXTsKICAgIH0KICAgIHJldHVybiBvdXRwdXQ7Cn0KCmJvb2wgYWN0aW9uIHN0cnV0aWxzX3N0YXJ0cyhzdHIgdGV4dCxzdHIgdmFsdWUpIHsKICAgIGlmIChVVElMUy50ZXh0Q29udGFpbnMoc3RydXRpbHNfdHJ1bmNhdGUodGV4dCwgbGVuZ3RoT2YgdmFsdWUpLCB2YWx1ZSkpIHtyZXR1cm4gdHJ1ZTt9IAoJcmV0dXJuIGZhbHNlO30KCnN0cltdIGFjdGlvbiBzdHJ1dGlsc19zcGxpdChzdHIgcywgc3RyIGRlbGltKSB7CglzdHJbXSBvdXRwdXQgPSBzdHJbXTsKCW51bSBpZHhfbWF0Y2hzdGFydCA9IDA7CgogICAgIyBpdGVyYXRlIG92ZXIgc3RyaW5nCiAgICBmb3IobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgczsgaSsrKSB7CiAgICAgICAgYm9vbCBtYXRjaCA9IGZhbHNlOwogICAgICAgIAogICAgICAgICMgbWF0Y2ggZGVsaW1pdGVyCiAgICAgICAgZm9yIChudW0gaiA9IDA7IGogPCBsZW5ndGhPZiBkZWxpbTsgaisrKSB7CgkJCW1hdGNoID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKHNbaStqXSAhPSBkZWxpbVtqXSkgewoJCQkJbWF0Y2ggPSBmYWxzZTsgYnJlYWs7CgkJCX0KCQl9CgogICAgICAgICMgbWF0Y2hlcywgcGFyc2Ugb3V0IHRoZSBzdHJpbmcgcHJldmlvdXMKICAgICAgICBpZiAobWF0Y2gpIHsgCiAgICAgICAgICAgIHN0ciB3b3JkID0gIiI7CiAgICAgICAgICAgIGZvciAobnVtIGogPSBpZHhfbWF0Y2hzdGFydDsgaiA8IGk7IGorKykgewogICAgICAgICAgICAgICAgd29yZCArPSBzW2pdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZFRvIG91dHB1dCB3b3JkOwoKICAgICAgICAgICAgIyBza2lwIGRlbGltaXRlcgogICAgICAgICAgICBpICs9IGxlbmd0aE9mIGRlbGltIC0gMTsKICAgICAgICAgICAgaWR4X21hdGNoc3RhcnQgPSBpKzE7CiAgICAgICAgfQogICAgfSAKICAgIAogICAgIyBhbHNvIHBhcnNlIGxhc3Qgc3RyaW5nCiAgICBzdHIgd29yZCA9ICIiOwogICAgZm9yIChudW0gaSA9IGlkeF9tYXRjaHN0YXJ0OyBpIDwgbGVuZ3RoT2YgczsgaSsrKSB7CiAgICAgICAgd29yZCArPSBzW2ldOwogICAgfQogICAgYWRkVG8gb3V0cHV0IHdvcmQ7CgoJcmV0dXJuIG91dHB1dDsKfQoKc3RyIGFjdGlvbiBzdHJ1dGlsc19yZXBsYWNlX2FsbChzdHIgc3RyaW5nLCBzdHIgdG9fcmVwbGFjZSwgc3RyIHJlcGxhY2Vfd2l0aCl7CiAgICB3aGlsZShVVElMUy5yZXBsYWNlVGV4dChzdHJpbmcsIHRvX3JlcGxhY2UsIHJlcGxhY2Vfd2l0aCkgIT0gc3RyaW5nKXsKICAgICAgICBzdHJpbmcgPSBVVElMUy5yZXBsYWNlVGV4dChzdHJpbmcsIHRvX3JlcGxhY2UsIHJlcGxhY2Vfd2l0aCk7CiAgICB9CiAgICByZXR1cm4gc3RyaW5nOwp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBIZWFkZXI6IGxpYnNcdXRpbHNcbGlzdHNcbGlzdHV0aWwua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgRGVzY3JpcHRpb246IEFkZGl0aW9uYWwgc3RyaW5nIHV0aWxpdGllcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCm51bSBhY3Rpb24gbGlzdHV0aWxfbWlubGlzdChudW1bXSBsaXN0KXsKICAgIGlmIChsZW5ndGhPZiBsaXN0ID4gMil7CiAgICAgICAgbnVtIG1pbiA9IGxpc3RbMF07CiAgICAgICAgZm9yIChudW0gaSA9IDE7IGkgPCBsZW5ndGhPZiBsaXN0OyBpKyspewogICAgICAgICAgICBtaW4gPSAobGlzdFtpXSA8IG1pbikgPyBsaXN0W2ldIDogbWluOwogICAgICAgIH0KCQlyZXR1cm4gbWluOwogICAgfSBlbHNlIGlmIChsZW5ndGhPZiBsaXN0ID09IDEpewogICAgICAgIHJldHVybiBsaXN0WzBdOwogICAgfQogICAgZWxzZSBpZiAobGVuZ3RoT2YgbGlzdCA9PSAyKSB7CiAgICAgICAgcmV0dXJuIE1hdGgubWluKGxpc3RbMF0sbGlzdFsxXSk7CiAgICB9CiAgICByZXR1cm4gMDsKfQoKYm9vbCBhY3Rpb24gbGlzdHV0aWxfaW5zdHJsaXN0KHN0ciBzLCBzdHJbXSBsaXN0KXsKICAgIGZvcihudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBsaXN0OyBpKyspewogICAgICAgIGlmIChzID09IGxpc3RbaV0pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9CiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIGhlYWRlcjogXGxpYnNcc3luY29ianNcc3luY29ianNfaC5rcm5rCiMgQXV0aG9yOiBibGFuZHJpY2UKIyAgIERlc2NyaXB0aW9uOiBub3QgcmVhZHkhCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKCm51bSBzeW5jb2Jqc19oX2VIRUFMVEggPSAweDAxOwpudW0gc3luY29ianNfaF9lUE9TSVRJT04gPSAweDAyOwpudW0gc3luY29ianNfaF9lUk9UQVRJT04gPSAweDA0OwpudW0gc3luY29ianNfaF9lU0NBTEUgPSAweDA4OwpudW0gc3luY29ianNfaF9lVFlQRSA9IDB4MTA7Cm51bSBzeW5jb2Jqc19oX2VURVhUVVJFID0gMHgyMDsKbnVtIHN5bmNvYmpzX2hfZUNPTE9SID0gMHg0MDsKbnVtIHN5bmNvYmpzX2hfZUVNSVNTSVZFID0gMHg4MDsKCgojIEJpbmFyeSBkZWNvZGluZyBvZiBhbiBhcnJheSBvZiBieXRlcyB0byBPYmplY3RzCm9iaiBhY3Rpb24gc3luY29ianNfaF9ieXRlQXJyYXlUb09ianMobnVtW10gYnl0ZUFycmF5KSB7CglvYmpbXSBvYmpsaXN0ID0gb2JqW107CgludW1bXSBkZWxMaXN0ID0gbnVtW107CgludW0gaSA9IDA7ICMgcGMgaW4gYXJyYXkKCW51bSB0b3RhbG9ianMgPSAwOwoJbnVtIHRvdGFsZGVsb2JqcyA9IDA7CglpZiAobGVuZ3RoT2YgYnl0ZUFycmF5ID49MikKCXsKICAgICAgICB0b3RhbG9ianMgPSBieXRlQXJyYXlbMF07CiAgICAgICAgaSsrOwoJCXRvdGFsZGVsb2JqcyA9IGJ5dGVBcnJheVsxXTsKCQlpKys7CiAgICB9IGVsc2UKCXsKICAgICAgICByZXR1cm4ge29iamxpc3Q6b2JqbGlzdCxkZWxMaXN0OmRlbExpc3R9OwogICAgfQoJCglmb3IgKG51bSBqID0gMDsgaiA8IHRvdGFsb2JqczsgaisrKXsKCQlvYmogdG9iaiA9IHt9OwoJCSMgY29udGVudHMgYnl0ZQoJCW51bSBjb250ZW50cyA9IGJ5dGVBcnJheVtpXTsKCQlpKys7CgkJIyBvYmplY3QgaWQgMiBieXRlcwoJCXRvYmoub2JqaWQgPSBkdHlwZXNfbWVyZ2UyQnl0ZXMoYnl0ZUFycmF5W2ldLGJ5dGVBcnJheVtpKzFdKTsKCQlpKz0yOwoJCSMgNCBieXRlcyBoZWFsdGggLyBmdWxsaGVhbHRoCgkJaWYgKChjb250ZW50cyAmIHN5bmNvYmpzX2hfZUhFQUxUSCkgPiAwKSB7CgkJCXRvYmouaGVhbHRoID0gZHR5cGVzX21lcmdlMkJ5dGVzKGJ5dGVBcnJheVtpXSxieXRlQXJyYXlbaSsxXSk7CgkJCXRvYmouZmhlYWx0aCA9IGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaSsyXSxieXRlQXJyYXlbaSszXSk7CgkJCWkrPSA0OwoJCX0KCQkjIDYgYnl0ZXMgcG9zaXRpb24KCQlpZiAoKGNvbnRlbnRzICYgc3luY29ianNfaF9lUE9TSVRJT04pID4gMCl7CgkJCXRvYmoucG9zaXRpb24gPSB7CgkJCQl4IDogZHR5cGVzX0ludDE2VG9OdW0oZHR5cGVzX21lcmdlMkJ5dGVzKGJ5dGVBcnJheVtpXSxieXRlQXJyYXlbaSsxXSkpLAoJCQkJeSA6IGR0eXBlc19JbnQxNlRvTnVtKGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaSsyXSxieXRlQXJyYXlbaSszXSkpLAoJCQkJeiA6IGR0eXBlc19JbnQxNlRvTnVtKGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaSs0XSxieXRlQXJyYXlbaSs1XSkpCgkJCX07CgkJCWkrPSA2OwoJCX0KCQkjIDYgYnl0ZXMgcm90YXRpb24KCQlpZiAoKGNvbnRlbnRzICYgc3luY29ianNfaF9lUk9UQVRJT04pID4gMCkgewoJCQl0b2JqLnJvdGF0aW9uID17CgkJCQl4OiBkdHlwZXNfZmxvYXQxNlRvTnVtKGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaV0sYnl0ZUFycmF5W2krMV0pKSwKCQkJCXk6IGR0eXBlc19mbG9hdDE2VG9OdW0oZHR5cGVzX21lcmdlMkJ5dGVzKGJ5dGVBcnJheVtpKzJdLGJ5dGVBcnJheVtpKzNdKSksCgkJCQl6OiBkdHlwZXNfZmxvYXQxNlRvTnVtKGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaSs0XSxieXRlQXJyYXlbaSs1XSkpCgkJCX07CgkJCWkrPSA2OwoJCX0KCQkjIDYgYnl0ZXMgc2NhbGUKCQlpZiAoKGNvbnRlbnRzICYgc3luY29ianNfaF9lU0NBTEUpID4gMCkgewoJCQl0b2JqLnNjYWxlID0gewoJCQkJeDogZHR5cGVzX0ludDE2VG9OdW0oZHR5cGVzX21lcmdlMkJ5dGVzKGJ5dGVBcnJheVtpXSxieXRlQXJyYXlbaSsxXSkpLAoJCQkJeTogZHR5cGVzX0ludDE2VG9OdW0oZHR5cGVzX21lcmdlMkJ5dGVzKGJ5dGVBcnJheVtpKzJdLGJ5dGVBcnJheVtpKzNdKSksCgkJCQl6OiBkdHlwZXNfSW50MTZUb051bShkdHlwZXNfbWVyZ2UyQnl0ZXMoYnl0ZUFycmF5W2krNF0sYnl0ZUFycmF5W2krNV0pKQoJCQl9OwoJCQlpKz0gNjsKCQl9CgkJIyA3IGJ5dGVzIGRldGFpbHMgKDIgdHlwZSwgMiB0ZXh0dXJlLCAzIGNvbG9yKQoJCWlmICgoY29udGVudHMgJiBzeW5jb2Jqc19oX2VUWVBFKSA+IDApIHsKCQkJIyB0b2JqLnR5cGUgPSBkdHlwZXNfbWVyZ2UyQnl0ZXMoYnl0ZUFycmF5W2ldLGJ5dGVBcnJheVtpKzFdKTsKCQkJIyBpKz0yOwoJCQludW0gbGVuID0gYnl0ZUFycmF5W2ldOwoJCQlpKys7CgkJCW51bVtdIGJ5dGVBID0gbnVtW107CgkJCWZvciAobnVtIGsgPSAwOyBrIDwgbGVuOyBrKyspCgkJCXsKCQkJCWFkZFRvIGJ5dGVBIGJ5dGVBcnJheVtpXTsKCQkJCWkrKzsKCQkJfQoJCQkjIG51bVtdIGJ5dGVBID0gbnVtW107IGFkZFRvIGJ5dGVBIGJ5dGVBcnJheVtpXTsKCQkJdG9iai50eXBlID0gZHR5cGVzX0J5dGVBcnJheVRvU3RyKGJ5dGVBKTsKICAgICAgICAgICAgIyBpKz0xOwoJCQkjIEdBTUUubG9nKCJ0eXBlOiIsdG9iai50eXBlKTsKCQl9CiAgICAgICAgaWYgKChjb250ZW50cyAmIHN5bmNvYmpzX2hfZVRFWFRVUkUpID4gMCkgewoJCQl0b2JqLmFpZCA9IGR0eXBlc19tZXJnZTJCeXRlcyhieXRlQXJyYXlbaV0sYnl0ZUFycmF5W2krMV0pOwogICAgICAgICAgICBpKz0yOwoJCX0KICAgICAgICBpZiAoKGNvbnRlbnRzICYgc3luY29ianNfaF9lQ09MT1IpID4gMCkgewoJCQl0b2JqLmNvbG9yID0gYnl0ZUFycmF5W2ldIHwgKGJ5dGVBcnJheVtpKzFdIDw8IDgpIHwgKGJ5dGVBcnJheVtpKzJdIDw8IDE2KTsKICAgICAgICAgICAgaSs9MzsKCQl9CiAgICAgICAgaWYgKChjb250ZW50cyAmIHN5bmNvYmpzX2hfZUVNSVNTSVZFKSA+IDApIHsKCQkJdG9iai5lbWlzc2l2ZSA9IGJ5dGVBcnJheVtpXSB8IChieXRlQXJyYXlbaSsxXSA8PCA4KSB8IChieXRlQXJyYXlbaSsyXSA8PCAxNik7CiAgICAgICAgICAgIGkrPTM7CgkJfQogICAgICAgIAoJCWFkZFRvIG9iamxpc3QgdG9iajsKCQkjIGorKzsKCX0KCWZvciAobnVtIGogPSAwOyBqIDwgdG90YWxkZWxvYmpzOyBqKyspewoJCSMgR0FNRS5sb2coImkiLGksImoiLGopOwoJCSMgR0FNRS5sb2coYnl0ZUFycmF5KTsKCQkjIEdBTUUubG9nKCJuZXcgZGVsZXRlIG9iamVjdCB3aXRoIGlkIixieXRlQXJyYXlbaStrXSk7CgkJbnVtIG9iamlkID0gZHR5cGVzX21lcmdlMkJ5dGVzKGJ5dGVBcnJheVtpXSxieXRlQXJyYXlbaSsxXSk7CgkJYWRkVG8gZGVsTGlzdCBvYmppZDsKCQlpKz0yOwoJfQoKCglyZXR1cm4ge29iamxpc3Q6b2JqbGlzdCxkZWxMaXN0OmRlbExpc3R9Owp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBMaWJyYXJ5OiBcbGlic1xzeW5jb2Jqc1xzeW5jb2Jqc19zLmtybmsKIyBBdXRob3I6IGJsYW5kcmljZQojICAgRGVzY3JpcHRpb246IG5vdCByZWFkeSEKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpudW0gc3luY29ianNfc19TWU5DX0lOVEVSVkFMID0gNTA7Cm51bSBzeW5jb2Jqc19zX0RFU0lSRURfRlBTID0gNTsKbnVtIHN5bmNvYmpzX3NfTUFYTEVOX05FVERBVEEgPSAxNTAwOwoKIyBvYmplY3QgY29udGVudHMKbnVtW10gYWN0aW9uIHN5bmNvYmpzX3Nfb2Jqc1RvQnl0ZUFycmF5KG9ialtdIHN5bmNvYmpzX3Nfb2JqbGlzdCxib29sIHJlc2V0LCBvYmogcGxyLCBvYmpbXSBwbHJzKSB7CgludW1bXSByZXRBcnJheSA9IG51bVtdOwogICAgbnVtW10gZGVsQXJyYXkgPSBudW1bXTsKICAgIG51bSB0b3RhbG9ianMgPSAwOwogICAgbnVtIHRvdGFsZGVsb2JqcyA9IDA7CgogICAgIyAxIGJ5dGUgbGVuZ3RoIG9mIG9iamVjdHMKICAgIGFkZFRvIHJldEFycmF5IDA7CgogICAgIyAxIGJ5dGUgbGVuZ3RoIG9mIGRlbCBsaXN0CiAgICBhZGRUbyByZXRBcnJheSAwOwoKCWZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2Ygc3luY29ianNfc19vYmpsaXN0OyBpKyspIHsKCQlvYmogdE9iaiA9IHN5bmNvYmpzX3Nfb2JqbGlzdFtpXTsKICAgICAgICBpZiAoKHN0cil0T2JqLmRlbCAhPSAidW5kZWZpbmVkIiAmJiAoYm9vbCl0T2JqLmRlbCA9PSB0cnVlKXsKICAgICAgICAgICAgaWYgKCFsaXN0dXRpbF9pbnN0cmxpc3QoKHN0cilwbHIuaWQsKHN0cltdKXRPYmouZGVscGxyaWRzKSl7CiAgICAgICAgICAgICAgICBhZGRUbyAoc3RyW10pdE9iai5kZWxwbHJpZHMgKHN0cilwbHIuaWQ7CiAgICAgICAgICAgICAgICAjIGFkZFRvIGRlbEFycmF5IHRvTnVtIChzdHIpIHRPYmoub2JqaWQ7CiAgICAgICAgICAgICAgICBudW1bXSB0T2JqSURfYXJyID0gbnVtW107CiAgICAgICAgICAgICAgICB0T2JqSURfYXJyID0gZHR5cGVzX2ludDE2dG9CeXRlQXJyYXkodG9OdW0gKHN0cikgdE9iai5vYmppZCk7CiAgICAgICAgICAgICAgICAjIGFkZFRvIGRlbEFycmF5IHRvTnVtIChzdHIpIHRPYmoub2JqaWQ7CiAgICAgICAgICAgICAgICBhZGRUbyBkZWxBcnJheSB0T2JqSURfYXJyWzBdOyBhZGRUbyBkZWxBcnJheSB0T2JqSURfYXJyWzFdOwogICAgICAgICAgICAgICAgdG90YWxkZWxvYmpzKys7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgdG90YWxvYmpzKys7CiAgICAgICAgfQoKCQludW1bXSB0QXJyYXkgPSBudW1bXTsKCgkJIyAxIGJ5dGUgKDhiaXRzKSBvYmplY3QgY29udGVudHMKCQludW0gY29udGVudHMgPSAweDAwOwoJCW51bSBjb250ZW50c2lkeCA9IGxlbmd0aE9mIHJldEFycmF5OwoJCWFkZFRvIHJldEFycmF5IGNvbnRlbnRzOwoJCSMgaWYgKChudW0pIHRPYmouaGl0PjApIHtjb250ZW50cyB8PSAgMHg4MDt9CgkJCgkJIyAyIGJ5dGVzIHN5bmNvYmpzX3Nfb2JqaWQKCQl0QXJyYXkgPSBkdHlwZXNfaW50MTZ0b0J5dGVBcnJheShkdHlwZXNfbnVtVG9VaW50MTYoKG51bSl0T2JqLm9iamlkKSk7IGFkZFRvIHJldEFycmF5IHRBcnJheVswXTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzFdOwoKCQkjIDQgYnl0ZXMgaGVhbHRoL2ZoZWFsdGgKCQlpZiAobm90RW1wdHkgKG9iaikgdE9iai5oZWFsdGgpIHsKICAgICAgICAgICAgICAgIGJvb2wgaGVhbHRoY2hhbmdlZCA9ICgobnVtKSB0T2JqLmhlYWx0aC5oICE9IChudW0pIHRPYmouaGVhbHRoX29sZC5oKSB8fCAoKG51bSkgdE9iai5oZWFsdGguZmggIT0gKG51bSkgdE9iai5oZWFsdGhfb2xkLmZoKTsKICAgICAgICAgICAgICAgIGlmIChoZWFsdGhjaGFuZ2VkKXsKICAgICAgICAgICAgICAgICAgICB0T2JqLmhlYWx0aF9vbGQgPSBzdHJbXTsKICAgICAgICAgICAgICAgICAgICB0T2JqLmhlYWx0aF9vbGQgPSB7eDp0T2JqLmhlYWx0aC5oLHk6dE9iai5oZWFsdGguZmh9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGhlYWx0aGNoYW5nZWQgfHwgKCghbGlzdHV0aWxfaW5zdHJsaXN0KChzdHIpcGxyLmlkLChzdHJbXSl0T2JqLmhlYWx0aF9vbGRfcGxycykpKSB8fCByZXNldCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRlbnRzIHw9ICBzeW5jb2Jqc19oX2VIRUFMVEg7CiAgICAgICAgICAgICAgICAgICAgdEFycmF5ID0gZHR5cGVzX2ludDE2dG9CeXRlQXJyYXkoZHR5cGVzX251bVRvVWludDE2KChudW0pdE9iai5oZWFsdGguaCkpOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMF07IGFkZFRvIHJldEFycmF5IHRBcnJheVsxXTsKICAgICAgICAgICAgICAgICAgICB0QXJyYXkgPSBkdHlwZXNfaW50MTZ0b0J5dGVBcnJheShkdHlwZXNfbnVtVG9VaW50MTYoKG51bSl0T2JqLmhlYWx0aC5maCkpOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMF07IGFkZFRvIHJldEFycmF5IHRBcnJheVsxXTsKICAgICAgICAgICAgICAgICAgICBhZGRUbyAgKHN0cltdKSB0T2JqLmhlYWx0aF9vbGRfcGxycyAoc3RyKXBsci5pZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoJCSMgNiBieXRlcyBwb3NpdGlvbgoJCSMgaWYgKG5vdEVtcHR5IChvYmopIHRPYmoucG9zaXRpb24pIHt9CiAgICAgICAgaWYgKG5vdEVtcHR5IChvYmopIHRPYmoucG9zaXRpb24pIHsKICAgICAgICAgICAgYm9vbCBwb3NjaGFuZ2VkID0gKChudW0pIHRPYmoucG9zaXRpb24ueCAhPSAobnVtKSB0T2JqLnBvc19vbGQueCkgfHwgKChudW0pIHRPYmoucG9zaXRpb24ueSAhPSAobnVtKSB0T2JqLnBvc19vbGQueSkgIHx8ICgobnVtKSB0T2JqLnBvc2l0aW9uLnogIT0gKG51bSkgdE9iai5wb3Nfb2xkLnopOwogICAgICAgICAgICBpZiAocG9zY2hhbmdlZCl7CiAgICAgICAgICAgICAgICB0T2JqLnBvc19vbGRfcGxycyA9IHN0cltdOwogICAgICAgICAgICAgICAgdE9iai5wb3Nfb2xkID0ge3g6dE9iai5wb3NpdGlvbi54LHk6dE9iai5wb3NpdGlvbi55LHo6dE9iai5wb3NpdGlvbi56fTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocG9zY2hhbmdlZCB8fCAoKCFsaXN0dXRpbF9pbnN0cmxpc3QoKHN0cilwbHIuaWQsKHN0cltdKXRPYmoucG9zX29sZF9wbHJzKSkpIHx8IHJlc2V0KXsKICAgICAgICAgICAgICAgIGNvbnRlbnRzIHw9ICBzeW5jb2Jqc19oX2VQT1NJVElPTjsKICAgICAgICAgICAgICAgIHRBcnJheSA9IGR0eXBlc19pbnQxNnRvQnl0ZUFycmF5KGR0eXBlc19udW1Ub0ludDE2KChudW0pdE9iai5wb3NpdGlvbi54KSk7IGFkZFRvIHJldEFycmF5IHRBcnJheVswXTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzFdOwogICAgICAgICAgICAgICAgdEFycmF5ID0gZHR5cGVzX2ludDE2dG9CeXRlQXJyYXkoZHR5cGVzX251bVRvSW50MTYoKG51bSl0T2JqLnBvc2l0aW9uLnkpKTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzBdOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMV07CiAgICAgICAgICAgICAgICB0QXJyYXkgPSBkdHlwZXNfaW50MTZ0b0J5dGVBcnJheShkdHlwZXNfbnVtVG9JbnQxNigobnVtKXRPYmoucG9zaXRpb24ueikpOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMF07IGFkZFRvIHJldEFycmF5IHRBcnJheVsxXTsKICAgICAgICAgICAgICAgIGFkZFRvICAoc3RyW10pIHRPYmoucG9zX29sZF9wbHJzIChzdHIpcGxyLmlkOwogICAgICAgICAgICB9CgkJfQoJCSMgNiBieXRlcyByb3RhdGlvbgoJCWlmIChub3RFbXB0eSAob2JqKSB0T2JqLnJvdGF0aW9uKSB7CiAgICAgICAgICAgIGJvb2wgcm90Y2hhbmdlZCA9ICgobnVtKSB0T2JqLnJvdGF0aW9uLnggIT0gKG51bSkgdE9iai5yb3Rfb2xkLngpIHx8ICgobnVtKSB0T2JqLnJvdGF0aW9uLnkgIT0gKG51bSkgdE9iai5yb3Rfb2xkLnkpICB8fCAoKG51bSkgdE9iai5yb3RhdGlvbi56ICE9IChudW0pIHRPYmoucm90X29sZC56KTsKICAgICAgICAgICAgaWYgKHJvdGNoYW5nZWQpewogICAgICAgICAgICAgICAgdE9iai5yb3Rfb2xkX3BscnMgPSBzdHJbXTsKICAgICAgICAgICAgICAgIHRPYmoucm90X29sZCA9IHt4OnRPYmoucm90YXRpb24ueCx5OnRPYmoucm90YXRpb24ueSx6OnRPYmoucm90YXRpb24uen07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJvdGNoYW5nZWQgfHwgKCghbGlzdHV0aWxfaW5zdHJsaXN0KChzdHIpcGxyLmlkLChzdHJbXSl0T2JqLnJvdF9vbGRfcGxycykpKSB8fCByZXNldCl7CiAgICAgICAgICAgICAgICBjb250ZW50cyB8PSAgc3luY29ianNfaF9lUk9UQVRJT047CiAgICAgICAgICAgICAgICB0QXJyYXkgPSBkdHlwZXNfaW50MTZ0b0J5dGVBcnJheShkdHlwZXNfbnVtVG9GbG9hdDE2KChudW0pdE9iai5yb3RhdGlvbi54KSk7IGFkZFRvIHJldEFycmF5IHRBcnJheVswXTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzFdOwogICAgICAgICAgICAgICAgIyBHQU1FLmxvZygieDogIixkdHlwZXNfbnVtVG9GbG9hdDE2KChudW0pdE9iai5yb3RhdGlvbi54KSwgcHJpbnRCaW5hcnkoZHR5cGVzX251bVRvRmxvYXQxNigobnVtKXRPYmoucm90YXRpb24ueCkpKTsKICAgICAgICAgICAgICAgIHRBcnJheSA9IGR0eXBlc19pbnQxNnRvQnl0ZUFycmF5KGR0eXBlc19udW1Ub0Zsb2F0MTYoKG51bSl0T2JqLnJvdGF0aW9uLnkpKTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzBdOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMV07CiAgICAgICAgICAgICAgICB0QXJyYXkgPSBkdHlwZXNfaW50MTZ0b0J5dGVBcnJheShkdHlwZXNfbnVtVG9GbG9hdDE2KChudW0pdE9iai5yb3RhdGlvbi56KSk7IGFkZFRvIHJldEFycmF5IHRBcnJheVswXTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzFdOwogICAgICAgICAgICAgICAgYWRkVG8gIChzdHJbXSkgdE9iai5yb3Rfb2xkX3BscnMgKHN0cilwbHIuaWQ7CiAgICAgICAgICAgIH0KCQl9CgkJIyA2IGJ5dGVzIHNjYWxlCgkJaWYgKG5vdEVtcHR5IChvYmopIHRPYmouc2NhbGUpIHsKICAgICAgICAgICAgYm9vbCBzY2FsZWNoYW5nZWQgPSAoKG51bSkgdE9iai5zY2FsZS54ICE9IChudW0pIHRPYmouc2NhbGVfb2xkLngpIHx8ICgobnVtKSB0T2JqLnNjYWxlLnkgIT0gKG51bSkgdE9iai5zY2FsZV9vbGQueSkgIHx8ICgobnVtKSB0T2JqLnNjYWxlLnogIT0gKG51bSkgdE9iai5zY2FsZV9vbGQueik7CiAgICAgICAgICAgIGlmIChzY2FsZWNoYW5nZWQpewogICAgICAgICAgICAgICAgdE9iai5zY2FsZV9vbGRfcGxycyA9IHN0cltdOwogICAgICAgICAgICAgICAgdE9iai5zY2FsZV9vbGQgPSB7eDp0T2JqLnNjYWxlLngseTp0T2JqLnNjYWxlLnksejp0T2JqLnNjYWxlLnp9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzY2FsZWNoYW5nZWQgfHwgKCghbGlzdHV0aWxfaW5zdHJsaXN0KChzdHIpcGxyLmlkLChzdHJbXSl0T2JqLnNjYWxlX29sZF9wbHJzKSkpIHx8IHJlc2V0KXsKICAgICAgICAgICAgICAgIGNvbnRlbnRzIHw9ICBzeW5jb2Jqc19oX2VTQ0FMRTsKICAgICAgICAgICAgICAgIHRBcnJheSA9IGR0eXBlc19pbnQxNnRvQnl0ZUFycmF5KGR0eXBlc19udW1Ub0ludDE2KChudW0pdE9iai5zY2FsZS54KSk7IGFkZFRvIHJldEFycmF5IHRBcnJheVswXTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzFdOwogICAgICAgICAgICAgICAgdEFycmF5ID0gZHR5cGVzX2ludDE2dG9CeXRlQXJyYXkoZHR5cGVzX251bVRvSW50MTYoKG51bSl0T2JqLnNjYWxlLnkpKTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzBdOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMV07CiAgICAgICAgICAgICAgICB0QXJyYXkgPSBkdHlwZXNfaW50MTZ0b0J5dGVBcnJheShkdHlwZXNfbnVtVG9JbnQxNigobnVtKXRPYmouc2NhbGUueikpOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMF07IGFkZFRvIHJldEFycmF5IHRBcnJheVsxXTsKICAgICAgICAgICAgICAgIGFkZFRvICAoc3RyW10pIHRPYmouc2NhbGVfb2xkX3BscnMgKHN0cilwbHIuaWQ7CiAgICAgICAgICAgIH0KCQl9CiAgICAgICAgIyA3IGJ5dGVzIGRldGFpbHMgKDIgdHlwZSwgMiB0ZXh0dXJlLCAzIGNvbG9yKQogICAgICAgICMgdHlwZSAoY3ViZSwgc3BoZXJlLCBzcHJpdGUsIG1vZGVsSUQpCiAgICAgICAgaWYgKChzdHIpdE9iai50eXBlICE9ICJ1bmRlZmluZWQiKQogICAgICAgIHsgICAKICAgICAgICAgICAgYm9vbCB0eXBlY2hhbmdlZCA9ICgobnVtKSB0T2JqLnR5cGUgIT0gKG51bSkgdE9iai50eXBlX29sZCk7CiAgICAgICAgICAgIGlmICh0eXBlY2hhbmdlZCl7CiAgICAgICAgICAgICAgICB0T2JqLnR5cGVfb2xkX3BscnMgPSBzdHJbXTsKICAgICAgICAgICAgICAgIHRPYmoudHlwZV9vbGQgPSAobnVtKXRPYmoudHlwZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZWNoYW5nZWQgfHwgKCghbGlzdHV0aWxfaW5zdHJsaXN0KChzdHIpcGxyLmlkLChzdHJbXSl0T2JqLnR5cGVfb2xkX3BscnMpKSkgfHwgcmVzZXQpewogICAgICAgICAgICAgICAgY29udGVudHMgfD0gIHN5bmNvYmpzX2hfZVRZUEU7CiAgICAgICAgICAgICAgICAjIHRBcnJheSA9IGR0eXBlc19pbnQxNnRvQnl0ZUFycmF5KChudW0pdE9iai50eXBlKTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzBdOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMV07ICAgIAogICAgICAgICAgICAgICAgIyBudW0gbGVuID0gbGVuZ3RoT2YgKHN0cil0T2JqLnR5cGU7CiAgICAgICAgICAgICAgICAjIGFkZFRvIHJldEFycmF5IGxlbjsKICAgICAgICAgICAgICAgIHRBcnJheSA9IGR0eXBlc19zdHJ0b0J5dGVBcnJheSgoc3RyKXRPYmoudHlwZSk7CiAgICAgICAgICAgICAgICBudW0gbGVuID0gbGVuZ3RoT2YgdEFycmF5OwogICAgICAgICAgICAgICAgYWRkVG8gcmV0QXJyYXkgbGVuOwogICAgICAgICAgICAgICAgZm9yIChudW0gaiA9IDA7IGogPCBsZW47IGorKykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBhZGRUbyByZXRBcnJheSB0QXJyYXlbal07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAjIHRBcnJheSA9IGR0eXBlc19zdHJ0b0J5dGVBcnJheSgoc3RyKXRPYmoudHlwZSk7IGFkZFRvIHJldEFycmF5IHRBcnJheVswXTsKICAgICAgICAgICAgICAgIGFkZFRvICAoc3RyW10pIHRPYmoudHlwZV9vbGRfcGxycyAoc3RyKXBsci5pZDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjIGFpZCAodGV4dHVyZSkgQ0FOTk9UIEJFIFVQREFURUQgWUVUIElOIEtTCiAgICAgICAgaWYgKChzdHIpdE9iai5haWQhPSJ1bmRlZmluZWQiKXsKICAgICAgICAgICAgYm9vbCBhaWRfY2hhbmdlZCA9ICgobnVtKSB0T2JqLmFpZCAhPSAobnVtKSB0T2JqLmFpZF9vbGQpOwogICAgICAgICAgICBpZiAoYWlkX2NoYW5nZWQpewogICAgICAgICAgICAgICAgdE9iai5haWRfb2xkX3BscnMgPSBzdHJbXTsKICAgICAgICAgICAgICAgIHRPYmouYWlkX29sZCA9IChudW0pdE9iai5haWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFpZF9jaGFuZ2VkIHx8ICgoIWxpc3R1dGlsX2luc3RybGlzdCgoc3RyKXBsci5pZCwoc3RyW10pdE9iai5haWRfb2xkX3BscnMpKSkgfHwgcmVzZXQpewogICAgICAgICAgICAgICAgY29udGVudHMgfD0gIHN5bmNvYmpzX2hfZVRFWFRVUkU7CiAgICAgICAgICAgICAgICB0QXJyYXkgPSBkdHlwZXNfaW50MTZ0b0J5dGVBcnJheSgobnVtKXRPYmouYWlkKTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzBdOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMV07ICAgIAogICAgICAgICAgICAgICAgYWRkVG8gIChzdHJbXSkgdE9iai5haWRfb2xkX3BscnMgKHN0cilwbHIuaWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICMgY29sb3IKCQlpZiAoKHN0cikgdE9iai5jb2xvciAhPSJ1bmRlZmluZWQiKXsKICAgICAgICAgICAgYm9vbCBjb2xvcl9jaGFuZ2VkID0gKChudW0pIHRPYmouY29sb3IgIT0gKG51bSkgdE9iai5jb2xvcl9vbGQpOwogICAgICAgICAgICBpZiAoY29sb3JfY2hhbmdlZCl7CiAgICAgICAgICAgICAgICB0T2JqLmNvbG9yX29sZF9wbHJzID0gc3RyW107CiAgICAgICAgICAgICAgICB0T2JqLmNvbG9yX29sZCA9IChudW0pdE9iai5jb2xvcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29sb3JfY2hhbmdlZCB8fCAoKCFsaXN0dXRpbF9pbnN0cmxpc3QoKHN0cilwbHIuaWQsKHN0cltdKXRPYmouY29sb3Jfb2xkX3BscnMpKSkgfHwgcmVzZXQpewogICAgICAgICAgICAgICAgY29udGVudHMgfD0gIHN5bmNvYmpzX2hfZUNPTE9SOwogICAgICAgICAgICAgICAgdEFycmF5ID0gZHR5cGVzX0NvbG9yVG9CeXRlQXJyYXkoKG51bSl0T2JqLmNvbG9yKTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzBdOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMV07IGFkZFRvIHJldEFycmF5IHRBcnJheVsyXTsKICAgICAgICAgICAgICAgIGFkZFRvICAoc3RyW10pIHRPYmouY29sb3Jfb2xkX3BscnMgKHN0cilwbHIuaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgIyBlbWlzc2l2ZQoJCWlmICgoc3RyKSB0T2JqLmVtaXNzaXZlICE9InVuZGVmaW5lZCIpewogICAgICAgICAgICBib29sIGVtaXNzaXZlX2NoYW5nZWQgPSAoKG51bSkgdE9iai5lbWlzc2l2ZSAhPSAobnVtKSB0T2JqLmVtaXNzaXZlX29sZCk7CiAgICAgICAgICAgIGlmIChlbWlzc2l2ZV9jaGFuZ2VkKXsKICAgICAgICAgICAgICAgIHN0ciBjb2xyID0gIiMiICsgZHR5cGVzX251bTJoZXhzdHJpbmcoKG51bSkgdE9iai5lbWlzc2l2ZSk7CiAgICAgICAgICAgICAgICB0T2JqLmVtaXNzaXZlX29sZF9wbHJzID0gc3RyW107CiAgICAgICAgICAgICAgICB0T2JqLmVtaXNzaXZlX29sZCA9IChudW0pdE9iai5lbWlzc2l2ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW1pc3NpdmVfY2hhbmdlZCB8fCAoKCFsaXN0dXRpbF9pbnN0cmxpc3QoKHN0cilwbHIuaWQsKHN0cltdKXRPYmouZW1pc3NpdmVfb2xkX3BscnMpKSkgfHwgcmVzZXQpewogICAgICAgICAgICAgICAgY29udGVudHMgfD0gIHN5bmNvYmpzX2hfZUVNSVNTSVZFOwogICAgICAgICAgICAgICAgdEFycmF5ID0gZHR5cGVzX0NvbG9yVG9CeXRlQXJyYXkoKG51bSl0T2JqLmVtaXNzaXZlKTsgYWRkVG8gcmV0QXJyYXkgdEFycmF5WzBdOyBhZGRUbyByZXRBcnJheSB0QXJyYXlbMV07IGFkZFRvIHJldEFycmF5IHRBcnJheVsyXTsKICAgICAgICAgICAgICAgIGFkZFRvICAoc3RyW10pIHRPYmouZW1pc3NpdmVfb2xkX3BscnMgKHN0cilwbHIuaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgkJcmV0QXJyYXlbY29udGVudHNpZHhdID0gY29udGVudHM7Cgl9CgogICAgZm9yIChudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBkZWxBcnJheTsgaSsrKXsKICAgICAgICBhZGRUbyByZXRBcnJheSBkZWxBcnJheVtpXTsKICAgIH0KICAgIHJldEFycmF5WzBdID0gdG90YWxvYmpzOwogICAgcmV0QXJyYXlbMV0gPSB0b3RhbGRlbG9ianM7CglyZXR1cm4gcmV0QXJyYXk7Cn0KCm51bSBzeW5jb2Jqc19zX3RsYXN0YnJvYWRjYXN0ID0gMDsKb2JqW10gc3luY29ianNfc19vYmpsaXN0ID0gb2JqW107Cm51bVtdIHN5bmNvYmpzX3NfbmV3ZGVsbGlzdCA9IG51bVtdOwpudW0gc3luY29ianNfc19vYmppZCA9IDA7CmJvb2wgc3luY29ianNfc19vYmppZG92ZXJmbG93ID0gZmFsc2U7Cm51bSBzeW5jb2Jqc19zX3Rub3cgPSAwOwpudW0gc3luY29ianNfc19CWVRFT1ZFUkZMT1dfTEVOID0gNjU1MzU7CiMgbnVtIHN5bmNvYmpzX3NfQllURU9WRVJGTE9XX0xFTiA9IDI1NjsKCiMgV0FSTklORzogcGFzcyBpbiBhIGZyZXNoIG9iamVjdCBvbmx5IC0gbm90IGEgcmVmZXJlbmNlISBvdGhlcndpc2UgeW91IHJpc2sgbW9kaWZ5aW5nIHRoZSByZWZlcmVuY2UKIyBmb3IgZXhhbXBsZSBkb24ndCBwYXNzIGluIGEgdGVtcGxhdGUgb2JqZWN0IGZvciBzeW5jb2Jqc19zX2NyZWF0ZU9iamVjdCh0ZW1wbGF0ZUJhbGwpLgoKb2JqIGFjdGlvbiBzeW5jb2Jqc19zX2ZpbmRPYmpieUlEKHN0ciBpZCl7CiAgICBmb3IgKG51bSBpID0gbGVuZ3RoT2Ygc3luY29ianNfc19vYmpsaXN0IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICBpZiAoKHN0cikgc3luY29ianNfc19vYmpsaXN0W2ldLm9iamlkID09IGlkKSB7CiAgICAgICAgICAgIHJldHVybiBzeW5jb2Jqc19zX29iamxpc3RbaV07CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHt9Owp9CgpvYmogYWN0aW9uIHN5bmNvYmpzX3NfY3JlYXRlT2JqZWN0KG9iaiBkKSB7CiAgICBpZiAobGVuZ3RoT2Ygc3luY29ianNfc19vYmpsaXN0ID49IHN5bmNvYmpzX3NfQllURU9WRVJGTE9XX0xFTikKICAgIHsKICAgICAgICBHQU1FLmxvZygiRVJST1I6IEVYQ0VFREVEIE1BWElNVU0gT0JKRUNUUyBJTiBPQkpMSVNUICIsc3luY29ianNfc19CWVRFT1ZFUkZMT1dfTEVOKTsKICAgICAgICByZXR1cm4ge307CiAgICB9IGVsc2UgaWYgKHN5bmNvYmpzX3Nfb2JqaWRvdmVyZmxvdykKICAgIHsKICAgICAgICBvYmogdG9iaiA9IHN5bmNvYmpzX3NfZmluZE9iamJ5SUQodG9TdHIgc3luY29ianNfc19vYmppZCk7CiAgICAgICAgd2hpbGUobm90RW1wdHkgdG9iaikKICAgICAgICB7CiAgICAgICAgICAgIHN5bmNvYmpzX3Nfb2JqaWQrKzsKICAgICAgICAgICAgaWYgKHN5bmNvYmpzX3Nfb2JqaWQ+PXN5bmNvYmpzX3NfQllURU9WRVJGTE9XX0xFTikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3luY29ianNfc19vYmppZD0wOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgfQogICAgIyBvYmplY3QgdGVtcGxhdGUhCiAgICBvYmogdG9iaiA9IHsKICAgICAgICB0eXBlOiAiMCIsICMwID0gY3ViZSwgMSA9IHNwaGVyZSwgMiA9IGN5bGluZGVyLCBhbGwgZWxzZSA9IG1vZGVsSUQKICAgICAgICBhaWQ6IDM0Mzc5LAogICAgICAgIHNjYWxlOiB7eDoyMCx5OjgwLHo6MjB9LCAjIG1vZGVscyBvbmx5IG5lZWQgeDpzY2FsZSB3aGljaCBpcyBhbGwgMyBkaW1lbnNpb25zCiAgICAgICAgcG9zaXRpb246IHt4OjEseToxLHo6MX0sCiAgICAgICAgdmVsb2NpdHk6IHt4OjAseTowLHo6MH0sCiAgICAgICAgcm90YXRpb246IHt4OjAseTowLHo6MH0sCiAgICAgICAgY29sb3I6IDB4MDBBOEY5LAogICAgICAgIGVtaXNzaXZlOjB4MDAwMDAwLAogICAgICAgIGNvbGxpZGU6IHt0eXBlOjEscmVzb2x2ZToiIn0KICAgICAgICAjIHR5cGU6MSA9IENPTF9XT1JMRCAKICAgIH07CiAgICBpZiAoKHN0cikgZC50eXBlID09ICJ1bmRlZmluZWQiKSB7ZC50eXBlID0gdG9iai50eXBlO30KICAgIGQudHlwZV9vbGQgPSAoc3RyKWQudHlwZSArICJhIjsKICAgIGQudHlwZV9vbGRfcGxycyA9IHN0cltdOwogICAgaWYgKChzdHIpIGQuYWlkID09ICJ1bmRlZmluZWQiKSB7ZC5haWQgPSB0b2JqLmFpZDt9CiAgICBkLmFpZF9vbGRfcGxycyA9IHN0cltdOwogICAgZC5haWRfb2xkID0gKG51bSlkLmFpZCArIDE7CiAgICBpZiAoIW5vdEVtcHR5IChvYmopIGQuc2NhbGUpIHtkLnNjYWxlID0gdG9iai5zY2FsZTt9CiAgICBkLnNjYWxlX29sZF9wbHJzID0gc3RyW107CiAgICBkLnNjYWxlX29sZCA9IHt4OjAseTowLHo6KG51bSlkLnNjYWxlLnorMX07CiAgICBpZiAoIW5vdEVtcHR5IChvYmopIGQucG9zaXRpb24pIHtkLnBvc2l0aW9uID0gdG9iai5wb3NpdGlvbjt9CiAgICBkLnBvc19vbGRfcGxycyA9IHN0cltdOwogICAgZC5wb3Nfb2xkID0ge3g6MCx5OjAsejoobnVtKWQucG9zaXRpb24ueisxfTsKICAgIGlmICghbm90RW1wdHkgKG9iaikgZC52ZWxvY2l0eSkge2QudmVsb2NpdHkgPSB0b2JqLnZlbG9jaXR5O30KICAgIGQudmVsX29sZF9wbHJzID0gc3RyW107CiAgICBkLnZlbF9vbGQgPSB7eDowLHk6MCx6OihudW0pZC52ZWxvY2l0eS56KzF9OwogICAgaWYgKCFub3RFbXB0eSAob2JqKSBkLnJvdGF0aW9uKSB7ZC5yb3RhdGlvbiA9IHRvYmoucm90YXRpb247fQogICAgZC5yb3Rfb2xkX3BscnMgPSBzdHJbXTsKICAgIGQucm90X29sZCA9IHt4OjAseTowLHo6KG51bSlkLnJvdGF0aW9uLnorMX07CiAgICAjaWYgaGVhbHRoIGlzIHRoZXJlLCBhZGQgb2xkIGRhdGEgY29udGFpbmVyCiAgICBpZiAobm90RW1wdHkgKG9iailkLmhlYWx0aCl7CiAgICAgICAgZC5oZWFsdGhfb2xkID0ge2g6MCxmaDoobnVtKWQuaGVhbHRoLmZoLTF9OwogICAgfQogICAgaWYgKChzdHIpIGQuY29sb3IgPT0gInVuZGVmaW5lZCIpIHtkLmNvbG9yID0gdG9iai5jb2xvcjt9CiAgICBkLmNvbG9yX29sZF9wbHJzID0gc3RyW107CiAgICBkLmNvbG9yX29sZCA9IChudW0pZC5jb2xvcisxOwoKICAgIGlmICgoc3RyKSBkLmVtaXNzaXZlID09ICJ1bmRlZmluZWQiKSB7ZC5lbWlzc2l2ZSA9IHRvYmouZW1pc3NpdmU7fQogICAgZC5lbWlzc2l2ZV9vbGRfcGxycyA9IHN0cltdOwogICAgZC5lbWlzc2l2ZV9vbGQgPSAobnVtKWQuZW1pc3NpdmUrMTsKCiAgICBpZiAoIW5vdEVtcHR5IChvYmopZC5jb2xsaWRlKSB7CiAgICAgICAgZC5jb2xsaWRlID0ge3R5cGU6dG9iai5jb2xsaWRlLnR5cGUscmVzb2x2ZToiIn07CiAgICB9CgogICAgZC5vYmppZCA9IHRvTnVtIHRvU3RyIHN5bmNvYmpzX3Nfb2JqaWQ7ICAgIAogICAgaWYgKHN5bmNvYmpzX3Nfb2JqaWQ+PXN5bmNvYmpzX3NfQllURU9WRVJGTE9XX0xFTikKICAgIHsKICAgICAgICBzeW5jb2Jqc19zX29iamlkPTA7CiAgICAgICAgc3luY29ianNfc19vYmppZG92ZXJmbG93PXRydWU7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgc3luY29ianNfc19vYmppZCsrOwogICAgfQogICAgYWRkVG8gc3luY29ianNfc19vYmpsaXN0IGQ7CiAgICByZXR1cm4gZDsKfQoKYm9vbCBhY3Rpb24gc3luY29ianNfc19kZWxldGVPYmplY3Qoc3RyIGlkKSB7CiAgICBmb3IgKG51bSBpID0gbGVuZ3RoT2Ygc3luY29ianNfc19vYmpsaXN0IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICBpZiAoKHN0cikgc3luY29ianNfc19vYmpsaXN0W2ldLm9iamlkID09IGlkKSB7CiAgICAgICAgICAgIGlmICgoc3RyKXN5bmNvYmpzX3Nfb2JqbGlzdFtpXS5kZWwgPT0gInVuZGVmaW5lZCIgfHwgKGJvb2wpc3luY29ianNfc19vYmpsaXN0W2ldLmRlbCA9PSBmYWxzZSl7CiAgICAgICAgICAgICAgICAjIGFkZFRvIHN5bmNvYmpzX3NfbmV3ZGVsbGlzdCB0b051bSBzeW5jb2Jqc19zX29iamxpc3RbaV0ub2JqaWQ7CiAgICAgICAgICAgICAgICAjIHJlbW92ZSBzeW5jb2Jqc19zX29iamxpc3RbaV07CiAgICAgICAgICAgICAgICBzeW5jb2Jqc19zX29iamxpc3RbaV0uZGVsPXRydWU7CiAgICAgICAgICAgICAgICBzeW5jb2Jqc19zX29iamxpc3RbaV0uZGVscGxyaWRzPXN0cltdOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmFjdGlvbiBzeW5jb2Jqc19zX2RlbGV0ZUFsbE9ianMoKXsKICAgIGZvciAobnVtIGkgPSBsZW5ndGhPZiBzeW5jb2Jqc19zX29iamxpc3QgLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICMgYWRkVG8gc3luY29ianNfc19uZXdkZWxsaXN0IHRvTnVtIHN5bmNvYmpzX3Nfb2JqbGlzdFtpXS5vYmppZDsKICAgICAgICAjIHJlbW92ZSBzeW5jb2Jqc19zX29iamxpc3RbaV07CiAgICAgICAgc3luY29ianNfc19vYmpsaXN0W2ldLmRlbD10cnVlOwogICAgICAgIHN5bmNvYmpzX3Nfb2JqbGlzdFtpXS5kZWxwbHJpZHM9c3RyW107CiAgICAgICAgCiAgICB9Cn0KCnN0cltdIGFjdGlvbiBzeW5jb2Jqc19zX2xpc3RPYmpJRHMoKXsKICAgIHN0cltdIGxpc3QgPSBzdHJbXTsKICAgIGZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2Ygc3luY29ianNfc19vYmpsaXN0OyBpKyspewogICAgICAgIGFkZFRvIGxpc3QgKHN0cikgc3luY29ianNfc19vYmpsaXN0W2ldLm9iamlkOwogICAgfQogICAgcmV0dXJuIGxpc3Q7Cn0KCmFjdGlvbiBzeW5jb2Jqc19zX3N0YXJ0KCkgewogICAgc3luY29ianNfc19vYmpsaXN0ID0gb2JqW107CiAgICBzeW5jb2Jqc19zX29iamlkPTA7Cn0KCmFjdGlvbiBzeW5jb2Jqc19zX3VwZGF0ZShudW0gZGVsdGEpIHsKCXN5bmNvYmpzX3NfdG5vdyA9IGdfdG5vdzsKCiAgICAjIEJyb2FkY2FzdCBTeW5jZWQgT2JqZWN0cyBkYXRhCiAgICBpZiAoKHN5bmNvYmpzX3NfdG5vdyAtIHN5bmNvYmpzX3NfdGxhc3Ricm9hZGNhc3QpID4gc3luY29ianNfc19TWU5DX0lOVEVSVkFMKSB7CiAgICAgICAgc3luY29ianNfc190bGFzdGJyb2FkY2FzdCA9IHN5bmNvYmpzX3NfdG5vdzsKICAgICAgICAjIHN0ciBlbmNvZGVkb2JqZGF0YSA9IG9iamVuY29kaW5nKCk7CiAgICAgICAgIyBzdHIgZW5jb2RlZG9iamRhdGEgPSBiOTFfZW5jb2RlKHN5bmNvYmpzX3Nfb2Jqc1RvQnl0ZUFycmF5KHN5bmNvYmpzX3Nfb2JqbGlzdCxmYWxzZSkpOyAjIHNlbmQgbmV3IGRhdGEgb25seQogICAgICAgICMgYm9vbCBzdWNjZXNzID0gR0FNRS5ORVRXT1JLLmJyb2FkY2FzdCgic3luYyIsIHtkYXRhOm9iamRhdGF9KTsKICAgICAgICBvYmpbXSBwbHJzID0gR0FNRS5QTEFZRVJTLmxpc3QoKTsKICAgICAgICBib29sIHN1Y2Nlc3M9dHJ1ZTsKICAgICAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIHBscnM7IGkrKykgewoKICAgICAgICAgICAgb2JqIHBsciA9IHBscnNbaV07CiAgICAgICAgICAgIHN0ciBkYXRhdG9zZW5kID0gIiI7CiAgICAgICAgICAgIGJvb2wgcmVzZXQgPSBmYWxzZTsKICAgICAgICAgICAgIyBndWFyZCBmb3IgaW5pdGlhbGl6aW5nIG5ldGRhdGEKICAgICAgICAgICAgaWYgKChzdHIpIHBsci5uZXRkYXRhID09ICJ1bmRlZmluZWQiIHx8IChib29sKSBwbHIubmV0cmVzZXQgPT0gdHJ1ZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVzZXQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoc3RyKXBsci5uZXRkYXRhID09ICIiIHx8IChzdHIpIHBsci5uZXRkYXRhID09ICJ1bmRlZmluZWQiIHx8IChib29sKSBwbHIubmV0cmVzZXQgPT0gdHJ1ZSl7CiAgICAgICAgICAgICAgICBwbHIubmV0ZGF0YSA9IGI5MV9lbmNvZGUoc3luY29ianNfc19vYmpzVG9CeXRlQXJyYXkoc3luY29ianNfc19vYmpsaXN0LHJlc2V0LHBscixwbHJzKSk7ICMgcmVzZW5kIGFsbCBkYXRhIHJlZ2FyZGxlc3Mgb2YgYWdlCiAgICAgICAgICAgICAgICBwbHIubmV0ZGF0YWxlbiA9IE1hdGguY2VpbCgobGVuZ3RoT2YgKHN0cilwbHIubmV0ZGF0YSkgLyBzeW5jb2Jqc19zX01BWExFTl9ORVREQVRBKTsKICAgICAgICAgICAgICAgIGlmIChyZXNldCkgewogICAgICAgICAgICAgICAgICAgIEdBTUUubG9nKHN5bmNvYmpzX2hfYnl0ZUFycmF5VG9PYmpzKGI5MV9kZWNvZGUoKHN0cilwbHIubmV0ZGF0YSkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICMgY2hlY2sgc2l6ZSBvZiBlbmNvZGVkIGRhdGEgaXMgdG9vIGxhcmdlIGFuZCB3YXJuCiAgICAgICAgICAgICAgICBpZiAobGVuZ3RoT2YgKHN0cilwbHIubmV0ZGF0YSA+IHN5bmNvYmpzX3NfTUFYTEVOX05FVERBVEEpewogICAgICAgICAgICAgICAgICAgIG51bSBuZXRuZWVkZWQgPSBNYXRoLmNlaWwoKGxlbmd0aE9mIChzdHIpcGxyLm5ldGRhdGEpIC8gc3luY29ianNfc19NQVhMRU5fTkVUREFUQSk7CiAgICAgICAgICAgICAgICAgICAgbnVtIHRfZnBzID0gMTAwMC8oc3luY29ianNfc19TWU5DX0lOVEVSVkFMICogbmV0bmVlZGVkKTsKICAgICAgICAgICAgICAgICAgICBpZiAodF9mcHMgPCBzeW5jb2Jqc19zX0RFU0lSRURfRlBTKXsKICAgICAgICAgICAgICAgICAgICAgICAgR0FNRS5sb2coIldBUk46IGRhdGEgbGVuZ3RoIGlzICIsIGxlbmd0aE9mIChzdHIpcGxyLm5ldGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICBHQU1FLmxvZygidGFrZXMgIiwgc3luY29ianNfc19TWU5DX0lOVEVSVkFMICogbmV0bmVlZGVkLCAibXMgdG8gc2VuZCB1cGRhdGUgb3IgRlBTIGlzICAiLCB0X2Zwcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IAogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgICMgcGxyLm5ldGRhdGFsZW4gPSBNYXRoLmNlaWwoKGxlbmd0aE9mIGVuY29kZWRvYmpkYXRhKSAvIHN5bmNvYmpzX3NfTUFYTEVOX05FVERBVEEpOwogICAgICAgICAgICAKICAgICAgICAgICAgIyBmaWxsIG5ldHdvcmsgZGF0YSBpZiBpdCBETkUgeWV0CiAgICAgICAgICAgICMgaWYgKGxlbmd0aE9mIChzdHIpIHBsci5uZXRkYXRhID09IDApCiAgICAgICAgICAgICMgewogICAgICAgICAgICAgICAgIyBwbHIubmV0ZGF0YSA9IGVuY29kZWRvYmpkYXRhOwogICAgICAgICAgICAgICAgIyBwbHIubmV0ZGF0YWxlbiA9IE1hdGguY2VpbCgobGVuZ3RoT2YgZW5jb2RlZG9iamRhdGEpIC8gc3luY29ianNfc19NQVhMRU5fTkVUREFUQSk7CiAgICAgICAgICAgICMgfQogICAgICAgICAgICAjIHNlbmQgb3ZlciBuZXRkYXRhIGluIHRoZSBtYXggc2l6ZSBhbGxvd2VkCiAgICAgICAgICAgIGlmIChsZW5ndGhPZiAoc3RyKSBwbHIubmV0ZGF0YSA+IHN5bmNvYmpzX3NfTUFYTEVOX05FVERBVEEpewogICAgICAgICAgICAgICAgZGF0YXRvc2VuZCA9IHN0cnV0aWxzX3NwbGljZSgoc3RyKXBsci5uZXRkYXRhLDAsc3luY29ianNfc19NQVhMRU5fTkVUREFUQSk7CiAgICAgICAgICAgICAgICBwbHIubmV0ZGF0YSA9IHN0cnV0aWxzX3NwbGljZSgoc3RyKXBsci5uZXRkYXRhLHN5bmNvYmpzX3NfTUFYTEVOX05FVERBVEEsbGVuZ3RoT2YgKHN0cilwbHIubmV0ZGF0YSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRhdGF0b3NlbmQgPSAoc3RyKSBwbHIubmV0ZGF0YTsKICAgICAgICAgICAgICAgIHBsci5uZXRkYXRhID0gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgCiAgICAgICAgICAgICMgcGNudCBpcyBwZXJjZW50YWdlIG9mIGxvYWQgY29tcGxldGUKICAgICAgICAgICAgbnVtIHBjbnQgPSBNYXRoLmZsb29yKCggMSAtICgobGVuZ3RoT2YgKHN0cikgcGxyLm5ldGRhdGEpIC8gKChudW0pcGxyLm5ldGRhdGFsZW4gKiBzeW5jb2Jqc19zX01BWExFTl9ORVREQVRBKSkpKjEwMCk7CiAgICAgICAgICAgICMgc3VjY2VzcyA9IEdBTUUuTkVUV09SSy5zZW5kKCJzeW5jIiwge2Q6ZGF0YXRvc2VuZCwgZGVsbGlzdDpzeW5jb2Jqc19zX25ld2RlbGxpc3QscGNudDpwY250LHJzdDooYm9vbClwbHIubmV0cmVzZXQgPyAxOjB9LCAoc3RyKXBscnNbaV0uaWQpOyAgICAKICAgICAgICAgICAgc3VjY2VzcyA9IEdBTUUuTkVUV09SSy5zZW5kKCJzeW5jIiwge2Q6ZGF0YXRvc2VuZCxwY250OnBjbnQscnN0Oihib29sKXBsci5uZXRyZXNldCA/IDE6MH0sIChzdHIpcGxyc1tpXS5pZCk7ICAgIAogICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIEdBTUUubG9nKCJFUlJPUjogc3luYyBub3Qgc2VudCEhISIpOwogICAgICAgICAgICAgICAgR0FNRS5sb2coe2Q6ZGF0YXRvc2VuZCxwY250OnBjbnQscnN0Oihib29sKXBsci5uZXRyZXNldCA/IDE6MH0pOwogICAgICAgICAgICAgICAgIyBHQU1FLmxvZyh7ZDpkYXRhdG9zZW5kLCBkZWxsaXN0OnN5bmNvYmpzX3NfbmV3ZGVsbGlzdCxwY250OnBjbnQscnN0Oihib29sKXBsci5uZXRyZXNldCA/IDE6MH0pOwogICAgICAgICAgICB9IAogICAgICAgIH0KCiAgICAgICAgIyBmaW5kIGFsbCBvYmplY3RzIHRoYXQgYXJlIGZ1bGx5IGRlbGV0ZWQgKHNlbnQgZGVsZXRlIHRvIGFsbCBwbGF5ZXJzKQogICAgICAgIGZvciAobnVtIGkgPSBsZW5ndGhPZiBzeW5jb2Jqc19zX29iamxpc3QgLSAxOyBpID49IDA7IGktLSkKICAgICAgICB7CiAgICAgICAgICAgIG9iaiB0T2JqID0gc3luY29ianNfc19vYmpsaXN0W2ldOwogICAgICAgICAgICBpZiAoKHN0cil0T2JqLmRlbCAhPSAidW5kZWZpbmVkIiAmJiAoYm9vbCl0T2JqLmRlbCA9PSB0cnVlKXsKICAgICAgICAgICAgICAgIGlmIChsZW5ndGhPZiAoc3RyW10pdE9iai5kZWxwbHJpZHMgPj0gbGVuZ3RoT2YgcGxycyl7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlIHN5bmNvYmpzX3Nfb2JqbGlzdFtpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBpZiAoc3VjY2VzcykgewogICAgICAgICMgICAgIHN5bmNvYmpzX3NfbmV3ZGVsbGlzdCA9IG51bVtdOwogICAgICAgICMgfQogICAgfQp9CgojIFJ1bnMgd2hlbiB0aGUgcm91bmQgZW5kcwphY3Rpb24gc3luY29ianNfc19vbkdhbWVFbmQoKSB7CiAgICBzeW5jb2Jqc19zX2RlbGV0ZUFsbE9ianMoKTsKICAgICMgZGVsZXRlIGFsbCBvYmplY3RzIGNsaWVudCBzaWRlCiAgICBHQU1FLk5FVFdPUksuYnJvYWRjYXN0KCJjbGVhciIsIHt9KTsKfQoKYWN0aW9uIHN5bmNvYmpzX3Nfb25OZXR3b3JrTWVzc2FnZShzdHIgaWQsIG9iaiBkYXRhLCBzdHIgcGxheWVySUQpIHsKICAgIGlmIChpZCA9PSAicmVmcmVzaG9ianMiKXsKICAgICAgICBvYmogcGxyID0gR0FNRS5QTEFZRVJTLmZpbmRCeUlEKHBsYXllcklEKTsKICAgICAgICBwbHIubmV0cmVzZXQgPSB0cnVlOwogICAgfQp9CiNpbmNsdWRlIDxnLmtybms+CiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIExpYnJhcnk6IGxpYnNcRUNTXGJvdW5jZVxlY3NncmF2LmtybmsKIyBBdXRob3I6IGJsYW5kcmljZQojICAgRGVzY3JpcHRpb246IGdyYXZpdHkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojIG51bSBNQVhZVkVMID0gMTAwOwoKIyBudW0gYWN0aW9uIHNpZ24obnVtIGQpewojICAgICByZXR1cm4gZCA+PSAwID8gMSA6IC0xOwojIH0KCm51bSBhY3Rpb24gZmxvYXRpbmdfYXBwbHlzaW4ob2JqIHRvYmosIHN0ciBkaW0sIG51bSB0KQp7CiAgICBudW0gb2Zmc2V0ID0gKG51bSl0b2JqLmZsb2F0aW5nLm9mZnNldDsKICAgIGlmIChkaW09PSJ4IikKICAgIHsKICAgICAgICByZXR1cm4gKG51bSl0b2JqLmZsb2F0aW5nLm9ncG9zLnggKyAoKG51bSl0b2JqLmZsb2F0aW5nLmFtcGxpdHVkZS54KiBNYXRoLnNpbigoKChNYXRoLlBJMikqdCkgLyAobnVtKXRvYmouZmxvYXRpbmcudF9tc2ludGVydmFsKSsoTWF0aC5QSTIqb2Zmc2V0KSkpOwogICAgfSAKICAgIGVsc2UgaWYgKGRpbT09InkiKQogICAgewogICAgICAgIHJldHVybiAobnVtKXRvYmouZmxvYXRpbmcub2dwb3MueSArICgobnVtKXRvYmouZmxvYXRpbmcuYW1wbGl0dWRlLnkqIE1hdGguc2luKCgoKE1hdGguUEkyKSp0KSAvIChudW0pdG9iai5mbG9hdGluZy50X21zaW50ZXJ2YWwpKyhNYXRoLlBJMipvZmZzZXQpKSk7CiAgICB9CiAgICBlbHNlIGlmIChkaW09PSJ6IikKICAgIHsKICAgICAgICByZXR1cm4gKG51bSl0b2JqLmZsb2F0aW5nLm9ncG9zLnogKyAoKG51bSl0b2JqLmZsb2F0aW5nLmFtcGxpdHVkZS56KiBNYXRoLnNpbigoKChNYXRoLlBJMikqdCkgLyAobnVtKXRvYmouZmxvYXRpbmcudF9tc2ludGVydmFsKSsoTWF0aC5QSTIqb2Zmc2V0KSkpOwogICAgfQogICAgcmV0dXJuIDA7Cn0KCm51bSBhY3Rpb24gZmxvYXRpbmdfYXBwbHljb3Mob2JqIHRvYmosIHN0ciBkaW0sIG51bSB0KQp7CiAgICBudW0gb2Zmc2V0ID0gKG51bSl0b2JqLmZsb2F0aW5nLm9mZnNldDsKICAgIGlmIChkaW09PSJ4IikKICAgIHsKICAgICAgICByZXR1cm4gKG51bSl0b2JqLmZsb2F0aW5nLm9ncG9zLnggKyAoKG51bSl0b2JqLmZsb2F0aW5nLmFtcGxpdHVkZS54KiBNYXRoLmNvcygoKChNYXRoLlBJMikqdCkgLyAobnVtKXRvYmouZmxvYXRpbmcudF9tc2ludGVydmFsKSsoTWF0aC5QSTIqb2Zmc2V0KSkpOwogICAgfSAKICAgIGVsc2UgaWYgKGRpbT09InkiKQogICAgewogICAgICAgIHJldHVybiAobnVtKXRvYmouZmxvYXRpbmcub2dwb3MueSArICgobnVtKXRvYmouZmxvYXRpbmcuYW1wbGl0dWRlLnkqIE1hdGguY29zKCgoKE1hdGguUEkyKSp0KSAvIChudW0pdG9iai5mbG9hdGluZy50X21zaW50ZXJ2YWwpKyhNYXRoLlBJMipvZmZzZXQpKSk7CiAgICB9CiAgICBlbHNlIGlmIChkaW09PSJ6IikKICAgIHsKICAgICAgICByZXR1cm4gKG51bSl0b2JqLmZsb2F0aW5nLm9ncG9zLnogKyAoKG51bSl0b2JqLmZsb2F0aW5nLmFtcGxpdHVkZS56KiBNYXRoLmNvcygoKChNYXRoLlBJMikqdCkgLyAobnVtKXRvYmouZmxvYXRpbmcudF9tc2ludGVydmFsKSsoTWF0aC5QSTIqb2Zmc2V0KSkpOwogICAgfQogICAgcmV0dXJuIDA7Cn0KCmFjdGlvbiBmbG9hdGluZ19vbkVDU1VwZGF0ZShudW0gZGVsdGEsIG9iaiB0b2JqLCBvYmpbXSBvYmpsaXN0KXsKaWYgKG5vdEVtcHR5IChvYmopIHRvYmouZmxvYXRpbmcpIAogICAgewogICAgICAgICMgR0FNRS5sb2coImZsb2F0aW5nIG5vdCBlbXB0eSIpOwogICAgICAgIAogICAgICAgICMgKG51bSl0b2JqLmZsb2F0aW5nLm9ncG9zLngKICAgICAgICAjIChudW0pdG9iai5mbG9hdGluZy5vZ3Bvcy55CiAgICAgICAgIyAobnVtKXRvYmouZmxvYXRpbmcub2dwb3MuegoKICAgICAgICAjIChudW0pdG9iai5mbG9hdGluZy5hbXBsaXR1ZGUueAogICAgICAgICMgKG51bSl0b2JqLmZsb2F0aW5nLmFtcGxpdHVkZS55CiAgICAgICAgIyAobnVtKXRvYmouZmxvYXRpbmcuYW1wbGl0dWRlLnoKCiAgICAgICAgIyB0b2JqLmZsb2F0aW5nLnRfbXNpbnRlcnZhbAogICAgICAgICMgdG9iai5mbG9hdGluZy5fdHN0YXJ0CgogICAgICAgICMgKHN0cil0b2JqLmZsb2F0aW5nLnR5cGUgI3NpbmUsbGluZWFyCgogICAgICAgIG51bSB0ID0gKGdfdG5vdyAtIChudW0pdG9iai5mbG9hdGluZy5fdHN0YXJ0KTsKICAgICAgICBpZiAodCA+IChudW0pdG9iai5mbG9hdGluZy50X21zaW50ZXJ2YWwpCiAgICAgICAgewogICAgICAgICAgICB0b2JqLmZsb2F0aW5nLl90c3RhcnQgPSBnX3Rub3c7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICMgZWxzZSBpZiAoKHN0cil0b2JqLmZsb2F0aW5nLnR5cGUgPT0gInNpbmUiKQogICAgICAgICMgZWxzZSBpZiAobm90RW1wdHkgKG9iail0b2JqLmZsb2F0aW5nKXsKICAgICAgICAjIHsKICAgICAgICAjIEdBTUUubG9nKCJmbG9hdGluZyB0eXBlIGlzIHNpbmUiKTsKICAgICAgICAjIEdBTUUubG9nKHRvYmopOwogICAgICAgIGlmICgobnVtKXRvYmouZmxvYXRpbmcuYW1wbGl0dWRlLnggIT0wKQogICAgICAgIHsKICAgICAgICAgICAgIyB0b2JqLnBvc2l0aW9uLnggPSAobnVtKXRvYmouZmxvYXRpbmcub2dwb3MueCArICgobnVtKXRvYmouZmxvYXRpbmcuYW1wbGl0dWRlLngqIE1hdGguc2luKCgoKE1hdGguUEkyKSp0KSAvIChudW0pdG9iai5mbG9hdGluZy50X21zaW50ZXJ2YWwpKyhNYXRoLlBJMipvZmZzZXQpKSk7CiAgICAgICAgICAgIGlmICgoc3RyKXRvYmouZmxvYXRpbmcudHlwZS54PT0ic2luZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRvYmoucG9zaXRpb24ueCA9IGZsb2F0aW5nX2FwcGx5c2luKHRvYmosIngiLHQpOwogICAgICAgICAgICB9IAogICAgICAgICAgICBlbHNlIGlmICgoc3RyKXRvYmouZmxvYXRpbmcudHlwZS54PT0iY29zIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdG9iai5wb3NpdGlvbi54ID0gZmxvYXRpbmdfYXBwbHljb3ModG9iaiwieCIsdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKChudW0pdG9iai5mbG9hdGluZy5hbXBsaXR1ZGUueSAhPTApCiAgICAgICAgewogICAgICAgICAgICAjIHRvYmoucG9zaXRpb24ueSA9IChudW0pdG9iai5mbG9hdGluZy5vZ3Bvcy55ICsgKChudW0pdG9iai5mbG9hdGluZy5hbXBsaXR1ZGUueSogTWF0aC5zaW4oKCgoTWF0aC5QSTIpKnQpIC8gKG51bSl0b2JqLmZsb2F0aW5nLnRfbXNpbnRlcnZhbCkrKE1hdGguUEkyKm9mZnNldCkpKTsKICAgICAgICAgICAgIyB0b2JqLnBvc2l0aW9uLnkgPSBmbG9hdGluZ19hcHBseXNpbih0b2JqLCJ5Iix0KTsKICAgICAgICAgICAgaWYgKChzdHIpdG9iai5mbG9hdGluZy50eXBlLnk9PSJzaW5lIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdG9iai5wb3NpdGlvbi55ID0gZmxvYXRpbmdfYXBwbHlzaW4odG9iaiwieSIsdCk7CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIGVsc2UgaWYgKChzdHIpdG9iai5mbG9hdGluZy50eXBlLnk9PSJjb3MiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0b2JqLnBvc2l0aW9uLnkgPSBmbG9hdGluZ19hcHBseWNvcyh0b2JqLCJ5Iix0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoKG51bSl0b2JqLmZsb2F0aW5nLmFtcGxpdHVkZS56ICE9MCkKICAgICAgICB7CiAgICAgICAgICAgICMgdG9iai5wb3NpdGlvbi56ID0gKG51bSl0b2JqLmZsb2F0aW5nLm9ncG9zLnogKyAoKG51bSl0b2JqLmZsb2F0aW5nLmFtcGxpdHVkZS56KiBNYXRoLnNpbigoKChNYXRoLlBJMikqdCkgLyAobnVtKXRvYmouZmxvYXRpbmcudF9tc2ludGVydmFsKSsoTWF0aC5QSTIqb2Zmc2V0KSkpOwogICAgICAgICAgICAjIHRvYmoucG9zaXRpb24ueiA9IGZsb2F0aW5nX2FwcGx5c2luKHRvYmosInoiLHQpOwogICAgICAgICAgICBpZiAoKHN0cil0b2JqLmZsb2F0aW5nLnR5cGUuej09InNpbmUiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0b2JqLnBvc2l0aW9uLnogPSBmbG9hdGluZ19hcHBseXNpbih0b2JqLCJ6Iix0KTsKICAgICAgICAgICAgfSAKICAgICAgICAgICAgZWxzZSBpZiAoKHN0cil0b2JqLmZsb2F0aW5nLnR5cGUuej09ImNvcyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRvYmoucG9zaXRpb24ueiA9IGZsb2F0aW5nX2FwcGx5Y29zKHRvYmosInoiLHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICMgfSAKICAgICAgICBlbHNlICMgZGVmYXVsdCBpcyBubyBtb3ZlbWVudAogICAgICAgIHsKCiAgICAgICAgfQogICAgICAgICMgIyAobnVtKSB0b2JqLnZlbG9jaXR5LnkgKz0gKG51bSkgdG9iai5ncmF2aXR5LnkqKGRlbHRhLzEwMDApOwogICAgICAgICMgKG51bSkgdG9iai52ZWxvY2l0eS55ICs9IChudW0pIHRvYmouZ3Jhdml0eS55KihkZWx0YS8xMDAwKTsKICAgICAgICAjIGlmIChNYXRoLmFicygobnVtKSB0b2JqLnZlbG9jaXR5LnkpID4gTUFYWVZFTCl7CiAgICAgICAgIyAgICAgdG9iai52ZWxvY2l0eS55ID0gc2lnbigobnVtKSB0b2JqLnZlbG9jaXR5LnkpICogTUFYWVZFTDsKICAgICAgICAjIH0KCiAgICB9Cn0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTGlicmFyeTogbGlic1xFQ1NcYm91bmNlXGVjc2dyYXYua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogZ3Jhdml0eQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCm51bSBlY3NncmF2X01BWFlWRUwgPSAxMDA7CgpudW0gYWN0aW9uIGVjc2dyYXZfc2lnbihudW0gZCl7CiAgICByZXR1cm4gZCA+PSAwID8gMSA6IC0xOwp9CgphY3Rpb24gZWNzZ3Jhdl9vbkVDU1VwZGF0ZShudW0gZGVsdGEsIG9iaiB0b2JqLCBvYmpbXSBvYmpsaXN0KXsKaWYgKG5vdEVtcHR5IChvYmopIHRvYmouZ3Jhdml0eSAmJiAobnVtKSB0b2JqLm9uR3JvdW5kID09IDAgKSAKICAgIHsKICAgICAgICAobnVtKSB0b2JqLnZlbG9jaXR5LnkgKz0gKG51bSkgdG9iai5ncmF2aXR5LnkqKGRlbHRhLzEwMDApOwogICAgICAgIGlmIChNYXRoLmFicygobnVtKSB0b2JqLnZlbG9jaXR5LnkpID4gZWNzZ3Jhdl9NQVhZVkVMKXsKICAgICAgICAgICAgdG9iai52ZWxvY2l0eS55ID0gZWNzZ3Jhdl9zaWduKChudW0pIHRvYmoudmVsb2NpdHkueSkgKiBlY3NncmF2X01BWFlWRUw7CiAgICAgICAgfQoKICAgIH0KfQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBMaWJyYXJ5OiBsaWJzXEVDU1xjb21wb25lbnRzXHBoeXNpY3NcZWNzcGh5c2ljcy5rcm5rCiMgQXV0aG9yOiBibGFuZHJpY2UKIyAgIERlc2NyaXB0aW9uOiBjbGFzc2ljIHBvc2l0aW9uL3ZlbG9jaXR5LyhldmVudHVhbGx5IGFjY2VsZXJhdGlvbikKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgphY3Rpb24gZWNzcGh5c2ljc19vbkVDU1VwZGF0ZShudW0gZGVsdGEsIG9iaiB0b2JqLCBvYmpbXSBvYmpsaXN0KXsKICAgIHRvYmoub2d2ZWwgPSAKICAgICAgICB7CiAgICAgICAgICAgIHg6IChudW0pIHRvYmoudmVsb2NpdHkueCwKICAgICAgICAgICAgeTogKG51bSkgdG9iai52ZWxvY2l0eS55LAogICAgICAgICAgICB6OiAobnVtKSB0b2JqLnZlbG9jaXR5LnoKICAgICAgICB9OwogICAgIyBhY3R1YWxseSBjaGFuZ2UgcG9zaXRpb24KICAgIChudW0pIHRvYmoucG9zaXRpb24ueCArPSAobnVtKXRvYmoudmVsb2NpdHkueCAqIChkZWx0YS8xMDAwKTsKICAgIChudW0pIHRvYmoucG9zaXRpb24ueSArPSAobnVtKXRvYmoudmVsb2NpdHkueSAqIChkZWx0YS8xMDAwKTsKICAgIChudW0pIHRvYmoucG9zaXRpb24ueiArPSAobnVtKXRvYmoudmVsb2NpdHkueiAqIChkZWx0YS8xMDAwKTsKfQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBMaWJyYXJ5OiBcbGlic1xFQ1NcZWNzX2gua3JuawojIEF1dGhvcjogYmxhbmRyaWNlCiMgICBEZXNjcmlwdGlvbjogRW50aXR5ISBDb21wb25lbnQhISBTeXN0ZW0hISEKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cm51bSBlY3NfaF9DT0xfV09STEQgPSAweDE7ICMgb2JqZWN0IGNhbiBjb2xsaWRlIHdpdGggd29ybGQKbnVtIGVjc19oX0NPTF9PQkpTID0gMHgyOyAjIG9iamVjdCBjYW4gY29sbGlkZSB3aXRoIG90aGVyIG9iamVjdHMKbnVtIGVjc19oX0NPTF9QTFJTID0gMHg0OyAjIG9iamVjdCBjYW4gZGV0ZWN0IGNvbGxpc2lvbiB3aXRoIHBsYXllcgpudW0gZWNzX2hfQ09MX09CSjJQTFJTID0gMHg4OyAjICMgcGxheWVyIGNhbiBjb2xsaWRlIHdpdGggb2JqZWN0ICh1c3VhbGx5IHJlc29sdmVzIGNvbGxpc2lvbi4gY3VycmVudGx5IGRlZmF1bHQgdGhpcyBkb2VzIG5vdCBtYXR0ZXIpCgphY3Rpb24gZWNzX2hfb25Db2xsaWRlV29ybGQob2JqIHRvYmosIG9ialtdIGNvbGxpc3QpewoKfQoKYWN0aW9uIGVjc19oX29uRUNTVXBkYXRlKG51bSBkZWx0YSwgb2JqIHRvYmosIG9ialtdIG9iamxpc3Qpewp9CgphY3Rpb24gZWNzX2hfb25Db2xsaWRlKG9iaiB0b2JqLCBvYmpbXSBvYmpsaXN0KXsKCn0KCmFjdGlvbiBlY3NfaF9vbkNvbGxpZGVQbHJzKG9iaiB0b2JqLCBvYmpbXSBwbHJzKXsKCn0KCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBMaWJyYXJ5OiBsaWJzXEVDU1xlbnRpdGllc1xwbGF0Zm9ybVxwbGF0Zm9ybS5rcm5rCiMgQXV0aG9yOiBibGFuZHJpY2UKIyAgIERlc2NyaXB0aW9uOiBmaXJzdCB0cnkgY3JlYXRpbmcgcGxhdGZvcm0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgoKIyBkZWZhdWx0IHBsYXRmb3JtIHdpbGw6CiMgMS4gc2hha2UgYW5kIGZhbGwgb24gc3RlcHBpbmcgMyB0aW1lcwphY3Rpb24gcGxhdGZvcm1fY3JlYXRlKG9iaiBwcm9wcyl7CiAgICBvYmogbmV3T2JqID0gewogICAgICAgIGFpZDogMTE2NzYsCiAgICAgICAgc2NhbGU6e3g6MTAseToxMCx6OjEwfSwKICAgICAgICBwb3NpdGlvbjp7eDowLHk6MjIsejowfSwKICAgICAgICB2ZWxvY2l0eTp7eDowLHk6MCx6OjB9LAogICAgICAgIHNjYWxlOnt4OjUwLHk6MTAsejo1MH0sCiAgICAgICAgY29sb3I6MHhGRkZGRkYsCiAgICAgICAgZW1pc3NpdmU6MHgwMDAwMDAsCiAgICAgICAgb25Hcm91bmQ6ZmFsc2UsCiAgICAgICAgY29sbGlkZTp7dHlwZTplY3NfaF9DT0xfUExSU30sCiAgICAgICAgIyBwbGF0Y3J1bWJsZXM6e2NydW1ibGVjbnQ6MyxpbnRfY3J1bWJsZTo1MDAsX3RsYXN0Y3J1bWJsZTowLGxpZmV0aW1lOjEwMDB9LAogICAgICAgICMgc2hha2U6e3g6MCx5OjAsejowLGVuOjAsaW50ZW5zaXR5Ont4OjEseTowLHo6MX0sZHVyYXRpb246NDAwfQogICAgfTsKICAgIGlmICgoc3RyKXByb3BzLnNoYWtlICE9ICJ1bmRlZmluZWQiKQogICAgewogICAgICAgIG5ld09iai5zaGFrZSA9IHt4OjAseTowLHo6MCxlbjowLGludGVuc2l0eTp7eDoxLHk6MCx6OjF9LGR1cmF0aW9uOjQwMH07CiAgICB9CiAgICBpZiAoKHN0cilwcm9wcy5jcnVtYmxlICE9ICJ1bmRlZmluZWQiKQogICAgewogICAgICAgIG5ld09iai5wbGF0Y3J1bWJsZXM9CiAgICAgICAgICAgIHsgICAKICAgICAgICAgICAgICAgIGNydW1ibGVjbnQ6KG51bSlwcm9wcy5jcnVtYmxlLmNydW1ibGVjbnQsCiAgICAgICAgICAgICAgICBpbnRfY3J1bWJsZToobnVtKXByb3BzLmNydW1ibGUuaW50X2NydW1ibGUsCiAgICAgICAgICAgICAgICBsaWZldGltZToobnVtKXByb3BzLmNydW1ibGUubGlmZXRpbWUsCiAgICAgICAgICAgICAgICBfdGxhc3RjcnVtYmxlOjAKICAgICAgICAgICAgfTsKICAgIH0KICAgIGlmICgoc3RyKXByb3BzLmZsb2F0aW5nICE9ICJ1bmRlZmluZWQiKQogICAgewogICAgICAgIG5ld09iai5mbG9hdGluZz0KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgb2dwb3M6e3g6KG51bSlwcm9wcy5mbG9hdGluZy5vZ3Bvcy54LHk6KG51bSlwcm9wcy5mbG9hdGluZy5vZ3Bvcy55LHo6KG51bSlwcm9wcy5mbG9hdGluZy5vZ3Bvcy56fSwKICAgICAgICAgICAgICAgIGFtcGxpdHVkZToge3g6KG51bSlwcm9wcy5mbG9hdGluZy5hbXBsaXR1ZGUueCx5OihudW0pcHJvcHMuZmxvYXRpbmcuYW1wbGl0dWRlLnksejoobnVtKXByb3BzLmZsb2F0aW5nLmFtcGxpdHVkZS56fSwKICAgICAgICAgICAgICAgIHRfbXNpbnRlcnZhbDogKG51bSlwcm9wcy5mbG9hdGluZy50X21zaW50ZXJ2YWwsCiAgICAgICAgICAgICAgICB0eXBlOiB7eDooc3RyKXByb3BzLmZsb2F0aW5nLnR5cGUueCx5OihzdHIpcHJvcHMuZmxvYXRpbmcudHlwZS55LHo6KHN0cilwcm9wcy5mbG9hdGluZy50eXBlLnp9LAogICAgICAgICAgICAgICAgb2Zmc2V0OiAoKHN0cilwcm9wcy5mbG9hdGluZy5vZmZzZXQgIT0gInVuZGVmaW5lZCIpID8gKG51bSkgcHJvcHMuZmxvYXRpbmcub2Zmc2V0OiAwLAogICAgICAgICAgICAgICAgX3RzdGFydDogZ190bm93LAogICAgICAgICAgICB9OwogICAgfQogICAgaWYgKG5vdEVtcHR5IChvYmopcHJvcHMucG9zaXRpb24pewogICAgICAgIG5ld09iai5wb3NpdGlvbi54ID0gKG51bSlwcm9wcy5wb3NpdGlvbi54OwogICAgICAgIG5ld09iai5wb3NpdGlvbi55ID0gKG51bSlwcm9wcy5wb3NpdGlvbi55OwogICAgICAgIG5ld09iai5wb3NpdGlvbi56ID0gKG51bSlwcm9wcy5wb3NpdGlvbi56OwogICAgfQogICAgaWYgKG5vdEVtcHR5IChvYmopcHJvcHMuc2NhbGUpewogICAgICAgIG5ld09iai5zY2FsZS54ID0gKG51bSlwcm9wcy5zY2FsZS54OwogICAgICAgIG5ld09iai5zY2FsZS55ID0gKG51bSlwcm9wcy5zY2FsZS55OwogICAgICAgIG5ld09iai5zY2FsZS56ID0gKG51bSlwcm9wcy5zY2FsZS56OwogICAgfQogICAgaWYgKChzdHIpcHJvcHMuY29sb3IgIT0gInVuZGVmaW5lZCIpewogICAgICAgIG5ld09iai5jb2xvciA9IChudW0pIHByb3BzLmNvbG9yOwogICAgfQogICAgaWYgKChzdHIpcHJvcHMuY29sb3IgIT0gInVuZGVmaW5lZCIpewogICAgICAgIG5ld09iai5haWQgPSAobnVtKSBwcm9wcy5haWQ7CiAgICB9CiAgICBzeW5jb2Jqc19zX2NyZWF0ZU9iamVjdChuZXdPYmopOwogICAgIyBncmF2aXR5Ont4OjAseTotMTAwLHo6MH0KfQoKbnVtIFtdIHBsYXRmb3JtX2NvbG9yY3J1bWJsZSA9IG51bVsweEZGMDAwMCwweEZGRkYwMCwweDAwRkYwMF07CmFjdGlvbiBwbGF0Zm9ybV9vbkNvbGxpZGVQbHJzKG9iaiB0b2JqLCBvYmpbXSBwbHJzKXsKICAgIGlmIChub3RFbXB0eSAob2JqKSB0b2JqLnBsYXRjcnVtYmxlcyl7CiAgICAgICAgaWYgKChnX3Rub3cgLSAobnVtKXRvYmoucGxhdGNydW1ibGVzLl90bGFzdGNydW1ibGUpID4gKG51bSl0b2JqLnBsYXRjcnVtYmxlcy5pbnRfY3J1bWJsZSl7CiAgICAgICAgICAgIGlmICgobnVtKXRvYmoucGxhdGNydW1ibGVzLmNydW1ibGVjbnQgPiAwKXsKICAgICAgICAgICAgICAgIChudW0pdG9iai5wbGF0Y3J1bWJsZXMuY3J1bWJsZWNudC0tOwogICAgICAgICAgICAgICAgdG9iai5lbWlzc2l2ZSA9IHBsYXRmb3JtX2NvbG9yY3J1bWJsZVsoKG51bSl0b2JqLnBsYXRjcnVtYmxlcy5jcnVtYmxlY250ICUgMyldOwogICAgICAgICAgICAgICAgdG9iai5zaGFrZS5lbiA9IDE7CiAgICAgICAgICAgICAgICB0b2JqLnBsYXRjcnVtYmxlcy5fdGxhc3RjcnVtYmxlID0gZ190bm93OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgobnVtKXRvYmoucGxhdGNydW1ibGVzLmNydW1ibGVjbnQgPT0gMCAmJiAhbm90RW1wdHkgKG9iaikgdG9iai5ncmF2aXR5KXsKICAgICAgICAgICAgICAgIHRvYmouZ3Jhdml0eSA9IHt4OjAseTotMTAwLHo6MH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmFjdGlvbiBwbGF0Zm9ybV9vbkVDU1VwZGF0ZShudW0gZGVsdGEsIG9iaiB0b2JqLCBvYmpbXSBvYmpsaXN0KXsKICAgIGlmIChub3RFbXB0eSAob2JqKSB0b2JqLnBsYXRjcnVtYmxlcyl7CiAgICAgICAgaWYgKChudW0pdG9iai5wbGF0Y3J1bWJsZXMuY3J1bWJsZWNudCA9PSAwICYmIChnX3Rub3cgLSAobnVtKXRvYmoucGxhdGNydW1ibGVzLl90bGFzdGNydW1ibGUpID4gKG51bSl0b2JqLnBsYXRjcnVtYmxlcy5saWZldGltZSl7CiAgICAgICAgICAgIHN5bmNvYmpzX3NfZGVsZXRlT2JqZWN0KChzdHIpdG9iai5vYmppZCk7CiAgICAgICAgICAgIAogICAgICAgIH0KICAgIH0KfQojaW5jbHVkZSA8c3luY29ianNfcy5rcm5rPgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBIZWFkZXI6IFxsaWJzXGNvbGxpc2lvbnNcQUFCQi5rcm5rCiMgQXV0aG9yOiBLRzA3IChtb2RpZmllZCBieSBibGFuZHJpY2UpCiMgRGVzY3JpcHRpb246IEFBQkIgKGF4aXMtYWxpZ25lZCBib3VuZGluZyBib3gtYm94KSBjb2xsaXNpb24gKyByZXNvbHV0aW9uCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKbnVtIEFBQkJfdyA9IDQuOTsjIHBsYXllciB3aWR0aApudW0gQUFCQl9jID0gODsjIGNyb3VjaGluZyBoZWlnaHQKbnVtIEFBQkJfSCA9IDExOyMgc3RhbmRpbmcgaGVpZ2h0CgpudW0gQUFCQl9YTkVHID0gMHgxOwpudW0gQUFCQl9YUE9TID0gMHgyOwpudW0gQUFCQl9ZTkVHID0gMHg0OyAjaGl0ICJncm91bmQiCm51bSBBQUJCX1lQT1MgPSAweDg7IApudW0gQUFCQl9aTkVHID0gMHgxMDsKbnVtIEFBQkJfWlBPUyA9IDB4MjA7Cgpib29sIGFjdGlvbiBBQUJCX2lzQ29sbGlzaW9uKG9iaiBjdWJlMSwgb2JqIGN1YmUyKQp7CiAgICAjIEFkYXB0ZWQgZnJvbSBodHRwczovL3R1dG9yaWFsZWRnZS5uZXQvZ2FtZWRldi9hYWJiLWNvbGxpc2lvbi1kZXRlY3Rpb24tdHV0b3JpYWwvCiAgICBudW0gZHggPSBNYXRoLmFicygobnVtKWN1YmUxLnBvc2l0aW9uLnggLSAobnVtKWN1YmUyLnBvc2l0aW9uLngpIC0gKChudW0pY3ViZTEuc2NhbGUueC8yICsgKG51bSljdWJlMi5zY2FsZS54LzIpOwogICAgbnVtIGR5ID0gTWF0aC5hYnMoKG51bSljdWJlMS5wb3NpdGlvbi55ICsobnVtKWN1YmUxLnNjYWxlLnkvMiAtIChudW0pY3ViZTIucG9zaXRpb24ueSAtIChudW0pY3ViZTIuc2NhbGUueS8yKSAtICgobnVtKWN1YmUxLnNjYWxlLnkvMiArIChudW0pY3ViZTIuc2NhbGUueS8yKTsKICAgIG51bSBkeiA9IChNYXRoLmFicygobnVtKWN1YmUxLnBvc2l0aW9uLnogLSAobnVtKWN1YmUyLnBvc2l0aW9uLnopIC0gKChudW0pY3ViZTEuc2NhbGUuei8yICsgKG51bSljdWJlMi5zY2FsZS56LzIpKTsKICAgIGlmICgoZHggPCAwKSAmJiAoZHkgPCAwKSAmJiAoZHogPCAwKSkKICAgIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICAgICAgICAKfQoKb2JqIGFjdGlvbiBBQUJCX0NhbGN1bGF0ZUFhYmJEaXN0YW5jZVRvKG9iaiBjdWJlMSwgb2JqIGN1YmUyKQp7CiAgICBudW0gZHggPSBNYXRoLmFicygobnVtKWN1YmUxLnBvc2l0aW9uLnggLSAobnVtKWN1YmUyLnBvc2l0aW9uLngpIC0gKChudW0pY3ViZTEuc2NhbGUueC8yICsgKG51bSljdWJlMi5zY2FsZS54LzIpOwogICAgbnVtIGR5ID0gTWF0aC5hYnMoKG51bSljdWJlMS5wb3NpdGlvbi55ICsobnVtKWN1YmUxLnNjYWxlLnkvMiAtIChudW0pY3ViZTIucG9zaXRpb24ueSAtIChudW0pY3ViZTIuc2NhbGUueS8yKSAtICgobnVtKWN1YmUxLnNjYWxlLnkvMiArIChudW0pY3ViZTIuc2NhbGUueS8yKTsKICAgIG51bSBkeiA9IChNYXRoLmFicygobnVtKWN1YmUxLnBvc2l0aW9uLnogLSAobnVtKWN1YmUyLnBvc2l0aW9uLnopIC0gKChudW0pY3ViZTEuc2NhbGUuei8yICsgKG51bSljdWJlMi5zY2FsZS56LzIpKTsKCiAgICByZXR1cm4ge3g6ZHgseTpkeSx6OmR6fTsKfQoKbnVtIEFBQkJfc3QgPSAzOyNzdGFpciBoZWlnaHQKCm51bSBhY3Rpb24gQUFCQl9zaWRlKG51bSBDLCBudW0gUywgbnVtIGlucHV0KXsKCWlmKGlucHV0IDw9IEMtUyl7cmV0dXJuIC0xO30KCWlmKGlucHV0ID49IEMrUyl7cmV0dXJuIDE7fQoJcmV0dXJuIDA7Cn0KCm9ialtdIGFjdGlvbiBBQUJCX3Jlc29sdmUob2JqIGN1YmUxLG9ialtdIGN1YmVzKSB7CiAgICBvYmpbXSBjb2xsaXNpb25zID0gb2JqW107CiAgICBudW0gdG90YWxjb2xzaWRlID0gMDsKCWZvcihudW0gaSA9IDA7IGkgPCBsZW5ndGhPZiBjdWJlczsgaSsrKXsKICAgICAgICBudW0gY29sc2lkZSA9IDA7CiAgICAgICAgb2JqIGNvbG9iaiA9IHt9OwoKICAgICAgICBudW0gcHggPSAobnVtKSBjdWJlMS5wb3NpdGlvbi54OwogICAgICAgIG51bSBweSA9IChudW0pIGN1YmUxLnBvc2l0aW9uLnk7CiAgICAgICAgbnVtIHB6ID0gKG51bSkgY3ViZTEucG9zaXRpb24uejsKICAgICAgICBudW0gdnggPSAobnVtKSBjdWJlMS52ZWxvY2l0eS54OwogICAgICAgIG51bSB2eSA9IChudW0pIGN1YmUxLnZlbG9jaXR5Lnk7CiAgICAgICAgbnVtIHZ6ID0gKG51bSkgY3ViZTEudmVsb2NpdHkuejsKICAgICAgICAKICAgICAgICBudW0gY3N4ID0gKG51bSkgY3ViZTEuc2NhbGUueC8yOwogICAgICAgIG51bSBjc3kgPSAobnVtKSBjdWJlMS5zY2FsZS55LzI7CiAgICAgICAgbnVtIGNzeiA9IChudW0pIGN1YmUxLnNjYWxlLnovMjsKCiAgICAgICAgb2JqIHRjdWJlID0gY3ViZXNbaV07CiAgICAgICAgbnVtIGN4ID0gKG51bSkgdGN1YmUucG9zaXRpb24ueDsKICAgICAgICBudW0gY3kgPSAobnVtKSB0Y3ViZS5wb3NpdGlvbi55OwogICAgICAgIG51bSBjeiA9IChudW0pIHRjdWJlLnBvc2l0aW9uLno7CiAgICAgICAgbnVtIHN4ID0gKG51bSkgdGN1YmUuc2NhbGUueCAvIDI7CiAgICAgICAgbnVtIHN5ID0gKG51bSkgdGN1YmUuc2NhbGUueSAvIDI7CiAgICAgICAgbnVtIHN6ID0gKG51bSkgdGN1YmUuc2NhbGUueiAvIDI7CiAgICAgICAgbnVtIG9weCA9IHB4OwogICAgICAgIG51bSBvcHkgPSBweTsKICAgICAgICBudW0gb3B6ID0gcHo7CiAgICAgICAgbnVtIG9jeCA9IGN4OwogICAgICAgIG51bSBvY3kgPSBjeTsKICAgICAgICBudW0gb2N6ID0gY3o7CiAgICAgICAgCiAgICAgICAgaWYgKG5vdEVtcHR5IChvYmopIGN1YmUxLm9ncG9zKXsKICAgICAgICAgICAgb3B4ID0gKG51bSljdWJlMS5vZ3Bvcy54OwogICAgICAgICAgICBvcHkgPSAobnVtKWN1YmUxLm9ncG9zLnk7CiAgICAgICAgICAgIG9weiA9IChudW0pY3ViZTEub2dwb3MuejsKICAgICAgICB9IGlmIChub3RFbXB0eSAob2JqKXRjdWJlLm9ncG9zKXsKICAgICAgICAgICAgb2N4ID0gKG51bSl0Y3ViZS5vZ3Bvcy54OwogICAgICAgICAgICBvY3kgPSAobnVtKXRjdWJlLm9ncG9zLnk7CiAgICAgICAgICAgIG9jeiA9IChudW0pdGN1YmUub2dwb3MuejsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgIyAteAogICAgICAgIGlmKHB4IDw9IGN4ICsgc3ggKyBjc3ggJiYgb3B4ID49IG9jeCArIHN4ICsgY3N4ICYmIEFBQkJfc2lkZShjeiwgc3ogKyBjc3osIHB6KSA9PSAwICYmIEFBQkJfc2lkZShjeSArIHN5LCBzeSArIGNzeSwgcHkgKyBjc3kpID09IDApewogICAgICAgICAgICBpZihweSA+PSBjeSArIDIgKiBzeSAtIEFBQkJfc3QgJiYgKChib29sKSBjdWJlMS5vbkdyb3VuZCkpewogICAgICAgICAgICAgICAgY3ViZTEucG9zaXRpb24ueSA9IGN5ICsgMiAqIHN5OyAKICAgICAgICAgICAgICAgIGN1YmUxLnZlbG9jaXR5LnkgPSAobm90RW1wdHkgKG9iail0Y3ViZS52ZWxvY2l0eSkgPyAobnVtKXRjdWJlLnZlbG9jaXR5LnkgOiAwOwogICAgICAgICAgICAgICAgY3ViZTEub25Hcm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgY3ViZTEucG9zaXRpb24ueCA9IGN4ICsgc3ggKyBjc3g7CiAgICAgICAgICAgICAgICBjdWJlMS52ZWxvY2l0eS54ID0gKG5vdEVtcHR5IChvYmopdGN1YmUudmVsb2NpdHkpID8gKG51bSl0Y3ViZS52ZWxvY2l0eS54IDogMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdWJlMS5vbldhbGwgPSB0cnVlOwogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWE5FRzsKICAgICAgICB9CiAgICAgICAgIyAreAogICAgICAgIGlmKHB4ID49IGN4IC0gc3ggLSBjc3ggJiYgb3B4IDw9IG9jeCAtIHN4IC0gY3N4ICYmIEFBQkJfc2lkZShjeiwgc3ogKyBjc3osIHB6KSA9PSAwICYmIEFBQkJfc2lkZShjeSArIHN5LCBzeSArIGNzeSwgcHkgKyBjc3kpID09IDApewogICAgICAgICAgICBpZihweSA+PSBjeSArIDIgKiBzeSAtIEFBQkJfc3QgJiYgKChib29sKSBjdWJlMS5vbkdyb3VuZCkpewogICAgICAgICAgICAgICAgY3ViZTEucG9zaXRpb24ueSA9IGN5ICsgMiAqIHN5OyAKICAgICAgICAgICAgICAgIGN1YmUxLnZlbG9jaXR5LnkgPSAobm90RW1wdHkgKG9iail0Y3ViZS52ZWxvY2l0eSkgPyAobnVtKXRjdWJlLnZlbG9jaXR5LnkgOiAwOwogICAgICAgICAgICAgICAgY3ViZTEub25Hcm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgY3ViZTEucG9zaXRpb24ueCA9IGN4IC0gc3ggLSBjc3g7CiAgICAgICAgICAgICAgICBjdWJlMS52ZWxvY2l0eS54ID0gKG5vdEVtcHR5IChvYmopdGN1YmUudmVsb2NpdHkpID8gKG51bSl0Y3ViZS52ZWxvY2l0eS54IDogMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdWJlMS5vbldhbGwgPSB0cnVlOwogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWFBPUzsKICAgICAgICB9CiAgICAgICAgIyAteQogICAgICAgIGlmKHB5IDw9IGN5ICsgMiAqIHN5ICYmIG9weSA+PSBvY3kgKyAyICogc3kgJiYgQUFCQl9zaWRlKGN4LCBzeCArIGNzeCwgcHgpID09IDAgJiYgQUFCQl9zaWRlKGN6LCBzeiArIGNzeiwgcHopID09IDApewogICAgICAgICAgICBjdWJlMS5wb3NpdGlvbi55ID0gY3kgKyAyICogc3k7CiAgICAgICAgICAgIGN1YmUxLnZlbG9jaXR5LnkgPSAobm90RW1wdHkgKG9iail0Y3ViZS52ZWxvY2l0eSkgPyAobnVtKXRjdWJlLnZlbG9jaXR5LnkgOiAwOwogICAgICAgICAgICBjdWJlMS5vbkdyb3VuZCA9IHRydWU7CiAgICAgICAgICAgIGNvbHNpZGUgfD0gQUFCQl9ZTkVHOwogICAgICAgIH0KICAgICAgICAjICt5CiAgICAgICAgaWYocHkgKyAyICogY3N5ID49IGN5ICYmIG9weSArIDIgKiBjc3kgPD0gb2N5ICYmIEFBQkJfc2lkZShjeCwgc3ggKyBjc3gsIHB4KSA9PSAwICYmIEFBQkJfc2lkZShjeiwgc3ogKyBjc3osIHB6KSA9PSAwKXsKICAgICAgICAgICAgY3ViZTEucG9zaXRpb24ueSA9IGN5IC0gMiAqIGNzeTsKICAgICAgICAgICAgY3ViZTEudmVsb2NpdHkueSA9IChub3RFbXB0eSAob2JqKXRjdWJlLnZlbG9jaXR5KSA/IChudW0pdGN1YmUudmVsb2NpdHkueSA6IDA7CiAgICAgICAgICAgIGNvbHNpZGUgfD0gQUFCQl9ZUE9TOwogICAgICAgIH0KICAgICAgICAjIC16CiAgICAgICAgaWYocHogPD0gY3ogKyBzeiArIGNzeiAmJiBvcHogPj0gb2N6ICsgc3ogKyBjc3ogJiYgQUFCQl9zaWRlKGN4LCBzeCArIGNzeCwgcHgpID09IDAgJiYgQUFCQl9zaWRlKGN5ICsgc3ksIHN5ICsgY3N6LCBweSArIGNzeikgPT0gMCl7CiAgICAgICAgICAgIGlmKHB5ID49IGN5ICsgMiAqIHN5IC0gQUFCQl9zdCAmJiAoKGJvb2wpIGN1YmUxLm9uR3JvdW5kKSl7CiAgICAgICAgICAgICAgICBjdWJlMS5wb3NpdGlvbi55ID0gY3kgKyAyICogc3k7IAogICAgICAgICAgICAgICAgY3ViZTEudmVsb2NpdHkueSA9IChub3RFbXB0eSAob2JqKXRjdWJlLnZlbG9jaXR5KSA/IChudW0pdGN1YmUudmVsb2NpdHkueSA6IDA7CiAgICAgICAgICAgICAgICBjdWJlMS5vbkdyb3VuZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIGN1YmUxLnBvc2l0aW9uLnogPSBjeiArIHN6ICsgY3N6OwogICAgICAgICAgICAgICAgY3ViZTEudmVsb2NpdHkueiA9IChub3RFbXB0eSAob2JqKXRjdWJlLnZlbG9jaXR5KSA/IChudW0pdGN1YmUudmVsb2NpdHkueiA6IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGN1YmUxLm9uV2FsbCA9IHRydWU7CiAgICAgICAgICAgIGNvbHNpZGUgfD0gQUFCQl9aTkVHOwogICAgICAgIH0KICAgICAgICAjICt6CiAgICAgICAgaWYocHogPj0gY3ogLSBzeiAtIGNzeiAmJiBvcHogPD0gb2N6IC0gc3ogLSBjc3ogJiYgQUFCQl9zaWRlKGN4LCBzeCArIGNzeCwgcHgpID09IDAgJiYgQUFCQl9zaWRlKGN5ICsgc3ksIHN5ICsgY3N5LCBweSArIGNzeSkgPT0gMCl7CiAgICAgICAgICAgIGlmKHB5ID49IGN5ICsgMiAqIHN5IC0gQUFCQl9zdCAmJiAoKGJvb2wpIGN1YmUxLm9uR3JvdW5kKSl7CiAgICAgICAgICAgICAgICBjdWJlMS5wb3NpdGlvbi55ID0gY3kgKyAyICogc3k7IAogICAgICAgICAgICAgICAgY3ViZTEudmVsb2NpdHkueSA9IChub3RFbXB0eSAob2JqKXRjdWJlLnZlbG9jaXR5KSA/IChudW0pdGN1YmUudmVsb2NpdHkueSA6IDA7IAogICAgICAgICAgICAgICAgY3ViZTEub25Hcm91bmQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICBjdWJlMS5wb3NpdGlvbi56ID0gY3ogLSBzeiAtIGNzejsKICAgICAgICAgICAgICAgIGN1YmUxLnZlbG9jaXR5LnogPSAobm90RW1wdHkgKG9iail0Y3ViZS52ZWxvY2l0eSkgPyAobnVtKXRjdWJlLnZlbG9jaXR5LnogOiAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1YmUxLm9uV2FsbCA9IHRydWU7CiAgICAgICAgICAgIGNvbHNpZGUgfD0gQUFCQl9aUE9TOwogICAgICAgIH0KICAgICAgICBpZiAoY29sc2lkZSA+IDApewogICAgICAgICAgICBjb2xvYmogPSB0Y3ViZTsKICAgICAgICAgICAgYWRkVG8gY29sbGlzaW9ucyB7Y29sc2lkZTpjb2xzaWRlLGNvbG9iajpjb2xvYmp9OwogICAgICAgIH0gCiAgICAgICAgdG90YWxjb2xzaWRlIHw9IGNvbHNpZGU7Cgl9CiAgICBpZiAobm90RW1wdHkgKG9iailjdWJlMS5vZ3BvcykgewogICAgICAgIGN1YmUxLm9ncG9zLnggPSAobnVtKSBjdWJlMS5wb3NpdGlvbi54ICsgMDsKICAgICAgICBjdWJlMS5vZ3Bvcy55ID0gKG51bSkgY3ViZTEucG9zaXRpb24ueSArIDA7CiAgICAgICAgY3ViZTEub2dwb3MueiA9IChudW0pIGN1YmUxLnBvc2l0aW9uLnogKyAwOwogICAgfSBlbHNlIHsKICAgICAgICBjdWJlMS5vZ3BvcyA9IAogICAgICAgIHsKICAgICAgICAgICAgeDoobnVtKWN1YmUxLnBvc2l0aW9uLnggKyAwLAogICAgICAgICAgICB5OihudW0pY3ViZTEucG9zaXRpb24ueSArIDAsCiAgICAgICAgICAgIHo6KG51bSljdWJlMS5wb3NpdGlvbi56ICsgMAogICAgICAgIH07CiAgICB9CiAgICAjIEdBTUUubG9nKGNvbGxpc2lvbnMpOwogICAgcmV0dXJuIGNvbGxpc2lvbnM7CgkKfQoKb2JqW10gYWN0aW9uIEFBQkJfZGV0ZWN0KG9iaiBjdWJlMSxvYmpbXSBjdWJlcykgewogICAgb2JqW10gY29sbGlzaW9ucyA9IG9ialtdOwogICAgbnVtIHRvdGFsY29sc2lkZSA9IDA7Cglmb3IobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgY3ViZXM7IGkrKyl7CiAgICAgICAgbnVtIGNvbHNpZGUgPSAwOwogICAgICAgIG9iaiBjb2xvYmogPSB7fTsKCiAgICAgICAgbnVtIHB4ID0gKG51bSkgY3ViZTEucG9zaXRpb24ueDsKICAgICAgICBudW0gcHkgPSAobnVtKSBjdWJlMS5wb3NpdGlvbi55OwogICAgICAgIG51bSBweiA9IChudW0pIGN1YmUxLnBvc2l0aW9uLno7CiAgICAgICAgbnVtIHZ4ID0gKG51bSkgY3ViZTEudmVsb2NpdHkueDsKICAgICAgICBudW0gdnkgPSAobnVtKSBjdWJlMS52ZWxvY2l0eS55OwogICAgICAgIG51bSB2eiA9IChudW0pIGN1YmUxLnZlbG9jaXR5Lno7CiAgICAgICAgCiAgICAgICAgbnVtIGNzeCA9IChudW0pIGN1YmUxLnNjYWxlLngvMjsKICAgICAgICBudW0gY3N5ID0gKG51bSkgY3ViZTEuc2NhbGUueS8yOwogICAgICAgIG51bSBjc3ogPSAobnVtKSBjdWJlMS5zY2FsZS56LzI7CgogICAgICAgIG9iaiB0Y3ViZSA9IGN1YmVzW2ldOwogICAgICAgIG51bSBjeCA9IChudW0pIHRjdWJlLnBvc2l0aW9uLng7CiAgICAgICAgbnVtIGN5ID0gKG51bSkgdGN1YmUucG9zaXRpb24ueTsKICAgICAgICBudW0gY3ogPSAobnVtKSB0Y3ViZS5wb3NpdGlvbi56OwogICAgICAgIG51bSBzeCA9IChudW0pIHRjdWJlLnNjYWxlLnggLyAyOwogICAgICAgIG51bSBzeSA9IChudW0pIHRjdWJlLnNjYWxlLnkgLyAyOwogICAgICAgIG51bSBzeiA9IChudW0pIHRjdWJlLnNjYWxlLnogLyAyOwogICAgICAgIG51bSBvcHggPSBweDsKICAgICAgICBudW0gb3B5ID0gcHk7CiAgICAgICAgbnVtIG9weiA9IHB6OwogICAgICAgIG51bSBvY3ggPSBjeDsKICAgICAgICBudW0gb2N5ID0gY3k7CiAgICAgICAgbnVtIG9jeiA9IGN6OwogICAgICAgIAogICAgICAgIGlmIChub3RFbXB0eSAob2JqKSBjdWJlMS5vZ3Bvcyl7CiAgICAgICAgICAgIG9weCA9IChudW0pY3ViZTEub2dwb3MueDsKICAgICAgICAgICAgb3B5ID0gKG51bSljdWJlMS5vZ3Bvcy55OwogICAgICAgICAgICBvcHogPSAobnVtKWN1YmUxLm9ncG9zLno7CiAgICAgICAgfSBpZiAobm90RW1wdHkgKG9iail0Y3ViZS5vZ3Bvcyl7CiAgICAgICAgICAgIG9jeCA9IChudW0pdGN1YmUub2dwb3MueDsKICAgICAgICAgICAgb2N5ID0gKG51bSl0Y3ViZS5vZ3Bvcy55OwogICAgICAgICAgICBvY3ogPSAobnVtKXRjdWJlLm9ncG9zLno7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICMgLXgKICAgICAgICBpZihweCA8PSBjeCArIHN4ICsgY3N4ICYmIG9weCA+PSBvY3ggKyBzeCArIGNzeCAmJiBBQUJCX3NpZGUoY3osIHN6ICsgY3N6LCBweikgPT0gMCAmJiBBQUJCX3NpZGUoY3kgKyBzeSwgc3kgKyBjc3ksIHB5ICsgY3N5KSA9PSAwKXsKICAgICAgICAgICAgaWYocHkgPj0gY3kgKyAyICogc3kgLSBBQUJCX3N0ICYmICgoYm9vbCkgY3ViZTEub25Hcm91bmQpKXsKICAgICAgICAgICAgICAgIGN1YmUxLm9uR3JvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdWJlMS5vbldhbGwgPSB0cnVlOwogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWE5FRzsKICAgICAgICB9CiAgICAgICAgIyAreAogICAgICAgIGlmKHB4ID49IGN4IC0gc3ggLSBjc3ggJiYgb3B4IDw9IG9jeCAtIHN4IC0gY3N4ICYmIEFBQkJfc2lkZShjeiwgc3ogKyBjc3osIHB6KSA9PSAwICYmIEFBQkJfc2lkZShjeSArIHN5LCBzeSArIGNzeSwgcHkgKyBjc3kpID09IDApewogICAgICAgICAgICBpZihweSA+PSBjeSArIDIgKiBzeSAtIEFBQkJfc3QgJiYgKChib29sKSBjdWJlMS5vbkdyb3VuZCkpewogICAgICAgICAgICAgICAgY3ViZTEub25Hcm91bmQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1YmUxLm9uV2FsbCA9IHRydWU7CiAgICAgICAgICAgIGNvbHNpZGUgfD0gQUFCQl9YUE9TOwogICAgICAgIH0KICAgICAgICAjIC15CiAgICAgICAgaWYocHkgPD0gY3kgKyAyICogc3kgJiYgb3B5ID49IG9jeSArIDIgKiBzeSAmJiBBQUJCX3NpZGUoY3gsIHN4ICsgY3N4LCBweCkgPT0gMCAmJiBBQUJCX3NpZGUoY3osIHN6ICsgY3N6LCBweikgPT0gMCl7CiAgICAgICAgICAgIGN1YmUxLm9uR3JvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgY29sc2lkZSB8PSBBQUJCX1lORUc7CiAgICAgICAgfQogICAgICAgICMgK3kKICAgICAgICBpZihweSArIDIgKiBjc3kgPj0gY3kgJiYgb3B5ICsgMiAqIGNzeSA8PSBvY3kgJiYgQUFCQl9zaWRlKGN4LCBzeCArIGNzeCwgcHgpID09IDAgJiYgQUFCQl9zaWRlKGN6LCBzeiArIGNzeiwgcHopID09IDApewogICAgICAgICAgICBjb2xzaWRlIHw9IEFBQkJfWVBPUzsKICAgICAgICB9CiAgICAgICAgIyAtegogICAgICAgIGlmKHB6IDw9IGN6ICsgc3ogKyBjc3ogJiYgb3B6ID49IG9jeiArIHN6ICsgY3N6ICYmIEFBQkJfc2lkZShjeCwgc3ggKyBjc3gsIHB4KSA9PSAwICYmIEFBQkJfc2lkZShjeSArIHN5LCBzeSArIGNzeiwgcHkgKyBjc3opID09IDApewogICAgICAgICAgICBpZihweSA+PSBjeSArIDIgKiBzeSAtIEFBQkJfc3QgJiYgKChib29sKSBjdWJlMS5vbkdyb3VuZCkpewogICAgICAgICAgICAgICAgY3ViZTEub25Hcm91bmQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1YmUxLm9uV2FsbCA9IHRydWU7CiAgICAgICAgICAgIGNvbHNpZGUgfD0gQUFCQl9aTkVHOwogICAgICAgIH0KICAgICAgICAjICt6CiAgICAgICAgaWYocHogPj0gY3ogLSBzeiAtIGNzeiAmJiBvcHogPD0gb2N6IC0gc3ogLSBjc3ogJiYgQUFCQl9zaWRlKGN4LCBzeCArIGNzeCwgcHgpID09IDAgJiYgQUFCQl9zaWRlKGN5ICsgc3ksIHN5ICsgY3N5LCBweSArIGNzeSkgPT0gMCl7CiAgICAgICAgICAgIGlmKHB5ID49IGN5ICsgMiAqIHN5IC0gQUFCQl9zdCAmJiAoKGJvb2wpIGN1YmUxLm9uR3JvdW5kKSl7CiAgICAgICAgICAgICAgICBjdWJlMS5vbkdyb3VuZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3ViZTEub25XYWxsID0gdHJ1ZTsKICAgICAgICAgICAgY29sc2lkZSB8PSBBQUJCX1pQT1M7CiAgICAgICAgfQogICAgICAgIGlmIChjb2xzaWRlID4gMCl7CiAgICAgICAgICAgIGNvbG9iaiA9IHRjdWJlOwogICAgICAgICAgICBhZGRUbyBjb2xsaXNpb25zIHtjb2xzaWRlOmNvbHNpZGUsY29sb2JqOmNvbG9ian07CiAgICAgICAgfSAKICAgICAgICB0b3RhbGNvbHNpZGUgfD0gY29sc2lkZTsKCX0KICAgIGlmIChub3RFbXB0eSAob2JqKWN1YmUxLm9ncG9zKSB7CiAgICAgICAgY3ViZTEub2dwb3MueCA9IChudW0pIGN1YmUxLnBvc2l0aW9uLnggKyAwOwogICAgICAgIGN1YmUxLm9ncG9zLnkgPSAobnVtKSBjdWJlMS5wb3NpdGlvbi55ICsgMDsKICAgICAgICBjdWJlMS5vZ3Bvcy56ID0gKG51bSkgY3ViZTEucG9zaXRpb24ueiArIDA7CiAgICB9IGVsc2UgewogICAgICAgIGN1YmUxLm9ncG9zID0gCiAgICAgICAgewogICAgICAgICAgICB4OihudW0pY3ViZTEucG9zaXRpb24ueCArIDAsCiAgICAgICAgICAgIHk6KG51bSljdWJlMS5wb3NpdGlvbi55ICsgMCwKICAgICAgICAgICAgejoobnVtKWN1YmUxLnBvc2l0aW9uLnogKyAwCiAgICAgICAgfTsKICAgIH0KICAgICMgR0FNRS5sb2coY29sbGlzaW9ucyk7CiAgICByZXR1cm4gY29sbGlzaW9uczsKCQp9CgoKb2JqW10gYWN0aW9uIEFBQkJfcmVzb2x2ZXBscihvYmogcGxyLGJvb2wgY3JvdWNoLG9ialtdIGN1YmVzKXsKICAgIGlmIChjcm91Y2gpewogICAgICAgIHBsci5zY2FsZSA9IAogICAgICAgIHsKICAgICAgICAgICAgeDpBQUJCX3csCiAgICAgICAgICAgIHk6QUFCQl9jLAogICAgICAgICAgICB6OkFBQkJfdwogICAgICAgIH07CiAgICB9IGVsc2UgewogICAgICAgIHBsci5zY2FsZT0KICAgICAgICB7CiAgICAgICAgICAgIHg6QUFCQl93LAogICAgICAgICAgICB5OkFBQkJfSCwKICAgICAgICAgICAgejpBQUJCX3cKICAgICAgICB9OwogICAgfQogICAgcmV0dXJuIEFBQkJfcmVzb2x2ZShwbHIsY3ViZXMpOwp9CgphY3Rpb24gQUFCQl9vblBsYXllclNwYXduKHN0ciBpZCkgewogICAgb2JqIHBsciA9IEdBTUUuUExBWUVSUy5maW5kQnlJRChpZCk7CiAgICBwbHIuc2NhbGUgPSB7eDpBQUJCX3cseTpBQUJCX3csejpBQUJCX0h9Owp9CgojaW5jbHVkZSA8ZWNzX2gua3Juaz4KCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBwcml2YXRlIGFjdGlvbnMgYnkgYmxhbmRyaWNlCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogYWN0aW9uIG9uQ29sbGlkZVdvcmxkIChvYmogdG9iaiwgb2JqW10gY29sbGlzdCl7CiAgICBlY3NfaF9vbkNvbGxpZGVXb3JsZCh0b2JqLCAgY29sbGlzdCk7Cn0KCiBhY3Rpb24gb25FQ1NVcGRhdGUgKG51bSBkZWx0YSwgb2JqIHRvYmosIG9ialtdIG9iamxpc3QpewogICAgc2hha2Vfc19vbkVDU1VwZGF0ZShkZWx0YSwgIHRvYmosICBvYmpsaXN0KTsKICAgIGZsb2F0aW5nX29uRUNTVXBkYXRlKGRlbHRhLCAgdG9iaiwgIG9iamxpc3QpOwogICAgZWNzZ3Jhdl9vbkVDU1VwZGF0ZShkZWx0YSwgIHRvYmosICBvYmpsaXN0KTsKICAgIGVjc3BoeXNpY3Nfb25FQ1NVcGRhdGUoZGVsdGEsICB0b2JqLCAgb2JqbGlzdCk7CiAgICBlY3NfaF9vbkVDU1VwZGF0ZShkZWx0YSwgIHRvYmosICBvYmpsaXN0KTsKICAgIHBsYXRmb3JtX29uRUNTVXBkYXRlKGRlbHRhLCAgdG9iaiwgIG9iamxpc3QpOwp9CgogYWN0aW9uIG9uQ29sbGlkZVBscnMgKG9iaiB0b2JqLCBvYmpbXSBwbHJzKXsKICAgIGVjc19oX29uQ29sbGlkZVBscnModG9iaiwgIHBscnMpOwogICAgcGxhdGZvcm1fb25Db2xsaWRlUGxycyh0b2JqLCAgcGxycyk7Cn0KCiBhY3Rpb24gb25Db2xsaWRlIChvYmogdG9iaiwgb2JqW10gb2JqbGlzdCl7CiAgICBlY3NfaF9vbkNvbGxpZGUodG9iaiwgIG9iamxpc3QpOwp9CgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTGlicmFyeTogXGxpYnNcRUNTXGVjc19zLmtybmsKIyBBdXRob3I6IGJsYW5kcmljZQojICAgRGVzY3JpcHRpb246IEVudGl0eSEgQ29tcG9uZW50ISEgU3lzdGVtISEhCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKIyBFbnRpdGllczogb2JqIGxpc3QKIyBDb21wb25lbnRzOiBzZXBhcmF0ZSAiY29tcG9uZW50cyIgbGlicmFyaWVzCiMgU3lzdGVtczogcHVibGljICsgcHJpdmF0ZSBhY3Rpb24gaG9va3MhCgoKCmFjdGlvbiBlY3Nfc191cGRhdGUobnVtIGRlbHRhKXsKCiAgICBvYmpbXSB3b3JsZCA9IEdBTUUuT0JKRUNUUy5saXN0KCk7CiAgICBvYmpbXSB3b3JsZGVkaXQgPSBvYmpbXTsgIyBlZGl0cyB0byBtYWtlIAoKICAgICMgc2ltcGxlciB3b3JsZCBwb3NpdGlvbiBhbmQgc2NhbGUgc3lzdGVtCiAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIHdvcmxkOyBpKyspewogICAgICAgICAgICBvYmogd2N1YmUgPSB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjp7CiAgICAgICAgICAgICAgICAgICAgeDoobnVtKXdvcmxkW2ldLnBvc2l0aW9uLngsCiAgICAgICAgICAgICAgICAgICAgeToobnVtKXdvcmxkW2ldLnBvc2l0aW9uLnkgLSAobnVtKXdvcmxkW2ldLnNjYWxlLnksCiAgICAgICAgICAgICAgICAgICAgejoobnVtKXdvcmxkW2ldLnBvc2l0aW9uLnoKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzY2FsZTogewogICAgICAgICAgICAgICAgICAgIHg6KG51bSl3b3JsZFtpXS5zY2FsZS54KjIsCiAgICAgICAgICAgICAgICAgICAgeToobnVtKXdvcmxkW2ldLnNjYWxlLnkqMiwKICAgICAgICAgICAgICAgICAgICB6OihudW0pd29ybGRbaV0uc2NhbGUueioyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgYWRkVG8gd29ybGRlZGl0IHdjdWJlOwogICAgfQoKICAgICMgbG9vcCB0aHJvdWdoIG9iamVjdCBsaXN0CiAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIHN5bmNvYmpzX3Nfb2JqbGlzdDsgaSsrKQogICAgewogICAgICAgIG9iaiB0b2JqID0gc3luY29ianNfc19vYmpsaXN0W2ldOwogICAgICAgIAogICAgICAgICMgQ1VTVE9NIEFDVElPTiBUSEFUIEJVTkRMRVMgQUxMIFVQREFURSBFVkVOVFMKICAgICAgICBvbkVDU1VwZGF0ZShkZWx0YSwgdG9iaiwgc3luY29ianNfc19vYmpsaXN0KTsKICAgICAgICAKICAgICAgICBpZiAobm90RW1wdHkgKG9iaikgdG9iai5jb2xsaWRlKQogICAgICAgIHsKICAgICAgICAgICAgbnVtIGNvbHR5cGUgPSAobnVtKSB0b2JqLmNvbGxpZGUudHlwZTsKICAgICAgICAgICAgaWYgKChjb2x0eXBlICYgZWNzX2hfQ09MX1dPUkxEKSA+IDApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgcmVzb2x2ZSBjb2xsaXNpb24uIGN1cnJlbnRseSBkZWZhdWx0IHdpbGwgc3RvcCBvYmplY3QgKHZlbCA9IDApCiAgICAgICAgICAgICAgICBvYmpbXSByZXMgPSBBQUJCX3Jlc29sdmUodG9iaix3b3JsZGVkaXQpOwogICAgICAgICAgICAgICAgIyBDVVNUT00gQUNUSU9OIFRIQVQgQlVORExFUyBBTEwgQ09MTElTSU9OIEVWRU5UUwogICAgICAgICAgICAgICAgb25Db2xsaWRlV29ybGQodG9iaixyZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoY29sdHlwZSAmIGVjc19oX0NPTF9QTFJTKSA+IDApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgcmVzb2x2ZSBjb2xsaXNpb24uIGN1cnJlbnRseSBkZXRlY3RzIGZhY2UgYnV0IGRvZXMgTk9UIHN0b3AKICAgICAgICAgICAgICAgIG9ialtdIHBscnMgPSBHQU1FLlBMQVlFUlMubGlzdCgpOwogICAgICAgICAgICAgICAgb2JqW10gcmVzID0gQUFCQl9kZXRlY3QodG9iaixwbHJzKTsKICAgICAgICAgICAgICAgIGlmIChsZW5ndGhPZiByZXMgPiAwKXsKICAgICAgICAgICAgICAgICAgICBvbkNvbGxpZGVQbHJzKHRvYmoscmVzKTsgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAoKICAgICAgICAKCiAgICAgICAgaWYgKChzdHIpIHRvYmouZGVidWcgPT0gIjEiKXsKICAgICAgICAgICAgR0FNRS5sb2codG9iaik7CiAgICAgICAgfQogICAgfSAKCgp9CgphY3Rpb24gZWNzX3Nfb25OZXR3b3JrTWVzc2FnZShzdHIgaWQsIG9iaiBkYXRhLCBzdHIgcGxheWVySUQpIHsKCn0KCiMgcHJpdmF0ZSBhY3Rpb24gb25Db2xsaWRlKG9iaiB0b2JqLCBvYmpbXSBvYmpsaXN0KXsKIyB9CgojIHByaXZhdGUgYWN0aW9uIG9uRUNTVXBkYXRlKG51bSBkZWx0YSwgb2JqIHRvYmosIG9ialtdIG9iamxpc3QpewojIH0KCiMgcHJpdmF0ZSBhY3Rpb24gb25QbGF5ZXJDb2xsaXNpb24oKXs/Pz8KIyAgICAgb2JqW10gcGxycyA9IEdBTUUuUExBWUVSUy5saXN0KCk7CiMgICAgIGZvciAobnVtIGkgPSAwOyBpIDwgbGVuZ3RoT2YgcGxyczsgaSsrKXsKIyAgICAgfQojIH0KCiMgcHJpdmF0ZSBhY3Rpb24gb25Db2xsaWRlV29ybGQob2JqIHRvYmosIG9ialtdIGNvbGxpc3Qpe30KCiMgZGltZW5zaW9ucyBvZiBwbGF0Zm9ybXMKbnVtIFdJRFRIID0gMzA7Cm51bSBIRUlHSFQgPSA1OwpudW0gU0VQID0gMTA7Cm51bSBjcmVhdGVkID0gMDsKCiMgYWVzdGhldGljIHByb3BlcnRpZXMKbnVtIFBMQVRDT0xPUiA9IDB4QUFBQUFBOwojIG51bSBQTEFUQUlEID0gMTE2NzY7ICMgYnJpY2sgdGV4dHVyZQpudW0gUExBVEFJRCA9IDM0Mzc5OyAjIGRlZmF1bHQgbm8gdGV4dHVyZSwgd2hpdGUKCiMgcGxhdGZvcm0gcmFuZ2Uvc3BlZWQgCm51bSBSQU5HRSA9IDQwOyAjIDQwIHVuaXRzLCA4MCB1bml0cyB0b3RhbApudW0gUEVSSU9EID0gNTAwMDsgIyA1IHNlY29uZHMKCiMgbm9kZWUgSUQgcmFuZ2VzIGZvciBiYWNrIGFuZCBmb3J0aCBsaW5lYXIgcGxhdGZvcm1zCm51bSBOX1hfTElOX1BMQVRTVEFSVCAgICAgICAgPSAgMDsKbnVtIE5fWF9MSU5fUExBVEVORCAgICAgICAgICA9IDUwOwoKbnVtIE5fWF9MSU5fMF81X1BMQVRTVEFSVCAgICA9ICA1MTsKbnVtIE5fWF9MSU5fMF81X1BMQVRFTkQgICAgICA9IDEwMDsKCm51bSBOX1lfTElOX1BMQVRTVEFSVCAgICAgICAgPSAxMDE7Cm51bSBOX1lfTElOX1BMQVRFTkQgICAgICAgICAgPSAxNTA7CgpudW0gTl9ZX0xJTl8wXzVfUExBVFNUQVJUICAgID0gMTUxOwpudW0gTl9ZX0xJTl8wXzVfUExBVEVORCAgICAgID0gMjAwOwoKbnVtIE5fWl9MSU5fUExBVFNUQVJUICAgICAgICA9IDIwMTsKbnVtIE5fWl9MSU5fUExBVEVORCAgICAgICAgICA9IDI1MDsKCm51bSBOX1pfTElOXzBfNV9QTEFUU1RBUlQgICAgPSAyNTE7Cm51bSBOX1pfTElOXzBfNV9QTEFURU5EICAgICAgPSAzMDA7CgpudW0gTl9WRVJUX0NJUkNMRVhfUExBVFNUQVJUID0gMzAxOwpudW0gTl9WRVJUX0NJUkNMRVhfUExBVEVORCAgID0gMzUwOwoKbnVtIE5fVkVSVF9DSVJDTEVYXzBfNV9QTEFUU1RBUlQgPSAzNTE7Cm51bSBOX1ZFUlRfQ0lSQ0xFWF8wXzVfUExBVEVORCAgID0gNDAwOwoKbnVtIE5fVkVSVF9DSVJDTEVaX1BMQVRTVEFSVCA9IDQwMTsKbnVtIE5fVkVSVF9DSVJDTEVaX1BMQVRFTkQgICA9IDQ1MDsKCm51bSBOX1ZFUlRfQ0lSQ0xFWl8wXzVfUExBVFNUQVJUID0gNDUxOwpudW0gTl9WRVJUX0NJUkNMRVpfMF81X1BMQVRFTkQgICA9IDUwMDsKCm51bSBOX0hPUl9DSVJDTEVfUExBVFNUQVJUICAgPSA1MDE7Cm51bSBOX0hPUl9DSVJDTEVfUExBVEVORCAgICAgPSA1NTA7CgpudW0gTl9IT1JfQ0lSQ0xFXzBfNV9QTEFUU1RBUlQgICA9IDU1MTsKbnVtIE5fSE9SX0NJUkNMRV8wXzVfUExBVEVORCAgICAgPSA2MDA7CgoKcHVibGljIGFjdGlvbiB1cGRhdGUobnVtIGRlbHRhKXsKICAgIGdfdXBkYXRlKGRlbHRhKTsKICAgIHBscmJodnJfc191cGRhdGUoZGVsdGEpOwogICAgc3luY29ianNfc191cGRhdGUoZGVsdGEpOwogICAgZWNzX3NfdXBkYXRlKGRlbHRhKTsKCiAgICBpZiAobGVuZ3RoT2YgcGxydXRpbF9zX3NwYXduZWRQbGF5ZXJzID4gMCkgewogICAgICAgIGlmIChjcmVhdGVkID09IDApewoKICAgICAgICAgICAgb2JqW10gbm9kZXMgPSBHQU1FLk9CSkVDVFMuZ2V0UGF0aE5vZGVzKCk7CgogICAgICAgICAgICBmb3IgKG51bSBpID0gMDsgaSA8IGxlbmd0aE9mIG5vZGVzOyBpKyspIHsKICAgICAgICAgICAgICAgIG9iaiBpbm9kZSA9IG5vZGVzW2ldOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoKChudW0paW5vZGUuaWQgPj0gTl9YX0xJTl9QTEFUU1RBUlQpICYmICgobnVtKWlub2RlLmlkIDw9IE5fWF9MSU5fUExBVEVORCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm1fY3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogUExBVENPTE9SLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWlkOiBQTEFUQUlELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6e3g6V0lEVEgseTpIRUlHSFQsejpXSURUSH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjp7eDoobnVtKWlub2RlLngseToobnVtKWlub2RlLnksejoobnVtKWlub2RlLnp9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXRpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2dwb3M6e3g6KG51bSlpbm9kZS54LHk6KG51bSlpbm9kZS55LHo6KG51bSlpbm9kZS56fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbXBsaXR1ZGU6e3g6UkFOR0UseTowLHo6MH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdF9tc2ludGVydmFsOlBFUklPRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOnt4OiJzaW5lIix5OiIiLHo6IiJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIGVsc2UgaWYgKCgobnVtKWlub2RlLmlkID49IE5fWF9MSU5fMF81X1BMQVRTVEFSVCkgJiYgKChudW0paW5vZGUuaWQgPD0gTl9YX0xJTl8wXzVfUExBVEVORCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm1fY3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogUExBVENPTE9SLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWlkOiBQTEFUQUlELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6e3g6V0lEVEgseTpIRUlHSFQsejpXSURUSH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjp7eDoobnVtKWlub2RlLngseToobnVtKWlub2RlLnksejoobnVtKWlub2RlLnp9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXRpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2dwb3M6e3g6KG51bSlpbm9kZS54LHk6KG51bSlpbm9kZS55LHo6KG51bSlpbm9kZS56fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbXBsaXR1ZGU6e3g6UkFOR0UseTowLHo6MH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdF9tc2ludGVydmFsOlBFUklPRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6MC41LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6e3g6InNpbmUiLHk6IiIsejoiIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICgoKG51bSlpbm9kZS5pZCA+PSBOX1lfTElOX1BMQVRTVEFSVCkgJiYgKChudW0paW5vZGUuaWQgPD0gTl9ZX0xJTl9QTEFURU5EKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybV9jcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBQTEFUQ09MT1IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhaWQ6IFBMQVRBSUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTp7eDpXSURUSCx5OkhFSUdIVCx6OldJRFRIfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOnt4OihudW0paW5vZGUueCx5OihudW0paW5vZGUueSx6OihudW0paW5vZGUuen0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZ3Bvczp7eDoobnVtKWlub2RlLngseToobnVtKWlub2RlLnksejoobnVtKWlub2RlLnp9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtcGxpdHVkZTp7eDowLHk6UkFOR0UsejowfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0X21zaW50ZXJ2YWw6UEVSSU9ELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6e3g6IiIseToic2luZSIsejoiIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICgoKG51bSlpbm9kZS5pZCA+PSBOX1lfTElOXzBfNV9QTEFUU1RBUlQpICYmICgobnVtKWlub2RlLmlkIDw9IE5fWV9MSU5fMF81X1BMQVRFTkQpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHBsYXRmb3JtX2NyZWF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IFBMQVRDT0xPUiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFpZDogUExBVEFJRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOnt4OldJRFRILHk6SEVJR0hULHo6V0lEVEh9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246e3g6KG51bSlpbm9kZS54LHk6KG51bSlpbm9kZS55LHo6KG51bSlpbm9kZS56fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0aW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ncG9zOnt4OihudW0paW5vZGUueCx5OihudW0paW5vZGUueSx6OihudW0paW5vZGUuen0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1wbGl0dWRlOnt4OjAseTpSQU5HRSx6OjB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRfbXNpbnRlcnZhbDpQRVJJT0QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OjAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOnt4OiIiLHk6InNpbmUiLHo6IiJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoKChudW0paW5vZGUuaWQgPj0gTl9aX0xJTl9QTEFUU1RBUlQpICYmICgobnVtKWlub2RlLmlkIDw9IE5fWl9MSU5fUExBVEVORCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm1fY3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogUExBVENPTE9SLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWlkOiBQTEFUQUlELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6e3g6V0lEVEgseTpIRUlHSFQsejpXSURUSH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjp7eDoobnVtKWlub2RlLngseToobnVtKWlub2RlLnksejoobnVtKWlub2RlLnp9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXRpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2dwb3M6e3g6KG51bSlpbm9kZS54LHk6KG51bSlpbm9kZS55LHo6KG51bSlpbm9kZS56fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbXBsaXR1ZGU6e3g6MCx5OjAsejpSQU5HRX0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdF9tc2ludGVydmFsOlBFUklPRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOnt4OiIiLHk6IiIsejoic2luZSJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoKChudW0paW5vZGUuaWQgPj0gTl9aX0xJTl8wXzVfUExBVFNUQVJUKSAmJiAoKG51bSlpbm9kZS5pZCA8PSBOX1pfTElOXzBfNV9QTEFURU5EKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybV9jcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBQTEFUQ09MT1IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhaWQ6IFBMQVRBSUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTp7eDpXSURUSCx5OkhFSUdIVCx6OldJRFRIfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOnt4OihudW0paW5vZGUueCx5OihudW0paW5vZGUueSx6OihudW0paW5vZGUuen0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZ3Bvczp7eDoobnVtKWlub2RlLngseToobnVtKWlub2RlLnksejoobnVtKWlub2RlLnp9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtcGxpdHVkZTp7eDowLHk6MCx6OlJBTkdFfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0X21zaW50ZXJ2YWw6UEVSSU9ELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDowLjUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTp7eDoiIix5OiIiLHo6InNpbmUifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKCgobnVtKWlub2RlLmlkID49IE5fVkVSVF9DSVJDTEVYX1BMQVRTVEFSVCkgJiYgKChudW0paW5vZGUuaWQgPD0gTl9WRVJUX0NJUkNMRVhfUExBVEVORCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm1fY3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogUExBVENPTE9SLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWlkOiBQTEFUQUlELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6e3g6V0lEVEgseTpIRUlHSFQsejpXSURUSH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjp7eDoobnVtKWlub2RlLngseToobnVtKWlub2RlLnksejoobnVtKWlub2RlLnp9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXRpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2dwb3M6e3g6KG51bSlpbm9kZS54LHk6KG51bSlpbm9kZS55LHo6KG51bSlpbm9kZS56fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbXBsaXR1ZGU6e3g6UkFOR0UseTpSQU5HRSx6OjB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRfbXNpbnRlcnZhbDpQRVJJT0QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTp7eDoiY29zIix5OiJzaW5lIix6OiIifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKCgobnVtKWlub2RlLmlkID49IE5fVkVSVF9DSVJDTEVYXzBfNV9QTEFUU1RBUlQpICYmICgobnVtKWlub2RlLmlkIDw9IE5fVkVSVF9DSVJDTEVYXzBfNV9QTEFURU5EKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybV9jcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBQTEFUQ09MT1IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhaWQ6IFBMQVRBSUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTp7eDpXSURUSCx5OkhFSUdIVCx6OldJRFRIfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOnt4OihudW0paW5vZGUueCx5OihudW0paW5vZGUueSx6OihudW0paW5vZGUuen0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZ3Bvczp7eDoobnVtKWlub2RlLngseToobnVtKWlub2RlLnksejoobnVtKWlub2RlLnp9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtcGxpdHVkZTp7eDpSQU5HRSx5OlJBTkdFLHo6MH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdF9tc2ludGVydmFsOlBFUklPRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6MC41LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6e3g6ImNvcyIseToic2luZSIsejoiIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICgoKG51bSlpbm9kZS5pZCA+PSBOX1ZFUlRfQ0lSQ0xFWl9QTEFUU1RBUlQpICYmICgobnVtKWlub2RlLmlkIDw9IE5fVkVSVF9DSVJDTEVaX1BMQVRFTkQpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHBsYXRmb3JtX2NyZWF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IFBMQVRDT0xPUiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFpZDogUExBVEFJRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOnt4OldJRFRILHk6SEVJR0hULHo6V0lEVEh9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246e3g6KG51bSlpbm9kZS54LHk6KG51bSlpbm9kZS55LHo6KG51bSlpbm9kZS56fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0aW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ncG9zOnt4OihudW0paW5vZGUueCx5OihudW0paW5vZGUueSx6OihudW0paW5vZGUuen0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1wbGl0dWRlOnt4OjAseTpSQU5HRSx6OlJBTkdFfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0X21zaW50ZXJ2YWw6UEVSSU9ELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6e3g6IiIseToic2luZSIsejoiY29zIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICgoKG51bSlpbm9kZS5pZCA+PSBOX1ZFUlRfQ0lSQ0xFWl8wXzVfUExBVFNUQVJUKSAmJiAoKG51bSlpbm9kZS5pZCA8PSBOX1ZFUlRfQ0lSQ0xFWl8wXzVfUExBVEVORCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm1fY3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogUExBVENPTE9SLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWlkOiBQTEFUQUlELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6e3g6V0lEVEgseTpIRUlHSFQsejpXSURUSH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjp7eDoobnVtKWlub2RlLngseToobnVtKWlub2RlLnksejoobnVtKWlub2RlLnp9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXRpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2dwb3M6e3g6KG51bSlpbm9kZS54LHk6KG51bSlpbm9kZS55LHo6KG51bSlpbm9kZS56fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbXBsaXR1ZGU6e3g6MCx5OlJBTkdFLHo6UkFOR0V9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRfbXNpbnRlcnZhbDpQRVJJT0QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OjAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOnt4OiIiLHk6InNpbmUiLHo6ImNvcyJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoKChudW0paW5vZGUuaWQgPj0gTl9IT1JfQ0lSQ0xFX1BMQVRTVEFSVCkgJiYgKChudW0paW5vZGUuaWQgPD0gTl9IT1JfQ0lSQ0xFX1BMQVRFTkQpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHBsYXRmb3JtX2NyZWF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IFBMQVRDT0xPUiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFpZDogUExBVEFJRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOnt4OldJRFRILHk6SEVJR0hULHo6V0lEVEh9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246e3g6KG51bSlpbm9kZS54LHk6KG51bSlpbm9kZS55LHo6KG51bSlpbm9kZS56fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0aW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ncG9zOnt4OihudW0paW5vZGUueCx5OihudW0paW5vZGUueSx6OihudW0paW5vZGUuen0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1wbGl0dWRlOnt4OlJBTkdFLHk6MCx6OlJBTkdFfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0X21zaW50ZXJ2YWw6UEVSSU9ELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6e3g6ImNvcyIseToiIix6OiJzaW5lIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICgoKG51bSlpbm9kZS5pZCA+PSBOX0hPUl9DSVJDTEVfMF81X1BMQVRTVEFSVCkgJiYgKChudW0paW5vZGUuaWQgPD0gTl9IT1JfQ0lSQ0xFXzBfNV9QTEFURU5EKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybV9jcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBQTEFUQ09MT1IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhaWQ6IFBMQVRBSUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTp7eDpXSURUSCx5OkhFSUdIVCx6OldJRFRIfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOnt4OihudW0paW5vZGUueCx5OihudW0paW5vZGUueSx6OihudW0paW5vZGUuen0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZ3Bvczp7eDoobnVtKWlub2RlLngseToobnVtKWlub2RlLnksejoobnVtKWlub2RlLnp9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtcGxpdHVkZTp7eDpSQU5HRSx5OjAsejpSQU5HRX0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdF9tc2ludGVydmFsOlBFUklPRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6MC41LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6e3g6ImNvcyIseToiIix6OiJzaW5lIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjcmVhdGVkID0gMTsKICAgICAgICB9CiAgICB9Cgp9CgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgYXV0by1kZXRlY3RlZCBwdWJsaWMgYWN0aW9ucyBmcm9tIGxpYnJhcmllcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KcHVibGljIGFjdGlvbiBvbkdhbWVFbmQgKCl7CiAgICBwbHJiaHZyX3Nfb25HYW1lRW5kKCk7CiAgICBzeW5jb2Jqc19zX29uR2FtZUVuZCgpOwp9CgpwdWJsaWMgYWN0aW9uIG9uUGxheWVyU3Bhd24gKHN0ciBpZCl7CiAgICBBQUJCX29uUGxheWVyU3Bhd24oaWQpOwp9CgpwdWJsaWMgYWN0aW9uIG9uUGxheWVyTGVhdmUgKHN0ciBwbGF5ZXJJRCl7CiAgICBwbHJ1dGlsX3Nfb25QbGF5ZXJMZWF2ZShwbGF5ZXJJRCk7CiAgICBwbHJiaHZyX3Nfb25QbGF5ZXJMZWF2ZShwbGF5ZXJJRCk7Cn0KCnB1YmxpYyBhY3Rpb24gb25OZXR3b3JrTWVzc2FnZSAoc3RyIGlkLCBvYmogZGF0YSwgc3RyIHBsYXllcklEKXsKICAgIHBscnV0aWxfc19vbk5ldHdvcmtNZXNzYWdlKGlkLCAgZGF0YSwgIHBsYXllcklEKTsKICAgIHBscmJodnJfc19vbk5ldHdvcmtNZXNzYWdlKGlkLCAgZGF0YSwgIHBsYXllcklEKTsKICAgIHN5bmNvYmpzX3Nfb25OZXR3b3JrTWVzc2FnZShpZCwgIGRhdGEsICBwbGF5ZXJJRCk7CiAgICBlY3Nfc19vbk5ldHdvcmtNZXNzYWdlKGlkLCAgZGF0YSwgIHBsYXllcklEKTsKfQoKcHVibGljIGFjdGlvbiBvblBsYXllckRlYXRoIChzdHIgaWQsIHN0ciBraWxsZXJJRCl7CiAgICBwbHJ1dGlsX3Nfb25QbGF5ZXJEZWF0aChpZCwgIGtpbGxlcklEKTsKfQoKcHVibGljIGFjdGlvbiBzdGFydCAoKXsKICAgIHBscnV0aWxfc19zdGFydCgpOwogICAgcGxyYmh2cl9zX3N0YXJ0KCk7CiAgICBzeW5jb2Jqc19zX3N0YXJ0KCk7Cn0KCg=="}},"groups":{"9cabaa99-0b83-4503-a4ff-112857662900":{"ids":["422572d0-72fa-4c8e-932b-e5d4cccfe2bc","192f8338-d938-46ee-b7df-de0d3a67227e"]},"b6fac394-9244-4dac-be52-cb275a3895a6":{"ids":["fd186ae2-8617-4497-87ac-c2367f8a87e1","f12d4d92-9fc8-4803-b81a-c8edccef4b08"]},"1618356f-6f1e-4117-a37f-95eaa801de29":{"ids":["a3f87a0d-609f-49f0-9ed6-8a92ddd3008d","438863a3-35b0-4918-bbfa-4ae525d00dee"]},"178e5050-ecf4-4d51-b5df-47da74d2a6b1":{"ids":["2cc4b793-0aa8-4aca-b8cf-78852f8bdfd7","b9369c0f-e66e-40ac-82e5-0e6206d4a2cd"]},"fe8c3d4f-c43f-4d5f-9daa-0e7ed353d9cb":{"ids":["23eff5f0-d705-4d7e-b2ae-8ed7025f3028","e9016a18-6729-48c6-adbd-b849d891e163"]},"839f82ef-314d-44a6-b0d2-9a3159dd8e3a":{"ids":["c17b1e6b-67cb-4383-bdbf-f35667908ce1","a4314c74-e18c-46f0-964a-86af845c941d"]},"6b1f5d33-0d99-4919-961c-8f6130da1a60":{"ids":["e812e3e5-6147-4c1d-ae80-deaf5e83441d","6ec55d54-1ce2-421b-821a-2e2e265a4526"]},"1072513b-c927-4a0a-8025-ecd1707fa063":{"ids":["ccc42296-d3cc-436b-8f61-f455a9cb19eb","fb14785a-1865-4e58-819b-2ee321fe3daa"]}},"selected":"7a621e4f-e20f-4b01-a9ff-ccfbc5df9218","cam":{"p":[-194.0060235119148,79.36205919452267,-251.53485883349265],"r":[-0.3479999999999974,-0.5220000000000241]},"history":[]}